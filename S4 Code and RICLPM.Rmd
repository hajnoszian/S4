---
title: "S4"
author: "Ian Hajnosz"
date: "2023-11-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(haven)#for .sav loads
library(tidyverse)
library(ggplot2)
library(viridis)
library(gridExtra)
library(lavaan)
library(lme4)
library(lmerTest)
options(mc.cores = parallel::detectCores())#8 cores on computer.
set.seed(2009)
```


# Loading Data

```{r}
dfI_II <- read_sav("D2P1_P2_Ian.sav")

dfIII <- read_sav("D2P3_Ian.sav")
```

Will need to filter down dfI_II to just those who did the entire study. That way when merging, I can use dfI_II for demographics easier.
```{r}
ID0 <- dfI_II |> 
  group_by(pID) |> 
  count(pID) |> 
  select(pID)#252 IDs in PhaseI_II at start

ID1 <- dfIII |> 
  group_by(pID) |> 
  count(pID) |> 
  select(pID)#252 IDs in PhaseIII at start
```

Checking mismatches
```{r}
all(unique(ID0$pID) == unique(ID1$pID)) #Yay! They are indeed all the same folks

rm(ID0, ID1)#just to clean up
```

Keep from analysis:
Using the keep in analysis column in dfI_II, use that as your filter for participants
```{r}
#Creating a list of ids to keep from dfI_II
ids <- dfI_II |> 
  filter(keep == 1) |> 
  select(pID)

#Checking to see if the merge of dfIII and those ids works as intended
o1 <- dfIII |> 
  filter(pID %in% ids$pID) |> 
  group_by(pID) |> 
  count(pID) #14 of everyone, and 242 rows (10 removed, matching to the baseline as intended)

all(unique(ids$pID) == unique(o1$pID)) #Yay it works!
#So in total, the 'keep from analysis' var in dfI_II removes 10 participants, 5 complete couples, from the dataset
```
Re-save the dataframes now with complete cases data
```{r}
dfI_II <- dfI_II |> 
  filter(keep == 1)

dfIII <- dfIII |> 
  filter(pID %in% ids$pID)
```

### Data checks, Recoding, Renaming
Baseline recoding
```{r}
table(dfI_II$dyadtype)
attributes(dfI_II$dyadtype) #It looks like the coding is a bit weird, but we get the first 6 ok I guess

table(dfI_II$a_gend)
attributes(dfI_II$a_gend)

table(dfI_II$a_trans)
attributes(dfI_II$a_trans)

table(dfI_II$a_ethn)
attributes(dfI_II$a_ethn)
table(dfI_II$a_ethn_TEXT)#For end

table(dfI_II$a_sexorn)
attributes(dfI_II$a_sexorn)
table(dfI_II$a_sexorn_TEXT)#unknown other

table(dfI_II$a_myeduc)
attributes(dfI_II$a_myeduc)

table(dfI_II$a_employ)
attributes(dfI_II$a_employ)

table(dfI_II$a_myincome)
attributes(dfI_II$a_myincome)

table(dfI_II$a_relstat)
attributes(dfI_II$a_relstat)

table(dfI_II$a_p1live1)#live with partner item
attributes(dfI_II$a_p1live1)

table(dfI_II$COND)
attributes(dfI_II$COND)

dfI_II <- 
dfI_II |> 
  mutate(
    dyadtype = recode(factor(dyadtype),
                      "0" = "ManWoman",
                      "1" = "WomanWoman",
                      "2" = "Woman-agenderGenderless",
                      "3" = "Man-nonbinaryGenderqueer",
                      "4" = "ManMan",
                      "5" = "Woman-nonbinaryGenderqueer"),
    a_gend = recode(factor(a_gend),
                    "0" = "Man",
                    "1" = "Woman",
                    "2" = "NonbinaryGenderqueer",
                    #"3" = "bigenderGenderfluid",
                    "4" = "AgenderGenderless"),
    a_trans = recode(factor(a_trans),
                     "0" = "No",
                     "1" = "Yes",
                     "2" = "DontKnow"),
    a_ethn = recode(factor(a_ethn),
                    "0" = "WhiteCaucasianAnglo",
                    "1" = "BlackAfricanCaribbean",
                    "2" = "HispanicLatinoaChicanoa",
                    "3" = "EastAsian",
                    "4" = "SouthAsian",
                    "5" = "SoutheastAsian",
                    #"6" = "WestAsian",
                    #"7" = "MiddleEasterArab,
                    #"8" = "AboriginalIndigenousNative,
                    "9" = "MixedMultipleEthnicGroups",
                    "10" = "Other"),
    a_sexorn = recode(factor(a_sexorn),
                      "0" = "HeterosexualStraight",
                      "1" = "Gay",
                      "2" = "Lesbian",
                      "3" = "Queer",
                      "4" = "BisexualPansexual",
                      #"5" = "Demisexual",
                      "6" = "Asexual",
                      "7" = "Other"),
    a_myeduc = recode(factor(a_myeduc),
                      "1" = "LowerSecondary",
                      "2" = "UpperSecondary",
                      "3" = "Vocational",
                      "4" = "Undergraduate",
                      "5" = "Masters",
                      "6" = "DoctorateProfessional",
                      "7" = "Other"),
    a_employ = recode(factor(a_employ),
                      "0" = "No",
                      "1" = "PartTime",
                      "2" = "FullTime"),
    a_myincome = recode(factor(a_myincome),
                        "0" = "£0-£12,570",
                        "1" = "£12,571-£14,732",
                        "2" = "£14,733-£25,688",
                        "3" = "£25,689-£43,662",
                        "4" = "£43,663-£150,000"),
    a_relstat = recode(factor(a_relstat),
                       "1" = "DatingPAndOthers",
                       "2" = "DatingPExclusive",
                       "3" = "CommonLaw",
                       "4" = "CivilPartnership",
                       "5" = "Engaged",
                       "6" = "Married"),
    a_student = recode(factor(a_student),
                       "0" = "No",
                       "1" = "Yes"),
    Cohab = recode(factor(a_p1live1),
                   "0" = "No",
                   "1" = "Yes"),
    COND = recode(factor(COND),
                  "-1" = "Control",
                  "1" = "Intervention")
    )

#Additional
dfI_II$a_ethn[dfI_II$a_ethn_TEXT == "I would add White Irish"] <- "WhiteCaucasianAnglo"
```

### Data merges

Cleaning up the daily data
```{r}
dfIII <- 
dfIII |> 
  rename(
    Partner = a_p3whatkm1,
    Friend = a_p3whatkm2,
    Family = a_p3whatkm3,
    Colleague = a_p3whatkm4,
    Acquaintance = a_p3whatkm5,
    Stranger = a_p3whatkm6,
    Animal = a_p3whatkm7,
    Nature = a_p3whatkm8,
    Music = a_p3whatkm9,
    NonFiction = a_p3whatkm10,
    Fiction = a_p3whatkm11,
    OtherKM = a_p3whatkm12,
    WhatKmTEXT = a_p3whatkm12_TEXT,
    ppr1 = a_p3ppr1,
    ppr2 = a_p3ppr2,
    ppr3 = a_p3ppr3,
    ppr4 = a_p3ppr4,
    km1 = a_p3km1,
    km2 = a_p3km2,
    km3 = a_p3km3,
    km4 = a_p3km4,
    km5 = a_p3km5,
    km6 = a_p3km6,
    pa1 = a_p3pa1,
    pa2 = a_p3pa2,
    pa3 = a_p3pa3,
    pa4 = a_p3pa4,
    pa5 = a_p3pa5,
  )
```

Checking the KM text vars
```{r}
nrow(table(dfIII$WhatKmTEXT)) #great, so 107 write-ins...this is not worth diving in for recoding tbh
```




Beginning the merge process
```{r}
df <- dfI_II |> 
  select(cID, pID, partner, COND) #Should be it. Rest of baseline vars are just for cross-sectional and/or descriptive purposes. We already have the same folks in each, so no need to take more vars

#### Merging this piecemeal df with the daily. Line up by pID. Should be 3388 obs (same as og daily length) and with 3 extra vars (cID is a duplicate to take out, but good for sanity check)
df <- merge(df, dfIII, by.x = "pID", by.y = "pID")
```

Sanity check on slightly larger daily df
```{r}
#cID sanity check
all(df$cID.x == df$cID.y) #True, yay. Let's simplify it 
df <- 
df |> 
  select(-cID.y) |> 
  rename(
    cID = cID.x
  ) 

#14 days across everyone?
df |> 
 group_by(pID) |> 
  count(pID) #nice, all set here too!
```

For my future models, I want to use partners A and B (rather than 1 and 2--want to reduce the amount of numbers in the label if possible)
```{r}
df <- df |> 
  mutate(
    partner = recode(factor(partner),
                     "1" = "A",
                     "2" = "B")
  )
```


So now we should have a final daily df with the necessary vars for those models, primed with labels to get widened.
We also have a dfI_II df that has all the demographic vars, and also the cross sectional variables for those intervention tests



# Descriptives

### Dyad Type
```{r}
table(dfI_II$dyadtype)

prop.table(table(dfI_II$dyadtype)) *100

ggplot(dfI_II, aes(x = dyadtype)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5)) +
  labs(title = "Dyad Type",
       x="",
       y = "Count")
```



### Gender & Trans
note, we don't have biological born sex in these data
```{r}
table(dfI_II$a_gend)
prop.table(table(dfI_II$a_gend))*100

p1 <- ggplot(dfI_II, aes(x = a_gend)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5)) +
  labs(title = "Gender",
       x="",
       y = "Count")
##############################
table(dfI_II$a_trans)
prop.table(table(dfI_II$a_trans))*100

p2 <- ggplot(dfI_II, aes(x = a_trans)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5)) +
  labs(title = "Transgender",
       x = "",
       y = "Count")

##############################
grid.arrange(p1,p2, nrow = 2)

```


### Age
```{r}
dfI_II |> 
  summarise(
    AgeM = mean(a_p1age, na.rm = T),
    AgeSD = sd(a_p1age, na.rm = T)
  )
range(dfI_II$a_p1age)

ggplot(dfI_II, aes(x = a_p1age)) +
  geom_histogram(binwidth = 1) +
  labs(title = "Age Distribution",
       x = "Age (Binwidth = 1)",
       y = "Count")
```


### Ethnicity
```{r}
table(dfI_II$a_ethn)
round(prop.table(table(dfI_II$a_ethn)) *100,2)

ggplot(dfI_II, aes(x = a_ethn)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 30, vjust = 0.5)) +
  labs(title = "Ethnicity",
       x = "",
       y = "Count")
```


### Sexual Orientation
```{r}
table(dfI_II$a_sexorn)
round(prop.table(table(dfI_II$a_sexorn))*100,2)

ggplot(dfI_II, aes(x = a_sexorn)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 30, vjust = 0.5)) +
  labs(title = "Sexual Orientation",
       x = "",
       y = "Count")
```


### Education
```{r}
table(dfI_II$a_myeduc)
round(prop.table(table(dfI_II$a_myeduc))*100,2)

ggplot(dfI_II, aes(x = a_myeduc)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 30, vjust = 0.5)) +
  labs(title = "Education",
       x = "",
       y = "Count")
```


### Student
```{r}
table(dfI_II$a_student)
round(prop.table(table(dfI_II$a_student))*100,2)

ggplot(dfI_II, aes(x = a_student)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5)) +
  labs(title = "Student Status",
       x = "",
       y = "Count")
```

### Employed
```{r}
table(dfI_II$a_employ)
round(prop.table(table(dfI_II$a_employ))*100,2)

ggplot(dfI_II, aes(x = a_employ)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 30, vjust = 0.5)) +
  labs(title = "Employed",
       x = "",
       y = "Count")
```

### Income
```{r}
table(dfI_II$a_myincome)
round(prop.table(table(dfI_II$a_myincome)) *100,2)

ggplot(dfI_II, aes(x = a_myincome)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 30, vjust = 0.5)) +
  labs(title = "My Income",
       x = "",
       y = "Count")
```


### Relationship Status
```{r}
table(dfI_II$a_relstat)
round(prop.table(table(dfI_II$a_relstat))*100,2)

ggplot(dfI_II, aes(x = a_relstat)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 30, vjust = 0.5)) +
  labs(title = "Relationship Status",
       x = "",
       y = "Count")
```


### Relationship Length
```{r}
dfI_II |> 
  summarise(
    RelLenYM = mean(a_p1lengY, na.rm = T),
    RekLenYSD = sd(a_p1lengY,na.rm = T)
  )
range(dfI_II$a_p1lengY, na.rm = T)

ggplot(dfI_II, aes(x = a_p1lengY)) +
  geom_histogram(binwidth = 2) +
  labs(title = "Years Distribution",
       x = "Years",
       y = "Count")
```


### Living Situation
```{r}
table(dfI_II$Cohab)
round(prop.table(table(dfI_II$Cohab))*100,2)

ggplot(dfI_II, aes(x = Cohab)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5)) +
  labs(title = "Cohabitation",
       x = "",
       y = "Count")
```


### Other Baselines??


# RQ1: Intervention Effect

### Intervention impact KM?
Should be a cross-sectional
Use dfI_II
```{r}
contrasts(dfI_II$COND) #confirming that the control condition is the reference group
```


```{r}
dfI_II$KMtot <- rowSums(dfI_II[c(37, 40:42)], na.rm = T) #note, max scores here should be 0-4. So max score of 16

m.ivn <- lmer(KMtot ~ COND + (1| cID), data = dfI_II)
summary(m.ivn) #Intervention condition is averaging about 10, which is slightly above the scale midpoint
confint(m.ivn)

```

#### Visualize 

```{r}
ggplot(aes(x = COND, y = KMtot), data = dfI_II) +
  geom_boxplot() +
  stat_summary(geom = "point", fun.y = "mean", shape = 23, size = 3, col = "black", fill = "purple") +
    labs(title = "KM Score by Condition",
       x = "",
       y = "Total KM Score (Out of 16)")
```

```{r}
ggplot(aes(x = COND, y = KMtot), data = dfI_II) +
  ggdist::stat_halfeye(adjust = .5, width = .3, .width = -.5, justification = -.3, point_colour = NA) + #this is for the half-distribution
  geom_boxplot(width = .1, outlier.shape = NA) +
  gghalves::geom_half_point(side = "l", range_scale = .4, alpha = .5) +
    labs(title = "KM Score by Condition",
       x = "",
       y = "Total KM Score (Out of 16)")
```


### Intervention matter across period? 
#### Making Pairwise Dataframe

We're going to try this in the SEM. If that fails, revert back to mlm format with COND as a predictor

In MLM, should be the base model but with the condition added in. 
Use df, longform. Need to make pairwise format too!
```{r}
### Create the KM actor variable
df$KMtot <- rowSums(df[c(15, 18:20)], na.rm = T) #note, max scores here should be 0-4. So max score of 16
df$PPRtot <- rowSums(df[c(6:9)], na.rm = T)

### Saving and labeling actor df as such
Actor <- df
colnames(Actor)[6:35] <- paste("a", colnames(Actor)[6:35], sep = "_") #adding (back) the actor prefix

### Saving and lebling a partner df
Partner <- Actor |> arrange(cID, desc(pID)) |> 
  rename_with(~str_replace(., "a_", "p_"), starts_with("a_"))

### Creating the pairwise version
Pairwise <- 
Actor |> 
  mutate(
    p_ppr1 = Partner$p_ppr1,
    p_ppr2 = Partner$p_ppr2,
    p_ppr3 = Partner$p_ppr3,
    p_ppr4 = Partner$p_ppr4,
    p_pa1 = Partner$p_pa1,
    p_pa2 = Partner$p_pa2,
    p_pa3 = Partner$p_pa3,
    p_pa4 = Partner$p_pa4,
    p_pa5 = Partner$p_pa5,
    p_km1 = Partner$p_km1,
    p_km4 = Partner$p_km4,
    p_km5 = Partner$p_km5,
    p_km6 = Partner$p_km6,
    p_KMtot = Partner$p_KMtot,
    p_PPRtot = Partner$p_PPRtot
    ) |>  #just to re-order so we can confirm that crisscross
  select(pID, cID, partner, COND, day,
         a_ppr1, p_ppr1,
         a_ppr2, p_ppr2,
         a_ppr3, p_ppr3,
         a_ppr4, p_ppr4,
         a_pa1, p_pa1,
         a_pa2, p_pa2,
         a_pa3, p_pa3,
         a_pa4, p_pa4,
         a_pa5, p_pa5,
         a_km1, p_km1,
         a_km4, p_km4,
         a_km5, p_km5,
         a_km6, p_km6,
         a_KMtot, p_KMtot,
         a_PPRtot, p_PPRtot
  )
#looks like that worked!

```

Now to modeling
We're going to avoid mean centering stuff since that is v complicated I think

#### KM
```{r}
m.ivnK <- lmer(a_KMtot ~ COND + day + (1| cID) + (1|pID), data = Pairwise)
summary(m.ivnK)
```
Thank goodness actually. This model suggests that no, the condition did not have a bearing on a person's KM on a given day
Interestingly, it also suggests that as the study goes on, we see a slight decrease in KM per day. But if it's not from the intervention itself, what is it from? This may be a study confound effect, where folks are primed by their participation in the study and revert to normal across the study period as they get further away from the salience of the initial study entry (which is where they actually had to do a lot of relational focus work)

Also, if time does seem to matter across this study period, it's hint that we'll probably not see any consistent lagged effects again (just like S3).

#### PPR
```{r}
m.ivnP <- lmer(a_PPRtot ~ COND + day + (1| cID) + (1|pID), data = Pairwise)
summary(m.ivnP)
```
Similarly, not seeing an intervention effect on PPR across the period.
Interesting that we see the day effect goes away here. 

A look at the model tells me that the KM model is more precise--about double the random effect residual in this model vs the KM one. So this model doesn't apportion as much variance to the random effects, the fixed effects are also smaller, which might be why we're seeing more noise in the effects here. 


### Summary
So we see that the responsiveness intervention DOES impact KM in an experimental way--you dose up on PPR, then that leads to more KM experience.
We also see that the intervention DOES NOT seem to impact KM across the study period. That intervention just holds on the day-of, not downstreaming into the rest of the period. 

# RQ(3): Descriptive

## Sans Item2 and Item3
I'm expecting a similar factor loading that motivates these removals. Just doing it now for the sake of it. Can easily add later

### How often? KM>0
```{r}
df |> 
  mutate(
    KMmark = ifelse(km1 + km4 + km5 + km6 > 0, "Potential KM", "None")
  ) |> 
  count(KMmark) #So 2775/3388 (~82%) days potentially had a KM exp by this threshold

o1 <- df |> 
  mutate(
    KMmark = ifelse(km1 + km4 + km5 + km6 > 0, 1, 0)
    ) |> 
  group_by(pID) |> 
  mutate(
    Day = row_number()
  ) |> 
  select(pID, KMmark, Day)

o1 <- o1 |>
  pivot_wider(
    names_from = Day,
    names_prefix = "Day_",
    values_from = KMmark
  )
o1$KMtot <- rowSums(o1[2:15], na.rm = T)
o1 |> 
  ungroup(pID) |> 
  summarise(mean = mean(KMtot)) #note, should be same ratio as above but in a new format. 11.46/14 is 82% as well

p1 <- ggplot(o1, aes(x = KMtot)) +
  geom_bar() +
  #geom_vline(xintercept = mean(o1$KMtot), color = "red", linetype = "longdash") +
  labs(title = "Score >0 (out of 16) Threshold",
       x = "Number of Days",
       y = "Number of People")
```
### How often? KM>1/4 (>4, 1/4 of scale)
```{r}
df |> 
  mutate(
    KMmark = ifelse(km1 + km4 + km5 + km6 > 4, "Potential KM", "None")
  ) |> 
  count(KMmark) #So 1945/3388 (~57%) days potentially had a KM exp by this threshold

o1 <- df |> 
  mutate(
    KMmark = ifelse(km1 + km4 + km5 + km6 > 4, 1, 0)
    ) |> 
  group_by(pID) |> 
  mutate(
    Day = row_number()
  ) |> 
  select(pID, KMmark, Day)

o1 <- o1 |>
  pivot_wider(
    names_from = Day,
    names_prefix = "Day_",
    values_from = KMmark
  )
o1$KMtot <- rowSums(o1[2:15], na.rm = T)
o1 |> 
  ungroup(pID) |> 
  summarise(mean = mean(KMtot)) #note, should be same ratio as above but in a new format. 8.04/14 is ~57% as well

p2 <- ggplot(o1, aes(x = KMtot)) +
  geom_bar() +
  #geom_vline(xintercept = mean(o1$KMtot), color = "red", linetype = "longdash") +
  labs(title = "Score >4 (out of 16) Threshold",
       x = "Number of Days",
       y = "Number of People")
```
### How often? KM>1/2 (>8, 1/2 of scale)
```{r}
df |> 
  mutate(
    KMmark = ifelse(km1 + km4 + km5 + km6 > 8, "Potential KM", "None")
  ) |> 
  count(KMmark) #So 1016/3388 (~30%) days potentially had a KM exp by this threshold

o1 <- df |> 
  mutate(
    KMmark = ifelse(km1 + km4 + km5 + km6 > 8, 1, 0)
    ) |> 
  group_by(pID) |> 
  mutate(
    Day = row_number()
  ) |> 
  select(pID, KMmark, Day)

o1 <- o1 |>
  pivot_wider(
    names_from = Day,
    names_prefix = "Day_",
    values_from = KMmark
  )
o1$KMtot <- rowSums(o1[2:15], na.rm = T)
o1 |> 
  ungroup(pID) |> 
  summarise(mean = mean(KMtot)) #note, should be same ratio as above but in a new format. 4.2/14 is ~30% as well

p3 <- ggplot(o1, aes(x = KMtot)) +
  geom_bar() +
  #geom_vline(xintercept = mean(o1$KMtot), color = "red", linetype = "longdash") +
  labs(title = "Score >8 (out of 16) Threshold",
       x = "Number of Days",
       y = "Number of People")
```

### How often? KM>3/4 (>12, 3/4 of scale)
```{r}
df |> 
  mutate(
    KMmark = ifelse(km1 + km4 + km5 + km6 > 12, "Potential KM", "None")
  ) |> 
  count(KMmark) #So 326/3388 (~10%) days potentially had a KM exp by this threshold

o1 <- df |> 
  mutate(
    KMmark = ifelse(km1 + km4 + km5 + km6 > 12, 1, 0)
    ) |> 
  group_by(pID) |> 
  mutate(
    Day = row_number()
  ) |> 
  select(pID, KMmark, Day)

o1 <- o1 |>
  pivot_wider(
    names_from = Day,
    names_prefix = "Day_",
    values_from = KMmark
  )
o1$KMtot <- rowSums(o1[2:15], na.rm = T)
o1 |> 
  ungroup(pID) |> 
  summarise(mean = mean(KMtot)) #note, should be same ratio as above but in a new format. 1.35/14 is ~10% as well

p4 <- ggplot(o1, aes(x = KMtot)) +
  geom_bar() +
  #geom_vline(xintercept = mean(o1$KMtot), color = "red", linetype = "longdash") +
  labs(title = "Score >12 (out of 16) Threshold",
       x = "Number of Days",
       y = "Number of People")
```

```{r}
#needs the p1-p4 run from above to make these work
grid.arrange(p1,p2, p3,p4, nrow = 2) #red line indicators are kinda hard to disentangle frankly, so I'm cutting those for now
```
What i'm learning here:
Slightly lower than S3 but similar patterns. Even at the highest threshold of KM experience, we'd expect someone to have a KM emotional experience about once every 12 days.
By the half scale threshold, we're looking at experiencing kama muta once 4 times every 2 weeks (S3 had near the same ratio, 1.7 out of 6 days: around 28.5%)

### What Evoked the KM?
REMEMBER: This took out KM items 2 and 3. So some people will have reported evokers for those items. But since I'm cutting the items, we have a mismatch.

The total number of evokers listed is the row observations in the o1 df. The total number of evokers listed as per these 4 KM items is from the All+ bar Mark count ()
```{r}
o1 <- 
df |> 
  select(pID, Partner, Friend, Family, Colleague, Acquaintance, Stranger, Animal, Nature, Music, NonFiction, Fiction, OtherKM,
         km1, km4, km5 , km6) |> 
  group_by(pID) |> 
  mutate(
    Day = row_number(),
    Mark = ifelse(km1 + km4 + km5 + km6 > 0, 1, 0),
    MarkQtr = ifelse(km1 +  km4 + km5 + km6 > 4, 1, 0),
    MarkHalf = ifelse(km1 + km4 + km5 + km6 > 8, 1, 0),
    Mark34 = ifelse(km1 + km4 + km5 + km6 > 12, 1, 0),
    HighestMark = case_when(
#      .default = "0",
      Mark34 == 1 ~ ">3/4",
      MarkHalf == 1 ~ ">1/2",
      MarkQtr == 1 ~ ">1/4",
      Mark == 1 ~ ">0"
      ),
    HighestMark = factor(HighestMark, levels = c(">0", ">1/4", ">1/2", ">3/4"))
  ) |> 
  select(pID, Day, Partner, Friend, Family, Colleague, Acquaintance, Stranger, Animal, Nature, Music, NonFiction, Fiction, OtherKM,
         Mark, MarkQtr, MarkHalf, Mark34, HighestMark) |> 
  pivot_longer(cols = !c(pID, Day, Mark, MarkQtr, MarkHalf, Mark34, HighestMark), names_to = "Evoker") |> 
  filter(value == 1) |> #taking only the combinations that turned up
  group_by(pID, Day)
#7858 evokers listed by our participants (including from items 2 and 3).
#With 3388 obs (i.e. days) in the whole dataset, means ~2.3 evokers reported per day (S3 had ~2.5)


#All+ bar
sum(table(o1$Evoker[o1$Mark == 1])) #7821 evokers by new KM standards. Out of 3388 total day observations, means ~2.3 evokers reported per day (S3 had ~2.5)
#also means 7858-7821 = 37 days where people ONLY scored on KM items 2 and 3 (and no other KM indicators).
table(o1$Evoker[o1$Mark == 1])
round(prop.table(table(o1$Evoker[o1$Mark == 1]))*100,1)

#Low+ bar
sum(table(o1$Evoker[o1$MarkQtr == 1]))
table(o1$Evoker[o1$MarkQtr == 1])
round(prop.table(table(o1$Evoker[o1$MarkQtr == 1]))*100,1)

#Med+ bar
sum(table(o1$Evoker[o1$MarkHalf == 1]))
table(o1$Evoker[o1$MarkHalf == 1])
round(prop.table(table(o1$Evoker[o1$MarkHalf == 1]))*100,1)

#High+ bar
sum(table(o1$Evoker[o1$Mark34 == 1]))
table(o1$Evoker[o1$Mark34 == 1])
round(prop.table(table(o1$Evoker[o1$Mark34 == 1]))*100,1)


p1 <- o1 |> 
  filter(Mark == 1) |> 
  ggplot(aes(x = Evoker)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5)) +
  labs(title = ">0 KM Days",
       x = "",
       y = "Count (n = 7821)")

p2 <- o1 |> 
  filter(MarkQtr == 1) |> 
  ggplot(aes(x = Evoker)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5)) +
  labs(title = ">1/4+ KM Days",
       x = "",
       y = "Count (n = 6018)")

p3 <- o1 |> 
  filter(MarkHalf == 1) |> 
  ggplot(aes(x = Evoker)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5)) +
  labs(title = ">1/2 KM Days",
       x = "",
       y = "Count (n = 3313)") 

p4 <- o1 |> 
  filter(Mark34 == 1) |> 
  ggplot(aes(x = Evoker)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5)) +
  labs(title = ">3/4 KM Days",
       x = "",
       y = "Count (n = 1119)") 

grid.arrange(p1,p2, p3,p4, nrow = 2)

o1 |> 
  ggplot(aes(Evoker, fill = HighestMark)) +
  geom_bar(position = "stack") +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5)) +
  labs(title = "Evokers",
       x = "",
       y = "Count")

o1 |> 
  ggplot(aes(x= HighestMark, fill = Evoker)) +
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5)) +
  labs(title = "Evokers",
       x = "KM Days",
       y = "Percentage") 

#With refactored/regrouped Evoker
o1 |> 
  mutate(
    Evoker = recode(factor(Evoker), 
       Partner = "Partner",
       Friend = "Friend",
       Family = "Family",
       Music = "Music",
       Nature = "Nature",
       Fiction = "Remaining",
       NonFiction = "Remaining",
       Acquaintance = "Remaining",
       Animal = "Remaining",
       Colleague = "Remaining",
       OtherKM = "Remaining",
       Stranger = "Remaining"
       ),
    Evoker = factor(Evoker, levels = c("Partner", "Family", "Friend", "Music", "Nature", "Remaining"))
    ) |> 
  filter(!is.na(HighestMark)) |> #to get rid of those folks who reported evokers but just on items2 and 3 (which are cut)
  ggplot(aes(HighestMark, fill = Evoker)) +
  geom_bar(position = "fill", stat = "count") +
  theme(axis.text.x = element_text(vjust = 0.5)) +
  scale_fill_viridis(discrete=TRUE) +
  labs(title = "S4 Evokers",
       x = "Threshold of Kama Muta Scale",
       y = "Percentage")
```
Things we're learning
A) Partners are number one (mid to high 20%s), again, but to a larger degree than S3 (mid to low 20s). Probs from study focus
B) Close others take up nearabouts 50% again, with music also remaining in the ~10% range





# RQ 2-3 Modeling:
## Plan B

#### Redoing the Wide format
We need the time spread, but individuals per row. We'll do the grouping vars and such in the MLM itself
```{r}
#Keeping PA

#selecting what is needed
dfSEM <- df |>
  select(!c(pID,Partner:PPRtot)) #keeping in the PA for now. Might remove later if too complicated

#expanding the daily data wider
dfSEM <- dfSEM |> 
  pivot_wider(
    names_from = "day",
    names_prefix = "t",
    values_from = c("ppr1", "ppr2", "ppr3", "ppr4",
                    "pa1", "pa2", "pa3","pa4", "pa5", #keeping in the PA for now. Might remove later if too complicated
                    "km1", "km2", "km3", "km4", "km5", "km6",)
  )


dfSEM[,4:213] <- sapply(dfSEM[,4:213], as.numeric) #to remove that haven label--would be a problem in later code, predict() stuff
```
This is now a row-individual dataset that we can use the SEM on to create factors without having to split into Person A and B within a row-couple

### Measurement model
Can actually take pretty much from previous code

For due diligence, we'll do the full km test again as if we're restarting (expecting to remove those items)
Keep in mind, these models are at least twice as large as the previous stuff in S3 (more 4x as many people, more than 2x the timepoints)

Justify whether to keep them in or out
Free with vs free without: 

With km2 and km3
Might need to use an older version of lavaan for speed--something in the new update makes fit measures take forever to output?
library(remotes)
install_version("lavaan","0.6-12")
```{r}
measure.m3 <- '
   #####################
  # MEASUREMENT MODEL #
  #####################

  # Factor models for km at 14 waves (Constrained)
  Fkm1 =~ km1_t1 + km2_t1 + km3_t1 + km4_t1 + km5_t1 + km6_t1
  Fkm2 =~ km1_t2 + km2_t2 + km3_t2 + km4_t2 + km5_t2 + km6_t2
  Fkm3 =~ km1_t3 + km2_t3 + km3_t3 + km4_t3 + km5_t3 + km6_t3
  Fkm4 =~ km1_t4 + km2_t4 + km3_t4 + km4_t4 + km5_t4 + km6_t4
  Fkm5 =~ km1_t5 + km2_t5 + km3_t5 + km4_t5 + km5_t5 + km6_t5
  Fkm6 =~ km1_t6 + km2_t6 + km3_t6 + km4_t6 + km5_t6 + km6_t6
  Fkm7 =~ km1_t7 + km2_t7 + km3_t7 + km4_t7 + km5_t7 + km6_t7
  Fkm8 =~ km1_t8 + km2_t8 + km3_t8 + km4_t8 + km5_t8 + km6_t8
  Fkm9 =~ km1_t9 + km2_t9 + km3_t9 +km4_t9 + km5_t9 + km6_t9
  Fkm10 =~ km1_t10 + km2_t10 + km3_t10 + km4_t10 + km5_t10 + km6_t10
  Fkm11 =~ km1_t11 + km2_t11 + km3_t11 + km4_t11 + km5_t11 + km6_t11
  Fkm12 =~ km1_t12 + km2_t12 + km3_t12 + km4_t12 + km5_t12 + km6_t12
  Fkm13 =~ km1_t13 + km2_t13 + km3_t13 + km4_t13 + km5_t13 + km6_t13
  Fkm14 =~ km1_t14 + km2_t14 + km3_t14 + km4_t14 + km5_t14 + km6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  Fppr1 =~ ppr1_t1 + ppr2_t1 + ppr3_t1 + ppr4_t1
  Fppr2 =~ ppr1_t2 + ppr2_t2 + ppr3_t2 + ppr4_t2
  Fppr3 =~ ppr1_t3 + ppr2_t3 + ppr3_t3 + ppr4_t3
  Fppr4 =~ ppr1_t4 + ppr2_t4 + ppr3_t4 + ppr4_t4
  Fppr5 =~ ppr1_t5 + ppr2_t5 + ppr3_t5 + ppr4_t5
  Fppr6 =~ ppr1_t6 + ppr2_t6 + ppr3_t6 + ppr4_t6
  Fppr7 =~ ppr1_t7 + ppr2_t7 + ppr3_t7 + ppr4_t7
  Fppr8 =~ ppr1_t8 + ppr2_t8 + ppr3_t8 + ppr4_t8
  Fppr9 =~ ppr1_t9 + ppr2_t9 + ppr3_t9 + ppr4_t9
  Fppr10 =~ ppr1_t10 + ppr2_t10 + ppr3_t10 + ppr4_t10
  Fppr11 =~ ppr1_t11 + ppr2_t11 + ppr3_t11 + ppr4_t11
  Fppr12 =~ ppr1_t12 + ppr2_t12 + ppr3_t12 + ppr4_t12
  Fppr13 =~ ppr1_t13 + ppr2_t13 + ppr3_t13 + ppr4_t13
  Fppr14 =~ ppr1_t14 + ppr2_t14 + ppr3_t14 + ppr4_t14
  
'

measure.m3.fit <- cfa(measure.m3,
    data = dfSEM,
    std.lv = T,
    missing = "ML",
    )
summary(measure.m3.fit, fit.measures = T, standardized =T, ci = T) #yeah, the old lavaan version doesnt get stuck on the summary fit.measures
```

Without km2 and km3
```{r}
measure.m4 <- '
   #####################
  # MEASUREMENT MODEL #
  #####################

  # Factor models for km at 14 waves (Constrained)
  Fkm1 =~ km1_t1 + km4_t1 + km5_t1 + km6_t1
  Fkm2 =~ km1_t2 + km4_t2 + km5_t2 + km6_t2
  Fkm3 =~ km1_t3 + km4_t3 + km5_t3 + km6_t3
  Fkm4 =~ km1_t4 + km4_t4 + km5_t4 + km6_t4
  Fkm5 =~ km1_t5 + km4_t5 + km5_t5 + km6_t5
  Fkm6 =~ km1_t6 + km4_t6 + km5_t6 + km6_t6
  Fkm7 =~ km1_t7 + km4_t7 + km5_t7 + km6_t7
  Fkm8 =~ km1_t8 + km4_t8 + km5_t8 + km6_t8
  Fkm9 =~ km1_t9 + km4_t9 + km5_t9 + km6_t9
  Fkm10 =~ km1_t10 + km4_t10 + km5_t10 + km6_t10
  Fkm11 =~ km1_t11 + km4_t11 + km5_t11 + km6_t11
  Fkm12 =~ km1_t12 + km4_t12 + km5_t12 + km6_t12
  Fkm13 =~ km1_t13 + km4_t13 + km5_t13 + km6_t13
  Fkm14 =~ km1_t14 + km4_t14 + km5_t14 + km6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  Fppr1 =~ ppr1_t1 + ppr2_t1 + ppr3_t1 + ppr4_t1
  Fppr2 =~ ppr1_t2 + ppr2_t2 + ppr3_t2 + ppr4_t2
  Fppr3 =~ ppr1_t3 + ppr2_t3 + ppr3_t3 + ppr4_t3
  Fppr4 =~ ppr1_t4 + ppr2_t4 + ppr3_t4 + ppr4_t4
  Fppr5 =~ ppr1_t5 + ppr2_t5 + ppr3_t5 + ppr4_t5
  Fppr6 =~ ppr1_t6 + ppr2_t6 + ppr3_t6 + ppr4_t6
  Fppr7 =~ ppr1_t7 + ppr2_t7 + ppr3_t7 + ppr4_t7
  Fppr8 =~ ppr1_t8 + ppr2_t8 + ppr3_t8 + ppr4_t8
  Fppr9 =~ ppr1_t9 + ppr2_t9 + ppr3_t9 + ppr4_t9
  Fppr10 =~ ppr1_t10 + ppr2_t10 + ppr3_t10 + ppr4_t10
  Fppr11 =~ ppr1_t11 + ppr2_t11 + ppr3_t11 + ppr4_t11
  Fppr12 =~ ppr1_t12 + ppr2_t12 + ppr3_t12 + ppr4_t12
  Fppr13 =~ ppr1_t13 + ppr2_t13 + ppr3_t13 + ppr4_t13
  Fppr14 =~ ppr1_t14 + ppr2_t14 + ppr3_t14 + ppr4_t14
  
'

measure.m4.fit <- cfa(measure.m4,
    data = dfSEM,
    std.lv = T,
    missing = "ML",
    )

summary(measure.m4.fit, fit.measures = T, standardized =T, ci = T)
```


```{r}
anova(measure.m3.fit,measure.m4.fit)
```
Yeah, m4 without the items is stat sig better. Not nested, but good enough to see that.


#### Weak Invariance Test
(Fixed)  Without km2 and km3
```{r}
measure.m5 <- '
   #####################
  # MEASUREMENT MODEL #
  #####################

  # Factor models for km at 14 waves (Constrained)
  Fkm1 =~ a*km1_t1 + d*km4_t1 + e*km5_t1 + f*km6_t1
  Fkm2 =~ a*km1_t2 + d*km4_t2 + e*km5_t2 + f*km6_t2
  Fkm3 =~ a*km1_t3 + d*km4_t3 + e*km5_t3 + f*km6_t3
  Fkm4 =~ a*km1_t4 + d*km4_t4 + e*km5_t4 + f*km6_t4
  Fkm5 =~ a*km1_t5 + d*km4_t5 + e*km5_t5 + f*km6_t5
  Fkm6 =~ a*km1_t6 + d*km4_t6 + e*km5_t6 + f*km6_t6
  Fkm7 =~ a*km1_t7 + d*km4_t7 + e*km5_t7 + f*km6_t7
  Fkm8 =~ a*km1_t8 + d*km4_t8 + e*km5_t8 + f*km6_t8
  Fkm9 =~ a*km1_t9 + d*km4_t9 + e*km5_t9 + f*km6_t9
  Fkm10 =~ a*km1_t10 + d*km4_t10 + e*km5_t10 + f*km6_t10
  Fkm11 =~ a*km1_t11 + d*km4_t11 + e*km5_t11 + f*km6_t11
  Fkm12 =~ a*km1_t12 + d*km4_t12 + e*km5_t12 + f*km6_t12
  Fkm13 =~ a*km1_t13 + d*km4_t13 + e*km5_t13 + f*km6_t13
  Fkm14 =~ a*km1_t14 + d*km4_t14 + e*km5_t14 + f*km6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  Fppr1 =~ g*ppr1_t1 + h*ppr2_t1 + i*ppr3_t1 + j*ppr4_t1
  Fppr2 =~ g*ppr1_t2 + h*ppr2_t2 + i*ppr3_t2 + j*ppr4_t2
  Fppr3 =~ g*ppr1_t3 + h*ppr2_t3 + i*ppr3_t3 + j*ppr4_t3
  Fppr4 =~ g*ppr1_t4 + h*ppr2_t4 + i*ppr3_t4 + j*ppr4_t4
  Fppr5 =~ g*ppr1_t5 + h*ppr2_t5 + i*ppr3_t5 + j*ppr4_t5
  Fppr6 =~ g*ppr1_t6 + h*ppr2_t6 + i*ppr3_t6 + j*ppr4_t6
  Fppr7 =~ g*ppr1_t7 + h*ppr2_t7 + i*ppr3_t7 + j*ppr4_t7
  Fppr8 =~ g*ppr1_t8 + h*ppr2_t8 + i*ppr3_t8 + j*ppr4_t8
  Fppr9 =~ g*ppr1_t9 + h*ppr2_t9 + i*ppr3_t9 + j*ppr4_t9
  Fppr10 =~ g*ppr1_t10 + h*ppr2_t10 + i*ppr3_t10 + j*ppr4_t10
  Fppr11 =~ g*ppr1_t11 + h*ppr2_t11 + i*ppr3_t11 + j*ppr4_t11
  Fppr12 =~ g*ppr1_t12 + h*ppr2_t12 + i*ppr3_t12 + j*ppr4_t12
  Fppr13 =~ g*ppr1_t13 + h*ppr2_t13 + i*ppr3_t13 + j*ppr4_t13
  Fppr14 =~ g*ppr1_t14 + h*ppr2_t14 + i*ppr3_t14 + j*ppr4_t14
  
'

measure.m5.fit <- cfa(measure.m5,
    data = dfSEM,
    std.lv = T,
    missing = "ML",
    )
summary(measure.m5.fit, fit.measures = T, standardized =T, ci = T) #its the fit measures that take forever to cycle
```

```{r}
anova(measure.m4.fit, measure.m5.fit)
```
Good, model is NOT APPRECIABLY DIFFERENT when using those constraints

#### Strong Invariance Test
```{r}
measure.m6 <- '
   #####################
  # MEASUREMENT MODEL #
  #####################

  # Factor models for km at 14 waves (Constrained)
  Fkm1 =~ a*km1_t1 + d*km4_t1 + e*km5_t1 + f*km6_t1
  Fkm2 =~ a*km1_t2 + d*km4_t2 + e*km5_t2 + f*km6_t2
  Fkm3 =~ a*km1_t3 + d*km4_t3 + e*km5_t3 + f*km6_t3
  Fkm4 =~ a*km1_t4 + d*km4_t4 + e*km5_t4 + f*km6_t4
  Fkm5 =~ a*km1_t5 + d*km4_t5 + e*km5_t5 + f*km6_t5
  Fkm6 =~ a*km1_t6 + d*km4_t6 + e*km5_t6 + f*km6_t6
  Fkm7 =~ a*km1_t7 + d*km4_t7 + e*km5_t7 + f*km6_t7
  Fkm8 =~ a*km1_t8 + d*km4_t8 + e*km5_t8 + f*km6_t8
  Fkm9 =~ a*km1_t9 + d*km4_t9 + e*km5_t9 + f*km6_t9
  Fkm10 =~ a*km1_t10 + d*km4_t10 + e*km5_t10 + f*km6_t10
  Fkm11 =~ a*km1_t11 + d*km4_t11 + e*km5_t11 + f*km6_t11
  Fkm12 =~ a*km1_t12 + d*km4_t12 + e*km5_t12 + f*km6_t12
  Fkm13 =~ a*km1_t13 + d*km4_t13 + e*km5_t13 + f*km6_t13
  Fkm14 =~ a*km1_t14 + d*km4_t14 + e*km5_t14 + f*km6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  Fppr1 =~ g*ppr1_t1 + h*ppr2_t1 + i*ppr3_t1 + j*ppr4_t1
  Fppr2 =~ g*ppr1_t2 + h*ppr2_t2 + i*ppr3_t2 + j*ppr4_t2
  Fppr3 =~ g*ppr1_t3 + h*ppr2_t3 + i*ppr3_t3 + j*ppr4_t3
  Fppr4 =~ g*ppr1_t4 + h*ppr2_t4 + i*ppr3_t4 + j*ppr4_t4
  Fppr5 =~ g*ppr1_t5 + h*ppr2_t5 + i*ppr3_t5 + j*ppr4_t5
  Fppr6 =~ g*ppr1_t6 + h*ppr2_t6 + i*ppr3_t6 + j*ppr4_t6
  Fppr7 =~ g*ppr1_t7 + h*ppr2_t7 + i*ppr3_t7 + j*ppr4_t7
  Fppr8 =~ g*ppr1_t8 + h*ppr2_t8 + i*ppr3_t8 + j*ppr4_t8
  Fppr9 =~ g*ppr1_t9 + h*ppr2_t9 + i*ppr3_t9 + j*ppr4_t9
  Fppr10 =~ g*ppr1_t10 + h*ppr2_t10 + i*ppr3_t10 + j*ppr4_t10
  Fppr11 =~ g*ppr1_t11 + h*ppr2_t11 + i*ppr3_t11 + j*ppr4_t11
  Fppr12 =~ g*ppr1_t12 + h*ppr2_t12 + i*ppr3_t12 + j*ppr4_t12
  Fppr13 =~ g*ppr1_t13 + h*ppr2_t13 + i*ppr3_t13 + j*ppr4_t13
  Fppr14 =~ g*ppr1_t14 + h*ppr2_t14 + i*ppr3_t14 + j*ppr4_t14
  
  # Constrained Intercepts over time (Strong invariance)
  km1_t1 + km1_t2 + km1_t3 + km1_t4 + km1_t5 + km1_t6 + km1_t7 + km1_t8 + km1_t9 + km1_t10 + km1_t11 + km1_t12 + km1_t13 + km1_t14 ~ k*1
  km4_t1 + km4_t2 + km4_t3 + km4_t4 + km4_t5 + km4_t6 + km4_t7 + km4_t8 + km4_t9 + km4_t10 + km4_t11 + km4_t12 + km4_t13 + km4_t14 ~ l*1
  km5_t1 + km5_t2 + km5_t3 + km5_t4 + km5_t5 + km5_t6 + km5_t7 + km5_t8 + km5_t9 + km5_t10 + km5_t11 + km5_t12 + km5_t13 + km5_t14 ~ m*1
  km6_t1 + km6_t2 + km6_t3 + km6_t4 + km6_t5 + km6_t6 + km6_t7 + km6_t8 + km6_t9 + km6_t10 + km6_t11 + km6_t12 + km6_t13 + km6_t14 ~ n*1
  
  ppr1_t1 + ppr1_t2 + ppr1_t3 + ppr1_t4 + ppr1_t5 + ppr1_t6 + ppr1_t7 + ppr1_t8 + ppr1_t9 + ppr1_t10 + ppr1_t11 + ppr1_t12 + ppr1_t13 + ppr1_t14 ~ o*1
  ppr2_t1 + ppr2_t2 + ppr2_t3 + ppr2_t4 + ppr2_t5 + ppr2_t6 + ppr2_t7 + ppr2_t8 + ppr2_t9 + ppr2_t10 + ppr2_t11 + ppr2_t12 + ppr2_t13 + ppr2_t14 ~ p*1
  ppr3_t1 + ppr3_t2 + ppr3_t3 + ppr3_t4 + ppr3_t5 + ppr3_t6 + ppr3_t7 + ppr3_t8 + ppr3_t9 + ppr3_t10 + ppr3_t11 + ppr3_t12 + ppr3_t13 + ppr3_t14 ~ q*1
  ppr4_t1 + ppr4_t2 + ppr4_t3 + ppr4_t4 + ppr4_t5 + ppr4_t6 + ppr4_t7 + ppr4_t8 + ppr4_t9 + ppr4_t10 + ppr4_t11 + ppr4_t12 + ppr4_t13 + ppr4_t14 ~ r*1
  
'

measure.m6.fit <- cfa(measure.m6,
    data = dfSEM,
    std.lv = T,
    missing = "ML",
    )
summary(measure.m6.fit, fit.measures = T, standardized =T, ci = T, rsquare = T) #its the fit measures that take forever to cycle
```

```{r}
anova(measure.m5.fit, measure.m6.fit)
```
Again, strong invariance constraints do not statistically change the model. Looks like I can move forward with this one!

If I use cfa with std.lv = F, then cfa does the default which is to scale to the first item. Read Bollens paper 2022 for more detail (that is a perfect read for this I think)

#### Extraction
```{r}
o1 <- as.data.frame(predict(measure.m6.fit)) #woo!
o1$id <- 1:nrow(o1)
colnames(o1)

colnames(o1) <- gsub("(?<=\\D)(?=\\d)", "_",colnames(o1), perl = T) #adding in a _ separator for easier pivotting later

o1 <- o1 |> 
  pivot_longer(
    c(Fkm_1:Fppr_14),
    names_to = c(".value", "day"),
               names_sep = "_") #woo that worked!
o1$day <- as.numeric(o1$day)

```
Comparing these to the total scores added up in the Pairwise dataset makes sense. It does appear that these factors are grand mean standardized--i.e. scores are relative to the entire sample at that time point, as expected. So scores above ~6 (KM average across every day-ish) are positive, while those below are negative.
One weird thing:
The same total score is not always the same factor score, notably 0. So Person 1 scored 0 for KM, but has some variability in their factor scores. Why?

I thiiiink has to do with the 0 score's variability for that given day. The factors are calculated for each day and, if they are scaled for each, that means that 0 means something SLIGHTLY differently for each day assuming that the distribution of scores for each day are not exactly the same each day. I.e. 0 on Day 3 might be more or less dramatic than 0 on Day 5, given how variable Day 3 and 5 are, respectively. 

That is all to say, this is my first indicator that these factor scores are going to be interpreted as 




##### Scaling to Item
Checking the std.lv numbers--just to have as a comparison point so we're sure what's going on with the standardizing
```{r}
measure.m6M <- '
   #####################
  # MEASUREMENT MODEL #
  #####################

  # Factor models for km at 14 waves (Constrained)
  Fkm1 =~ a*km1_t1 + d*km4_t1 + e*km5_t1 + f*km6_t1
  Fkm2 =~ a*km1_t2 + d*km4_t2 + e*km5_t2 + f*km6_t2
  Fkm3 =~ a*km1_t3 + d*km4_t3 + e*km5_t3 + f*km6_t3
  Fkm4 =~ a*km1_t4 + d*km4_t4 + e*km5_t4 + f*km6_t4
  Fkm5 =~ a*km1_t5 + d*km4_t5 + e*km5_t5 + f*km6_t5
  Fkm6 =~ a*km1_t6 + d*km4_t6 + e*km5_t6 + f*km6_t6
  Fkm7 =~ a*km1_t7 + d*km4_t7 + e*km5_t7 + f*km6_t7
  Fkm8 =~ a*km1_t8 + d*km4_t8 + e*km5_t8 + f*km6_t8
  Fkm9 =~ a*km1_t9 + d*km4_t9 + e*km5_t9 + f*km6_t9
  Fkm10 =~ a*km1_t10 + d*km4_t10 + e*km5_t10 + f*km6_t10
  Fkm11 =~ a*km1_t11 + d*km4_t11 + e*km5_t11 + f*km6_t11
  Fkm12 =~ a*km1_t12 + d*km4_t12 + e*km5_t12 + f*km6_t12
  Fkm13 =~ a*km1_t13 + d*km4_t13 + e*km5_t13 + f*km6_t13
  Fkm14 =~ a*km1_t14 + d*km4_t14 + e*km5_t14 + f*km6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  Fppr1 =~ g*ppr1_t1 + h*ppr2_t1 + i*ppr3_t1 + j*ppr4_t1
  Fppr2 =~ g*ppr1_t2 + h*ppr2_t2 + i*ppr3_t2 + j*ppr4_t2
  Fppr3 =~ g*ppr1_t3 + h*ppr2_t3 + i*ppr3_t3 + j*ppr4_t3
  Fppr4 =~ g*ppr1_t4 + h*ppr2_t4 + i*ppr3_t4 + j*ppr4_t4
  Fppr5 =~ g*ppr1_t5 + h*ppr2_t5 + i*ppr3_t5 + j*ppr4_t5
  Fppr6 =~ g*ppr1_t6 + h*ppr2_t6 + i*ppr3_t6 + j*ppr4_t6
  Fppr7 =~ g*ppr1_t7 + h*ppr2_t7 + i*ppr3_t7 + j*ppr4_t7
  Fppr8 =~ g*ppr1_t8 + h*ppr2_t8 + i*ppr3_t8 + j*ppr4_t8
  Fppr9 =~ g*ppr1_t9 + h*ppr2_t9 + i*ppr3_t9 + j*ppr4_t9
  Fppr10 =~ g*ppr1_t10 + h*ppr2_t10 + i*ppr3_t10 + j*ppr4_t10
  Fppr11 =~ g*ppr1_t11 + h*ppr2_t11 + i*ppr3_t11 + j*ppr4_t11
  Fppr12 =~ g*ppr1_t12 + h*ppr2_t12 + i*ppr3_t12 + j*ppr4_t12
  Fppr13 =~ g*ppr1_t13 + h*ppr2_t13 + i*ppr3_t13 + j*ppr4_t13
  Fppr14 =~ g*ppr1_t14 + h*ppr2_t14 + i*ppr3_t14 + j*ppr4_t14
  
  # Constrained Intercepts over time (Strong invariance)
  km1_t1 + km1_t2 + km1_t3 + km1_t4 + km1_t5 + km1_t6 + km1_t7 + km1_t8 + km1_t9 + km1_t10 + km1_t11 + km1_t12 + km1_t13 + km1_t14 ~ k*1
  km4_t1 + km4_t2 + km4_t3 + km4_t4 + km4_t5 + km4_t6 + km4_t7 + km4_t8 + km4_t9 + km4_t10 + km4_t11 + km4_t12 + km4_t13 + km4_t14 ~ l*1
  km5_t1 + km5_t2 + km5_t3 + km5_t4 + km5_t5 + km5_t6 + km5_t7 + km5_t8 + km5_t9 + km5_t10 + km5_t11 + km5_t12 + km5_t13 + km5_t14 ~ m*1
  km6_t1 + km6_t2 + km6_t3 + km6_t4 + km6_t5 + km6_t6 + km6_t7 + km6_t8 + km6_t9 + km6_t10 + km6_t11 + km6_t12 + km6_t13 + km6_t14 ~ n*1
  
  ppr1_t1 + ppr1_t2 + ppr1_t3 + ppr1_t4 + ppr1_t5 + ppr1_t6 + ppr1_t7 + ppr1_t8 + ppr1_t9 + ppr1_t10 + ppr1_t11 + ppr1_t12 + ppr1_t13 + ppr1_t14 ~ o*1
  ppr2_t1 + ppr2_t2 + ppr2_t3 + ppr2_t4 + ppr2_t5 + ppr2_t6 + ppr2_t7 + ppr2_t8 + ppr2_t9 + ppr2_t10 + ppr2_t11 + ppr2_t12 + ppr2_t13 + ppr2_t14 ~ p*1
  ppr3_t1 + ppr3_t2 + ppr3_t3 + ppr3_t4 + ppr3_t5 + ppr3_t6 + ppr3_t7 + ppr3_t8 + ppr3_t9 + ppr3_t10 + ppr3_t11 + ppr3_t12 + ppr3_t13 + ppr3_t14 ~ q*1
  ppr4_t1 + ppr4_t2 + ppr4_t3 + ppr4_t4 + ppr4_t5 + ppr4_t6 + ppr4_t7 + ppr4_t8 + ppr4_t9 + ppr4_t10 + ppr4_t11 + ppr4_t12 + ppr4_t13 + ppr4_t14 ~ r*1
  
'

measure.m6M.fit <- cfa(measure.m6M,
    data = dfSEM,
    std.lv = F,
    missing = "ML",
    )
summary(measure.m6M.fit, fit.measures = T, standardized =T, ci = T) #its the fit measures that take forever to cycle
```
```{r}
measure.m6L <- '
   #####################
  # MEASUREMENT MODEL #
  #####################

  # Factor models for km at 14 waves (Constrained)
  Fkm1 =~ a*km1_t1 + 1*km4_t1 + e*km5_t1 + f*km6_t1
  Fkm2 =~ a*km1_t2 + 1*km4_t2 + e*km5_t2 + f*km6_t2
  Fkm3 =~ a*km1_t3 + 1*km4_t3 + e*km5_t3 + f*km6_t3
  Fkm4 =~ a*km1_t4 + 1*km4_t4 + e*km5_t4 + f*km6_t4
  Fkm5 =~ a*km1_t5 + 1*km4_t5 + e*km5_t5 + f*km6_t5
  Fkm6 =~ a*km1_t6 + 1*km4_t6 + e*km5_t6 + f*km6_t6
  Fkm7 =~ a*km1_t7 + 1*km4_t7 + e*km5_t7 + f*km6_t7
  Fkm8 =~ a*km1_t8 + 1*km4_t8 + e*km5_t8 + f*km6_t8
  Fkm9 =~ a*km1_t9 + 1*km4_t9 + e*km5_t9 + f*km6_t9
  Fkm10 =~ a*km1_t10 + 1*km4_t10 + e*km5_t10 + f*km6_t10
  Fkm11 =~ a*km1_t11 + 1*km4_t11 + e*km5_t11 + f*km6_t11
  Fkm12 =~ a*km1_t12 + 1*km4_t12 + e*km5_t12 + f*km6_t12
  Fkm13 =~ a*km1_t13 + 1*km4_t13 + e*km5_t13 + f*km6_t13
  Fkm14 =~ a*km1_t14 + 1*km4_t14 + e*km5_t14 + f*km6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  Fppr1 =~ g*ppr1_t1 + h*ppr2_t1 + i*ppr3_t1 + j*ppr4_t1
  Fppr2 =~ g*ppr1_t2 + h*ppr2_t2 + i*ppr3_t2 + j*ppr4_t2
  Fppr3 =~ g*ppr1_t3 + h*ppr2_t3 + i*ppr3_t3 + j*ppr4_t3
  Fppr4 =~ g*ppr1_t4 + h*ppr2_t4 + i*ppr3_t4 + j*ppr4_t4
  Fppr5 =~ g*ppr1_t5 + h*ppr2_t5 + i*ppr3_t5 + j*ppr4_t5
  Fppr6 =~ g*ppr1_t6 + h*ppr2_t6 + i*ppr3_t6 + j*ppr4_t6
  Fppr7 =~ g*ppr1_t7 + h*ppr2_t7 + i*ppr3_t7 + j*ppr4_t7
  Fppr8 =~ g*ppr1_t8 + h*ppr2_t8 + i*ppr3_t8 + j*ppr4_t8
  Fppr9 =~ g*ppr1_t9 + h*ppr2_t9 + i*ppr3_t9 + j*ppr4_t9
  Fppr10 =~ g*ppr1_t10 + h*ppr2_t10 + i*ppr3_t10 + j*ppr4_t10
  Fppr11 =~ g*ppr1_t11 + h*ppr2_t11 + i*ppr3_t11 + j*ppr4_t11
  Fppr12 =~ g*ppr1_t12 + h*ppr2_t12 + i*ppr3_t12 + j*ppr4_t12
  Fppr13 =~ g*ppr1_t13 + h*ppr2_t13 + i*ppr3_t13 + j*ppr4_t13
  Fppr14 =~ g*ppr1_t14 + h*ppr2_t14 + i*ppr3_t14 + j*ppr4_t14
  
  # Constrained Intercepts over time (Strong invariance)
  km1_t1 + km1_t2 + km1_t3 + km1_t4 + km1_t5 + km1_t6 + km1_t7 + km1_t8 + km1_t9 + km1_t10 + km1_t11 + km1_t12 + km1_t13 + km1_t14 ~ k*1
  km4_t1 + km4_t2 + km4_t3 + km4_t4 + km4_t5 + km4_t6 + km4_t7 + km4_t8 + km4_t9 + km4_t10 + km4_t11 + km4_t12 + km4_t13 + km4_t14 ~ l*1
  km5_t1 + km5_t2 + km5_t3 + km5_t4 + km5_t5 + km5_t6 + km5_t7 + km5_t8 + km5_t9 + km5_t10 + km5_t11 + km5_t12 + km5_t13 + km5_t14 ~ m*1
  km6_t1 + km6_t2 + km6_t3 + km6_t4 + km6_t5 + km6_t6 + km6_t7 + km6_t8 + km6_t9 + km6_t10 + km6_t11 + km6_t12 + km6_t13 + km6_t14 ~ n*1
  
  ppr1_t1 + ppr1_t2 + ppr1_t3 + ppr1_t4 + ppr1_t5 + ppr1_t6 + ppr1_t7 + ppr1_t8 + ppr1_t9 + ppr1_t10 + ppr1_t11 + ppr1_t12 + ppr1_t13 + ppr1_t14 ~ o*1
  ppr2_t1 + ppr2_t2 + ppr2_t3 + ppr2_t4 + ppr2_t5 + ppr2_t6 + ppr2_t7 + ppr2_t8 + ppr2_t9 + ppr2_t10 + ppr2_t11 + ppr2_t12 + ppr2_t13 + ppr2_t14 ~ p*1
  ppr3_t1 + ppr3_t2 + ppr3_t3 + ppr3_t4 + ppr3_t5 + ppr3_t6 + ppr3_t7 + ppr3_t8 + ppr3_t9 + ppr3_t10 + ppr3_t11 + ppr3_t12 + ppr3_t13 + ppr3_t14 ~ q*1
  ppr4_t1 + ppr4_t2 + ppr4_t3 + ppr4_t4 + ppr4_t5 + ppr4_t6 + ppr4_t7 + ppr4_t8 + ppr4_t9 + ppr4_t10 + ppr4_t11 + ppr4_t12 + ppr4_t13 + ppr4_t14 ~ r*1
  
'

measure.m6L.fit <- cfa(measure.m6L,
    data = dfSEM,
    std.lv = F,
    missing = "ML",
    )
summary(measure.m6L.fit, fit.measures = T, standardized =T, ci = T) #its the fit measures that take forever to cycle
```



```{r}
predict(measure.m6M.fit) #scaled to first measure item. 6L is scaled to latent
```
Note, these numbers ARE different factor predictions than the std.lv = T m6 model. I THINK they will be relatively different, i.e. at a relative level they are not showing more or less variation than the other, but just a heads up that these numbers are not strictly speaking the same with different interpretations. Will need to double check that interpretation re:Bollen for help.

### Scale Checking


```{r}
ggplot(aes(x = day, y = a_KMtot), data = Pairwise) +
  ggdist::stat_halfeye(adjust = .3,  .width = -.5, justification = -.3) + #this is for the half-distribution
  labs(title = "KM Score Across Days",
       x = "",
       y = "Total KM Score (Out of 16)")
```
So anything below about 6 is likely to show as "negative" in the factor, while anything above should be positive (assuming perfect measurement reliability)

#### Scaled to Latent Factor
```{r}
ggplot(aes(x = day, y = Fkm), data = o1) +
  ggdist::stat_halfeye(adjust = .3,  .width = -.5, justification = .2) + #this is for the half-distribution
  labs(title = "KM Score Across Days",
       x = "",
       y = "Latent Scaled KM Score, per Day") +
  scale_x_continuous(breaks = 1:14)
```

#### Scaled to First Item
```{r}
o1 <- as.data.frame(predict(measure.m6M.fit)) #woo!
o1$id <- 1:nrow(o1)
colnames(o1)

colnames(o1) <- gsub("(?<=\\D)(?=\\d)", "_",colnames(o1), perl = T) #adding in a _ separator for easier pivotting later

o1 <- o1 |> 
  pivot_longer(
    c(Fkm_1:Fppr_14),
    names_to = c(".value", "day"),
               names_sep = "_") #woo that worked!
o1$day <- as.numeric(o1$day)
```

```{r}
ggplot(aes(x = day, y = Fkm), data = o1) +
  ggdist::stat_halfeye(adjust = .3,  .width = -.5, justification = .2) + #this is for the half-distribution
  labs(title = "KM Score Across Days",
       x = "",
       y = "Item Scaled KM Score, per Day") +
  scale_x_continuous(breaks = 1:14)
```

So it looks like scaling to first item is shrinking the range, but otherwise does not change the variability (whew--makes sense, but still whew).

So the main thing is of interpretability, which will be the main question

As per Bollen 2023, I should probs scale to item4 for face validity (Today, I felt "moved" or "touched").




```{r}
ggplot(aes(x = day, y = a_PPRtot), data = Pairwise) +
  ggdist::stat_halfeye(adjust = .5,  .width = -.5, justification = -.3) + #this is for the half-distribution
  labs(title = "PPR Score Across Days",
       x = "",
       y = "Total PPR Score (Out of 24)")
```
So anything below about 16 is likely to show as "negative" in the factor, while anything above should be positive (assuming perfect measurement reliability)

### Creating Pairwise Factor Dataframe
Just in case not re-run from earlier, some old code from above is included
For a latent factor variable, pairwise dataframe, use this code
```{r}
#### To make the object with m6 fit measures
o1 <- as.data.frame(predict(measure.m6.fit)) #woo!
o1$id <- 1:nrow(o1)
colnames(o1)

colnames(o1) <- gsub("(?<=\\D)(?=\\d)", "_",colnames(o1), perl = T) #adding in a _ separator for easier pivotting later

o1 <- o1 |> 
  pivot_longer(
    c(Fkm_1:Fppr_14),
    names_to = c(".value", "day"),
               names_sep = "_") #woo that worked!
o1$day <- as.numeric(o1$day)

#### To make the actor df
Actor <- df
colnames(Actor)[6:35] <- paste("a", colnames(Actor)[6:35], sep = "_") #adding (back) the actor prefix

#### NEW STUFF
Actor <- Actor |> 
  select(pID:day) |> 
  merge(o1, by.x = c("pID", "day"), by.y = c("id", "day"), all.x = T)

colnames(Actor)[6:7] <- paste("a", colnames(Actor)[6:7], sep = "_") #adding (back) the actor prefix

Partner <- Actor |> arrange(cID, desc(pID)) |> 
  rename_with(~str_replace(., "a_", "p_"), starts_with("a_"))

PairwiseF <- 
Actor |> 
  mutate(
    p_Fppr = Partner$p_Fppr,
    p_Fkm = Partner$p_Fkm
        ) |>  #just to re-order so we can confirm that crisscross
  select(pID, cID, partner, COND, day,
         a_Fkm, p_Fkm,
         a_Fppr, p_Fppr
  ) #sort by cID, this should be pairwise but with the new factor loadings
```

For an observed variables, pairwise dataframe, use this code
```{r}
### Create the KM actor variable
df$KMtot <- rowSums(df[c(15, 18:20)], na.rm = T) #note, max scores here should be 0-4. So max score of 16
df$PPRtot <- rowSums(df[c(6:9)], na.rm = T)

### Saving and labeling actor df as such
Actor <- df
colnames(Actor)[6:35] <- paste("a", colnames(Actor)[6:35], sep = "_") #adding (back) the actor prefix


### Saving and lebling a partner df
Partner <- Actor |> arrange(cID, desc(pID)) |> 
  rename_with(~str_replace(., "a_", "p_"), starts_with("a_"))

### Creating the pairwise version
Pairwise <- 
Actor |> 
  mutate(
    p_ppr1 = Partner$p_ppr1,
    p_ppr2 = Partner$p_ppr2,
    p_ppr3 = Partner$p_ppr3,
    p_ppr4 = Partner$p_ppr4,
    p_pa1 = Partner$p_pa1,
    p_pa2 = Partner$p_pa2,
    p_pa3 = Partner$p_pa3,
    p_pa4 = Partner$p_pa4,
    p_pa5 = Partner$p_pa5,
    p_km1 = Partner$p_km1,
    p_km4 = Partner$p_km4,
    p_km5 = Partner$p_km5,
    p_km6 = Partner$p_km6,
    p_KMtot = Partner$p_KMtot,
    p_PPRtot = Partner$p_PPRtot
    ) |>  #just to re-order so we can confirm that crisscross
  select(pID, cID, partner, COND, day,
         a_ppr1, p_ppr1,
         a_ppr2, p_ppr2,
         a_ppr3, p_ppr3,
         a_ppr4, p_ppr4,
         a_pa1, p_pa1,
         a_pa2, p_pa2,
         a_pa3, p_pa3,
         a_pa4, p_pa4,
         a_pa5, p_pa5,
         a_km1, p_km1,
         a_km4, p_km4,
         a_km5, p_km5,
         a_km6, p_km6,
         a_KMtot, p_KMtot,
         a_PPRtot, p_PPRtot
  )
#looks like that worked!

```


### Centering and Column Creating

##### Centering Add
Grand Mean Center Var: Captures variance of fluctuations, "How different is given score from sample?"
Within-Person/Person Centered Var: captures variance of fluctuations for a person, "How different is given score from person's average?" (this will capture the within-person variation)
Between-Person/Between Centered Var: variance of persons in the sample, "How different is THIS person from sample"? (this should be stable for each person--i.e. expect 14 of the same for each person. It'll function like an intercept, reflecting every person's "trait-like" variance)

```{r}
PairwiseF <- 
PairwiseF |> 
  group_by(pID) |> #create person-specific means 
  mutate(
    a_Fkm_pm = mean(a_Fkm, na.rm = T),
    p_Fkm_pm = mean(p_Fkm, na.rm = T),
    a_Fppr_pm = mean(a_Fppr, na.rm = T),
    p_Fppr_pm = mean(p_Fppr, na.rm = T)
  ) |> 
  ungroup() |> 
  mutate(
    #Create Grand-Mean Centered Vars (Score - grand mean: How different is given score from sample?)
    a_Fkm_GMC = scale(a_Fkm, center = T, scale = F),
    p_Fkm_GMC = scale(p_Fkm, center = T, scale = F),
    a_Fppr_GMC = scale(a_Fppr, center = T, scale = F),
    p_Fppr_GMC = scale(p_Fppr, center = T, scale = F),
    #Create Within-Person Centered Vars (Score - person mean score: How different is given score from person's average?)
    a_Fkm_WPC = a_Fkm - a_Fkm_pm,
    p_Fkm_WPC = p_Fkm - p_Fkm_pm,
    a_Fppr_WPC = a_Fppr - a_Fppr_pm,
    p_Fppr_WPC = p_Fppr - p_Fppr_pm,
    #Create Between-Person Centered Vars (GMC - WPC, equation as per Bolger & Laurenceau (2013): How different is person from sample?)
    a_Fkm_BPC = a_Fkm_GMC - a_Fkm_WPC,
    p_Fkm_BPC = p_Fkm_GMC - p_Fkm_WPC,
    a_Fppr_BPC = a_Fppr_GMC - a_Fppr_WPC,
    p_Fppr_BPC = p_Fppr_GMC - p_Fppr_WPC
    )
```

##### Previous Day Add
```{r}
PairwiseF <- 
PairwiseF |> 
  group_by(pID) |> 
  mutate(
    a_Fkm_WPC_prev = a_Fkm_WPC[match(day - 1, day)],
    p_Fkm_WPC_prev = p_Fkm_WPC[match(day - 1, day)],
    a_Fppr_WPC_prev = a_Fppr_WPC[match(day - 1, day)],
    p_Fppr_WPC_prev = p_Fppr_WPC[match(day - 1, day)]
  ) |> 
  ungroup()

```

### Visualizing the Period
This KM one is from above actually, but reminding here for the spread.
We see a very very slight downward trend, where people report less KM over time I reckon.
```{r}
ggplot(aes(x = day, y = a_KMtot), data = Pairwise) +
  ggdist::stat_halfeye(adjust = .3,  .width = -.5, justification = -.3) + #this is for the half-distribution
  labs(title = "KM Total Score Across Days",
       x = "",
       y = "Total KM Score (Out of 16)")
```

This PPR one is new :)
Little to no change in PPR over time, it appears
```{r}
ggplot(aes(x = day, y = a_PPRtot), data = Pairwise) +
  ggdist::stat_halfeye(adjust = .3,  .width = -.5, justification = -.3) + #this is for the half-distribution
  labs(title = "PPR Total Score Across Days",
       x = "",
       y = "Total PPR Score (Out of 24)")
```


### Modeling
#### RQ1: Intervention Effect, with new Factor vars
Intervention model, m.ivn, does not need re-doing since it is cross-sectional.

If needed to be re-done, can be like this (I think)
```{r}
#need to fit the same model as done in the diary study portion

#ran into some haven labeling issues. So making a temp dataframe with just relevant numerics 
o2 <- dfI_II |> 
  mutate(
    a_p2km1 = as.numeric(a_p2km1),
    a_p2km4 = as.numeric(a_p2km4),
    a_p2km5 = as.numeric(a_p2km5),
    a_p2km6 = as.numeric(a_p2km6)
    )
  
  
measure.m6C <- '
   #####################
  # MEASUREMENT MODEL #
  #####################

  # Factor models for km at 14 waves (Constrained)
  Fkm =~ a*a_p2km1 + d*a_p2km4 + e*a_p2km5 + f*a_p2km6

   # Constrained Intercepts over time (Strong invariance)
  a_p2km1  ~ k*1
  a_p2km4  ~ l*1
  a_p2km5  ~ m*1
  a_p2km6  ~ n*1
  
'

measure.m6C.fit <- cfa(measure.m6C,
    data = o2,
    std.lv = T,
    missing = "ML",
    )
summary(measure.m6C.fit, fit.measures = T, standardized =T, ci = T, rsquare = T)
```

```{r}
#create a similar id var to match upon
o3 <- as.data.frame(predict(measure.m6C.fit))
o3$id <- 1:nrow(o3)
o2$id <- 1:nrow(o2)

o2 <- o2 |>
  merge(o3, by.x = "id", by.y = "id", all.x = T)
#now added the Fkm var to the o2 df, which is just a copy of the dfI_II dataframe I used for the CFA above

```

##### KM Cross-Sectional Day-Of
```{r}
m.ivn2 <- lmer(Fkm ~ COND + (1| cID), data = o2)
summary(m.ivn2)
confint(m.ivn2)
```
Exact same pattern as in the observed vars model, which is good. The df and t value, and therefore the p-value, are almost the same actually. This means that the 4-item observed vars actually seem to hold up quite well to a latent-ized version. We may have been fine to use the total km score for the whole thing based off these data--they don't differ much. (hindsight 20/20, now we KNOW for sure whereas before I would be hedging my bets)

###### Visualize

```{r}
ggplot(aes(x = COND, y = Fkm), data = o2) +
  ggdist::stat_halfeye(adjust = .5, width = .3, .width = -.5, justification = -.3, point_colour = NA) + #this is for the half-distribution
  geom_boxplot(width = .1, outlier.shape = NA) +
  gghalves::geom_half_point(side = "l", range_scale = .4, alpha = .5) +
    labs(title = "KM by Condition",
       x = "",
       y = "Standardized Score")
```




##### KM Longitudinal
```{r}
m.ivnK <- lmer(a_Fkm ~ COND + day + a_Fkm_prev + (1| cID) + (1|pID), data = PairwiseF)
summary(m.ivnK)
```
Intervention is not impactful over time.
Interestingly, we see a slight day-decrease effect--as days go on, we see slightly less KM. Makes sense given the (very slightly downward) overall trend in a way

##### PPR
```{r}
m.ivnP <- lmer(a_Fppr ~ COND + day + a_Fppr_prev + (1| cID) + (1|pID), data = PairwiseF)
summary(m.ivnP)
```
No intervention effect on PPR over time either.
Interestingly, also a day effect. Here as time goes on, we see very slight increases to PPR (double-check the scaling--if the KM var is scaled to first item, technically PPR should be too in this interpretation)


#### RQ2: Lagged

##### Actor (replication) and Partner (extension)
1) is the, per respective PPR/KM outcome, KM <-> PPR effect present for actors?
2) Is the lagged respective effect present for actors?

3) is there, per respective for KM (PPR) outcome, a partner KM (PPR) effect?
4) is there, per respective for KM (PPR) outcome, a partner PPR (KM) effect?
5) is there, per respective for KM (PPR) outcome, a partner lagged KM (PPR) effect?
6) is there, per respective for KM (PPR) outcome) a partner lagged PPR (KM) effect?

###### KM Outcome
```{r}
m.km <- lmer(a_Fkm_WPC ~ COND + day + #standard controls
               a_Fkm_WPC_prev + p_Fkm_WPC_prev + #actor and partner previous outcome fluctuations
               a_Fppr_WPC_prev + p_Fppr_WPC_prev + #actor and partner previous predictor fluctuations
               a_Fkm_BPC + p_Fkm_BPC + #actor and partner outcome between person, stable trait-like influence
               a_Fppr_BPC + p_Fppr_BPC + #actor and partner predictor between person, stable trait-like influence
               (1| cID) + (1|pID), #Random effect structure
             control=lmerControl(optimizer = "bobyqa"),
             data = PairwiseF)
summary(m.km)
confint(m.km)
```

The issingular is, I think, from the lack of random effect variance. Basically we have so little variance there, in large part because I have already formally included a between-person (think random intercept) parameter in the model, so there's little left over for the random variance to parse out. 
I think we're fine, is the point.

###### PPR Outcome

```{r}
m.ppr <- lmer(a_Fppr_WPC ~ COND + day + #standard controls
               a_Fppr_WPC_prev + p_Fppr_WPC_prev + #actor and partner previous outcome fluctuations
               a_Fkm_WPC_prev + p_Fkm_WPC_prev + #actor and partner previous predictor fluctuations
               a_Fppr_BPC + p_Fppr_BPC + #actor and partner outcome between person, stable trait-like influence
               a_Fkm_BPC + p_Fkm_BPC + #actor and partner predictor between person, stable trait-like influence
               (1| cID) + (1|pID), #Random effect structure
             control=lmerControl(optimizer = "bobyqa"),
             data = PairwiseF)
summary(m.ppr)
confint(m.ppr)
```

#### RQ2: Correlation
```{r}
PairwiseF |> 
  select(a_Fkm_WPC, p_Fkm_WPC, a_Fppr_WPC, p_Fppr_WPC, a_Fkm_BPC, p_Fkm_BPC, a_Fppr_BPC, p_Fppr_BPC) |> 
  psych::pairs.panels(ci = T)
```

```{r}
PairwiseF |> 
  select(a_Fkm_WPC, p_Fkm_WPC, a_Fppr_WPC, p_Fppr_WPC) |> 
  psych::pairs.panels(ci = T)

cor.test(PairwiseF$a_Fkm_WPC, PairwiseF$p_Fkm_WPC, conf.level = .95)
cor.test(PairwiseF$a_Fkm_WPC, PairwiseF$a_Fppr_WPC, conf.level = .95)
cor.test(PairwiseF$a_Fkm_WPC, PairwiseF$p_Fppr_WPC, conf.level = .95)
cor.test(PairwiseF$a_Fppr_WPC, PairwiseF$p_Fppr_WPC, conf.level = .95)
```

```{r}
PairwiseF |> 
  select(a_Fkm_BPC, p_Fkm_BPC, a_Fppr_BPC, p_Fppr_BPC) |> 
  psych::pairs.panels(ci = T)

cor.test(PairwiseF$a_Fkm_BPC, PairwiseF$p_Fkm_BPC, conf.level = .95)
cor.test(PairwiseF$a_Fkm_BPC, PairwiseF$a_Fppr_BPC, conf.level = .95)
cor.test(PairwiseF$a_Fkm_BPC, PairwiseF$p_Fppr_BPC, conf.level = .95)
cor.test(PairwiseF$a_Fppr_BPC, PairwiseF$p_Fppr_BPC, conf.level = .95)
```
##### RQs and Answers
(Actor) Does KM <-> PPR per day?: Yes, r = .43 (VERY similar to S3, r = .498)
(Actor) Does KM predict PPR, or PPR predict KM?: No. My KM/PPR yesterday does not predict my PPR/KM today--same as S3 I believe
(Partner) Do couple's KM co-occur?: Yes, r = .25. Smaller degree than actors to actors, but still there
(Partner) Do couple's KM-PPR co-occur?: Yes, r = .15. Even smaller, but still (still) there
(Partner) Does partner's KM predict actors KM or PPR?: Yes. Partner KM predicts Actor PPR, but not Actor KM
(Partner) Does partner's PPR predict actors KM or PPR?: Yes. Partner PPR predicts Actor KM, but not Actor PPR

We have stability autoregressives within persons--my yesterday X impacts my today's X. But little to no actor spillover--my yesterday's x impacts my today's y. Instead we get partner spillover--my partner's x impacts my today's y. 

## Exploratory Condition Interaction
```{r}
m.kmInt <- lmer(a_Fkm_WPC ~ COND * day + #standard controls
               a_Fkm_WPC_prev + p_Fkm_WPC_prev + #actor and partner previous outcome fluctuations
               a_Fppr_WPC_prev + p_Fppr_WPC_prev + #actor and partner previous predictor fluctuations
               a_Fkm_BPC + p_Fkm_BPC + #actor and partner outcome between person, stable trait-like influence
               a_Fppr_BPC + p_Fppr_BPC + #actor and partner predictor between person, stable trait-like influence
               (1| cID) + (1|pID), #Random effect structure
             control=lmerControl(optimizer = "bobyqa"),
             data = PairwiseF)
summary(m.kmInt)
confint(m.kmInt)
```

Intervention interaction turns up here!


```{r}
ggplot(aes(x = day, y = a_KMtot), data = Pairwise) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") +
  scale_x_continuous(n.breaks = 14) +
  ylim(0,16) +
  labs(title = "KM Total Score Across Days",
       x = "",
       y = "Total KM Score (Out of 16)")

ggplot(aes(x = day, y = a_KMtot), data = Pairwise) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") +
  scale_x_continuous(n.breaks = 14) +
  labs(title = "KM Total Score Across Days",
       x = "",
       y = "Total KM Score (Out of 16)")
```



```{r}
ggplot(aes(x = day, y = a_KMtot, color = COND), data = Pairwise) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") +
  scale_x_continuous(n.breaks = 14) +
  labs(title = "KM Total Score Across Days",
       x = "",
       y = "Total KM Score (Out of 16)")

ggplot(aes(x = day, y = a_KMtot, color = COND), data = Pairwise) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") +
  scale_x_continuous(n.breaks = 14) +
  ylim(0,16) +
  labs(title = "KM Total Score Across Days",
       x = "",
       y = "Total KM Score (Out of 16)")
```


```{r}
ggplot(aes(x = day, y = a_Fkm_WPC, color = COND), data = PairwiseF) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") +
  scale_x_continuous(n.breaks = 14) +
  labs(title = "Latent WPC KM Across Days",
       x = "",
       y = "Latent KM Score")

ggplot(aes(x = day, y = a_Fkm_WPC, color = COND), data = PairwiseF) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") + #default is use CIs
  scale_x_continuous(n.breaks = 14) +
  ylim(-1,1) +
  labs(title = "Latent WPC KM Across Days",
       x = "",
       y = "Latent KM Score")
```


```{r}
m.pprInt <- lmer(a_Fppr_WPC ~ COND * day + #standard controls
               a_Fppr_WPC_prev + p_Fppr_WPC_prev + #actor and partner previous outcome fluctuations
               a_Fkm_WPC_prev + p_Fkm_WPC_prev + #actor and partner previous predictor fluctuations
               a_Fppr_BPC + p_Fppr_BPC + #actor and partner outcome between person, stable trait-like influence
               a_Fkm_BPC + p_Fkm_BPC + #actor and partner predictor between person, stable trait-like influence
               (1| cID) + (1|pID), #Random effect structure
             control=lmerControl(optimizer = "bobyqa"),
             data = PairwiseF)
summary(m.pprInt)
confint(m.pprInt)
```
No interaction effect with PPR though! Thats WEIRD

```{r}
ggplot(aes(x = day, y = a_PPRtot, color = COND), data = Pairwise) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") +
  scale_x_continuous(n.breaks = 14) +
  labs(title = "PPR Total Score Across Days",
       x = "",
       y = "Total PPR Score (Out of 16)")

ggplot(aes(x = day, y = a_PPRtot, color = COND), data = Pairwise) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") +
  scale_x_continuous(n.breaks = 14) +
  ylim(0,16) +
  labs(title = "PPR Total Score Across Days",
       x = "",
       y = "Total PPR Score (Out of 16)")
```


```{r}
ggplot(aes(x = day, y = a_Fppr_WPC, color = COND), data = PairwiseF) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") +
  scale_x_continuous(n.breaks = 14) +
  labs(title = "Latent WPC PPR Across Days",
       x = "",
       y = "Latent PPR Score")

ggplot(aes(x = day, y = a_Fppr_WPC, color = COND), data = PairwiseF) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") +
  scale_x_continuous(n.breaks = 14) +
  ylim(-1,1) +
  labs(title = "Latent WPC PPR Across Days",
       x = "",
       y = "Latent PPR Score")
```

```{r}
p1 <-  ggplot(aes(x = day, y = a_Fkm_WPC, color = COND), data = PairwiseF) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") +
  scale_x_continuous(n.breaks = 14) +
  ylim(-1,1) +
  labs(title = "KM Across Period",
       x = "",
       y = "WPC KM Score")
p2 <- ggplot(aes(x = day, y = a_Fppr_WPC, color = COND), data = PairwiseF) +
  stat_summary(fun.data = "mean_cl_boot", position = position_dodge(width = .1)) + #Mean Standard error from bootstrap
  geom_smooth(method = "lm") +
  scale_x_continuous(n.breaks = 14) +
  ylim(-1,1) +
  labs(title = "PPR Across Period",
       x = "",
       y = "WPC PPR Score")

grid.arrange(p1,p2, nrow = 2)
```


## Exploratory Condition + Gender Interaction
```{r}
o4 <- dfI_II |> 
  select(pID, cID, a_gend) |>
  merge(PairwiseF, by.x = c("pID","cID"), by.y = c("pID", "cID"), all.x = T)
o4$a_gend <- fct_relevel(o4$a_gend, "Woman") #relevel to woman baseline--most theoretically important.
contrasts(o4$a_gend) #just to confrim releveling to woman


m.kmIntGen <- lmer(a_Fkm_WPC ~ COND * day + #standard controls
               a_Fkm_WPC_prev + p_Fkm_WPC_prev + #actor and partner previous outcome fluctuations
               a_Fppr_WPC_prev + p_Fppr_WPC_prev + #actor and partner previous predictor fluctuations
               a_Fkm_BPC + p_Fkm_BPC + #actor and partner outcome between person, stable trait-like influence
               a_Fppr_BPC + p_Fppr_BPC + #actor and partner predictor between person, stable trait-like influence
                 a_gend + #Gender Covariate
               (1| cID) + (1|pID), #Random effect structure
             control=lmerControl(optimizer = "bobyqa"),
             data = o4)
summary(m.kmIntGen)
confint(m.kmIntGen)
```


```{r}
o4 <- dfI_II |> 
  select(pID, cID, a_gend) |>
  merge(PairwiseF, by.x = c("pID","cID"), by.y = c("pID", "cID"), all.x = T)
o4$a_gend <- fct_relevel(o4$a_gend, "Woman") #relevel to woman baseline--most theoretically important.
contrasts(o4$a_gend) #just to confrim releveling to woman

m.pprIntGen <- lmer(a_Fppr_WPC ~ COND * day + #standard controls
               a_Fppr_WPC_prev + p_Fppr_WPC_prev + #actor and partner previous outcome fluctuations
               a_Fkm_WPC_prev + p_Fkm_WPC_prev + #actor and partner previous predictor fluctuations
               a_Fppr_BPC + p_Fppr_BPC + #actor and partner outcome between person, stable trait-like influence
               a_Fkm_BPC + p_Fkm_BPC + #actor and partner predictor between person, stable trait-like influence
                 a_gend +
               (1| cID) + (1|pID), #Random effect structure
             control=lmerControl(optimizer = "bobyqa"),
             data = o4)
summary(m.pprIntGen)
confint(m.pprIntGen)
```
No gender effects turning up here for either PPR nor KM!


## For Funsies (PPR Model eval)
Skipping straight to strong, b/c it holds in the previous models
```{r}
ppr.m3 <- '
   #####################
  # MEASUREMENT MODEL #
  #####################

   # Factor models for ppr at 14 waves (Constrained)
  Fppr1 =~ g*ppr1_t1 + h*ppr2_t1 + i*ppr3_t1 + j*ppr4_t1
  Fppr2 =~ g*ppr1_t2 + h*ppr2_t2 + i*ppr3_t2 + j*ppr4_t2
  Fppr3 =~ g*ppr1_t3 + h*ppr2_t3 + i*ppr3_t3 + j*ppr4_t3
  Fppr4 =~ g*ppr1_t4 + h*ppr2_t4 + i*ppr3_t4 + j*ppr4_t4
  Fppr5 =~ g*ppr1_t5 + h*ppr2_t5 + i*ppr3_t5 + j*ppr4_t5
  Fppr6 =~ g*ppr1_t6 + h*ppr2_t6 + i*ppr3_t6 + j*ppr4_t6
  Fppr7 =~ g*ppr1_t7 + h*ppr2_t7 + i*ppr3_t7 + j*ppr4_t7
  Fppr8 =~ g*ppr1_t8 + h*ppr2_t8 + i*ppr3_t8 + j*ppr4_t8
  Fppr9 =~ g*ppr1_t9 + h*ppr2_t9 + i*ppr3_t9 + j*ppr4_t9
  Fppr10 =~ g*ppr1_t10 + h*ppr2_t10 + i*ppr3_t10 + j*ppr4_t10
  Fppr11 =~ g*ppr1_t11 + h*ppr2_t11 + i*ppr3_t11 + j*ppr4_t11
  Fppr12 =~ g*ppr1_t12 + h*ppr2_t12 + i*ppr3_t12 + j*ppr4_t12
  Fppr13 =~ g*ppr1_t13 + h*ppr2_t13 + i*ppr3_t13 + j*ppr4_t13
  Fppr14 =~ g*ppr1_t14 + h*ppr2_t14 + i*ppr3_t14 + j*ppr4_t14
  
  ppr1_t1 + ppr1_t2 + ppr1_t3 + ppr1_t4 + ppr1_t5 + ppr1_t6 + ppr1_t7 + ppr1_t8 + ppr1_t9 + ppr1_t10 + ppr1_t11 + ppr1_t12 + ppr1_t13 + ppr1_t14 ~ o*1
  ppr2_t1 + ppr2_t2 + ppr2_t3 + ppr2_t4 + ppr2_t5 + ppr2_t6 + ppr2_t7 + ppr2_t8 + ppr2_t9 + ppr2_t10 + ppr2_t11 + ppr2_t12 + ppr2_t13 + ppr2_t14 ~ p*1
  ppr3_t1 + ppr3_t2 + ppr3_t3 + ppr3_t4 + ppr3_t5 + ppr3_t6 + ppr3_t7 + ppr3_t8 + ppr3_t9 + ppr3_t10 + ppr3_t11 + ppr3_t12 + ppr3_t13 + ppr3_t14 ~ q*1
  ppr4_t1 + ppr4_t2 + ppr4_t3 + ppr4_t4 + ppr4_t5 + ppr4_t6 + ppr4_t7 + ppr4_t8 + ppr4_t9 + ppr4_t10 + ppr4_t11 + ppr4_t12 + ppr4_t13 + ppr4_t14 ~ r*1
  
'

ppr.m3.fit <- cfa(ppr.m3,
    data = dfSEM,
    std.lv = F,
    missing = "ML",
    )
summary(ppr.m3.fit, fit.measures = T, standardized =T, ci = T) #its the fit measures that take forever to cycle
```
This is a great PPR measure, just as a heads up! It's the KM measure that is wobbly (but not by a lot) that kicks down the complete measurement model I'm working with












































 
## DEPRECATED
###  Reworking to wide format

Taking just what we need. It will be a large dataset
```{r}
#Keeping PA

#selecting what is needed
dfSEM <- df |>
  select(!c(pID,Partner:PPRtot)) #keeping in the PA for now. Might remove later if too complicated

#expanding the daily data wider
dfSEM <- dfSEM |> 
  pivot_wider(
    names_from = "day",
    names_prefix = "t",
    values_from = c("ppr1", "ppr2", "ppr3", "ppr4",
                    "pa1", "pa2", "pa3","pa4", "pa5", #keeping in the PA for now. Might remove later if too complicated
                    "km1", "km2", "km3", "km4", "km5", "km6",)
  )

#expanding the partner data wider
dfSEM <-dfSEM |> 
  pivot_wider(
    names_from = partner,
    values_from = c(4:213),
    names_glue = "{partner}{.value}" #need this format to match with the naming scheme used in the SEM code 
  )
  
```

might need to make numeric versions of the variables. Currently havenlabelled, which is tricky for some functions (e.g. predict) to use
```{r}
class(as.numeric(dfSEM$Appr1_t1)) #that seems to work at least
```



As per pre-reg, I think I need to standardize these ahead of time?
```{r}

```


### Testing KM Measurement
Add in the km2 and 3 for testing
```{r}
km.m <- '
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Unconstrained)
  AFkm1 =~ Akm1_t1 + Akm2_t1 + Akm3_t1 + Akm4_t1 + Akm5_t1 + Akm6_t1
  AFkm2 =~ Akm1_t2 + Akm2_t2 + Akm3_t2 + Akm4_t2 + Akm5_t2 + Akm6_t2
  AFkm3 =~ Akm1_t3 + Akm2_t3 + Akm3_t3 + Akm4_t3 + Akm5_t3 + Akm6_t3
  AFkm4 =~ Akm1_t4 + Akm2_t4 + Akm3_t4 + Akm4_t4 + Akm5_t4 + Akm6_t4
  AFkm5 =~ Akm1_t5 + Akm2_t5 + Akm3_t5 + Akm4_t5 + Akm5_t5 + Akm6_t5
  AFkm6 =~ Akm1_t6 + Akm2_t6 + Akm3_t6 + Akm4_t6 + Akm5_t6 + Akm6_t6
  AFkm7 =~ Akm1_t7 + Akm2_t7 + Akm3_t7 + Akm4_t7 + Akm5_t7 + Akm6_t7
  AFkm8 =~ Akm1_t8 + Akm2_t8 + Akm3_t8 + Akm4_t8 + Akm5_t8 + Akm6_t8
  AFkm9 =~ Akm1_t9 + Akm2_t9 + Akm3_t9 + Akm4_t9 + Akm5_t9 + Akm6_t9
  AFkm10 =~ Akm1_t10 + Akm2_t10 + Akm3_t10 + Akm4_t10 + Akm5_t10 + Akm6_t10
  AFkm11 =~ Akm1_t11 + Akm2_t11 + Akm3_t11 + Akm4_t11 + Akm5_t11 + Akm6_t11
  AFkm12 =~ Akm1_t12 + Akm2_t12 + Akm3_t12 + Akm4_t12 + Akm5_t12 + Akm6_t12
  AFkm13 =~ Akm1_t13 + Akm2_t13 + Akm3_t13 + Akm4_t13 + Akm5_t13 + Akm6_t13
  AFkm14 =~ Akm1_t14 + Akm2_t14 + Akm3_t14 + Akm4_t14 + Akm5_t14 + Akm6_t14
  
  # Factor models for km at 14 waves (Unconstrained)
  BFkm1 =~ Bkm1_t1 + Bkm2_t1 + Bkm3_t1 + Bkm4_t1 + Bkm5_t1 + Bkm6_t1
  BFkm2 =~ Bkm1_t2 + Bkm2_t2 + Bkm3_t2 + Bkm4_t2 + Bkm5_t2 + Bkm6_t2
  BFkm3 =~ Bkm1_t3 + Bkm2_t3 + Bkm3_t3 + Bkm4_t3 + Bkm5_t3 + Bkm6_t3
  BFkm4 =~ Bkm1_t4 + Bkm2_t4 + Bkm3_t4 + Bkm4_t4 + Bkm5_t4 + Bkm6_t4
  BFkm5 =~ Bkm1_t5 + Bkm2_t5 + Bkm3_t5 + Bkm4_t5 + Bkm5_t5 + Bkm6_t5
  BFkm6 =~ Bkm1_t6 + Bkm2_t6 + Bkm3_t6 + Bkm4_t6 + Bkm5_t6 + Bkm6_t6
  BFkm7 =~ Bkm1_t7 + Bkm2_t7 + Bkm3_t7 + Bkm4_t7 + Bkm5_t7 + Bkm6_t7
  BFkm8 =~ Bkm1_t8 + Bkm2_t8 + Bkm3_t8 + Bkm4_t8 + Bkm5_t8 + Bkm6_t8
  BFkm9 =~ Bkm1_t9 + Bkm2_t9 + Bkm3_t9 + Bkm4_t9 + Bkm5_t9 + Bkm6_t9
  BFkm10 =~ Bkm1_t10 + Bkm2_t10 + Bkm3_t10 + Bkm4_t10 + Bkm5_t10 + Bkm6_t10
  BFkm11 =~ Bkm1_t11 + Bkm2_t11 + Bkm3_t11 + Bkm4_t11 + Bkm5_t11 + Bkm6_t11
  BFkm12 =~ Bkm1_t12 + Bkm2_t12 + Bkm3_t12 + Bkm4_t12 + Bkm5_t12 + Bkm6_t12
  BFkm13 =~ Bkm1_t13 + Bkm2_t13 + Bkm3_t13 + Bkm4_t13 + Bkm5_t13 + Bkm6_t13
  BFkm14 =~ Bkm1_t14 + Bkm2_t14 + Bkm3_t14 + Bkm4_t14 + Bkm5_t14 + Bkm6_t14

'

km.m.fit <- cfa(km.m,
                   data = dfSEM,
                   std.lv = T,
                   missing = "ML"
                   )
summary(km.m.fit, fit.measures = T, standardized =T, ci = T)
```
Doesn't work since it's overidenfitified. I think I NEED the weak constraints to estimate ANYTHING in these models. Adding the partner means, when freely estimated, the model has to make double the amount of estimates.

```{r}
km.m2 <- '
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Unconstrained)
  AFkm1 =~ a*Akm1_t1 + b*Akm2_t1 + c*Akm3_t1 + d*Akm4_t1 + e*Akm5_t1 + f*Akm6_t1
  AFkm2 =~ a*Akm1_t2 + b*Akm2_t2 + c*Akm3_t2 + d*Akm4_t2 + e*Akm5_t2 + f*Akm6_t2
  AFkm3 =~ a*Akm1_t3 + b*Akm2_t3 + c*Akm3_t3 + d*Akm4_t3 + e*Akm5_t3 + f*Akm6_t3
  AFkm4 =~ a*Akm1_t4 + b*Akm2_t4 + c*Akm3_t4 + d*Akm4_t4 + e*Akm5_t4 + f*Akm6_t4
  AFkm5 =~ a*Akm1_t5 + b*Akm2_t5 + c*Akm3_t5 + d*Akm4_t5 + e*Akm5_t5 + f*Akm6_t5
  AFkm6 =~ a*Akm1_t6 + b*Akm2_t6 + c*Akm3_t6 + d*Akm4_t6 + e*Akm5_t6 + f*Akm6_t6
  AFkm7 =~ a*Akm1_t7 + b*Akm2_t7 + c*Akm3_t7 + d*Akm4_t7 + e*Akm5_t7 + f*Akm6_t7
  AFkm8 =~ a*Akm1_t8 + b*Akm2_t8 + c*Akm3_t8 + d*Akm4_t8 + e*Akm5_t8 + f*Akm6_t8
  AFkm9 =~ a*Akm1_t9 + b*Akm2_t9 + c*Akm3_t9 + d*Akm4_t9 + e*Akm5_t9 + f*Akm6_t9
  AFkm10 =~ a*Akm1_t10 + b*Akm2_t10 + c*Akm3_t10 + d*Akm4_t10 + e*Akm5_t10 + f*Akm6_t10
  AFkm11 =~ a*Akm1_t11 + b*Akm2_t11 + c*Akm3_t11 + d*Akm4_t11 + e*Akm5_t11 + f*Akm6_t11
  AFkm12 =~ a*Akm1_t12 + b*Akm2_t12 + c*Akm3_t12 + d*Akm4_t12 + e*Akm5_t12 + f*Akm6_t12
  AFkm13 =~ a*Akm1_t13 + b*Akm2_t13 + c*Akm3_t13 + d*Akm4_t13 + e*Akm5_t13 + f*Akm6_t13
  AFkm14 =~ a*Akm1_t14 + b*Akm2_t14 + c*Akm3_t14 + d*Akm4_t14 + e*Akm5_t14 + f*Akm6_t14
  
  # Factor models for km at 14 waves (Unconstrained)
  BFkm1 =~ a*Bkm1_t1 + b*Bkm2_t1 + c*Bkm3_t1 + d*Bkm4_t1 + e*Bkm5_t1 + f*Bkm6_t1
  BFkm2 =~ a*Bkm1_t2 + b*Bkm2_t2 + c*Bkm3_t2 + d*Bkm4_t2 + e*Bkm5_t2 + f*Bkm6_t2
  BFkm3 =~ a*Bkm1_t3 + b*Bkm2_t3 + c*Bkm3_t3 + d*Bkm4_t3 + e*Bkm5_t3 + f*Bkm6_t3
  BFkm4 =~ a*Bkm1_t4 + b*Bkm2_t4 + c*Bkm3_t4 + d*Bkm4_t4 + e*Bkm5_t4 + f*Bkm6_t4
  BFkm5 =~ a*Bkm1_t5 + b*Bkm2_t5 + c*Bkm3_t5 + d*Bkm4_t5 + e*Bkm5_t5 + f*Bkm6_t5
  BFkm6 =~ a*Bkm1_t6 + b*Bkm2_t6 + c*Bkm3_t6 + d*Bkm4_t6 + e*Bkm5_t6 + f*Bkm6_t6
  BFkm7 =~ a*Bkm1_t7 + b*Bkm2_t7 + c*Bkm3_t7 + d*Bkm4_t7 + e*Bkm5_t7 + f*Bkm6_t7
  BFkm8 =~ a*Bkm1_t8 + b*Bkm2_t8 + c*Bkm3_t8 + d*Bkm4_t8 + e*Bkm5_t8 + f*Bkm6_t8
  BFkm9 =~ a*Bkm1_t9 + b*Bkm2_t9 + c*Bkm3_t9 + d*Bkm4_t9 + e*Bkm5_t9 + f*Bkm6_t9
  BFkm10 =~ a*Bkm1_t10 + b*Bkm2_t10 + c*Bkm3_t10 + d*Bkm4_t10 + e*Bkm5_t10 + f*Bkm6_t10
  BFkm11 =~ a*Bkm1_t11 + b*Bkm2_t11 + c*Bkm3_t11 + d*Bkm4_t11 + e*Bkm5_t11 + f*Bkm6_t11
  BFkm12 =~ a*Bkm1_t12 + b*Bkm2_t12 + c*Bkm3_t12 + d*Bkm4_t12 + e*Bkm5_t12 + f*Bkm6_t12
  BFkm13 =~ a*Bkm1_t13 + b*Bkm2_t13 + c*Bkm3_t13 + d*Bkm4_t13 + e*Bkm5_t13 + f*Bkm6_t13
  BFkm14 =~ a*Bkm1_t14 + b*Bkm2_t14 + c*Bkm3_t14 + d*Bkm4_t14 + e*Bkm5_t14 + Bkm6_t14

'

km.m2.fit <- cfa(km.m2,
                   data = dfSEM,
                   std.lv = T,
                   missing = "ML"
                   )
summary(km.m2.fit, fit.measures = T, standardized =T, ci = T)
```
Also some issues here^

Just to see the main measurment, which should be the same for both individuals, lets cut down to just person A. Can then test in person B
```{r}
km.m2 <- '
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Unconstrained)
  AFkm1 =~ a*Akm1_t1 + b*Akm2_t1 + c*Akm3_t1 + d*Akm4_t1 + e*Akm5_t1 + f*Akm6_t1
  AFkm2 =~ a*Akm1_t2 + b*Akm2_t2 + c*Akm3_t2 + d*Akm4_t2 + e*Akm5_t2 + f*Akm6_t2
  AFkm3 =~ a*Akm1_t3 + b*Akm2_t3 + c*Akm3_t3 + d*Akm4_t3 + e*Akm5_t3 + f*Akm6_t3
  AFkm4 =~ a*Akm1_t4 + b*Akm2_t4 + c*Akm3_t4 + d*Akm4_t4 + e*Akm5_t4 + f*Akm6_t4
  AFkm5 =~ a*Akm1_t5 + b*Akm2_t5 + c*Akm3_t5 + d*Akm4_t5 + e*Akm5_t5 + f*Akm6_t5
  AFkm6 =~ a*Akm1_t6 + b*Akm2_t6 + c*Akm3_t6 + d*Akm4_t6 + e*Akm5_t6 + f*Akm6_t6
  AFkm7 =~ a*Akm1_t7 + b*Akm2_t7 + c*Akm3_t7 + d*Akm4_t7 + e*Akm5_t7 + f*Akm6_t7
  AFkm8 =~ a*Akm1_t8 + b*Akm2_t8 + c*Akm3_t8 + d*Akm4_t8 + e*Akm5_t8 + f*Akm6_t8
  AFkm9 =~ a*Akm1_t9 + b*Akm2_t9 + c*Akm3_t9 + d*Akm4_t9 + e*Akm5_t9 + f*Akm6_t9
  AFkm10 =~ a*Akm1_t10 + b*Akm2_t10 + c*Akm3_t10 + d*Akm4_t10 + e*Akm5_t10 + f*Akm6_t10
  AFkm11 =~ a*Akm1_t11 + b*Akm2_t11 + c*Akm3_t11 + d*Akm4_t11 + e*Akm5_t11 + f*Akm6_t11
  AFkm12 =~ a*Akm1_t12 + b*Akm2_t12 + c*Akm3_t12 + d*Akm4_t12 + e*Akm5_t12 + f*Akm6_t12
  AFkm13 =~ a*Akm1_t13 + b*Akm2_t13 + c*Akm3_t13 + d*Akm4_t13 + e*Akm5_t13 + f*Akm6_t13
  AFkm14 =~ a*Akm1_t14 + b*Akm2_t14 + c*Akm3_t14 + d*Akm4_t14 + e*Akm5_t14 + f*Akm6_t14
  
'

km.m2.fit <- cfa(km.m2,
                   data = dfSEM,
                   std.lv = T,
                   missing = "ML"
                   ) #estimator MLR does not seem to work
summary(km.m2.fit, fit.measures = T, standardized =T, ci = T)
```
Yeah items 2 and 3 again look weak for the KM factor


```{r}
km.m3 <- '
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Unconstrained)
  AFkm1 =~ a*Akm1_t1 + d*Akm4_t1 + e*Akm5_t1 + f*Akm6_t1
  AFkm2 =~ a*Akm1_t2 + d*Akm4_t2 + e*Akm5_t2 + f*Akm6_t2
  AFkm3 =~ a*Akm1_t3 + d*Akm4_t3 + e*Akm5_t3 + f*Akm6_t3
  AFkm4 =~ a*Akm1_t4 + d*Akm4_t4 + e*Akm5_t4 + f*Akm6_t4
  AFkm5 =~ a*Akm1_t5 + d*Akm4_t5 + e*Akm5_t5 + f*Akm6_t5
  AFkm6 =~ a*Akm1_t6 + d*Akm4_t6 + e*Akm5_t6 + f*Akm6_t6
  AFkm7 =~ a*Akm1_t7 + d*Akm4_t7 + e*Akm5_t7 + f*Akm6_t7
  AFkm8 =~ a*Akm1_t8 + d*Akm4_t8 + e*Akm5_t8 + f*Akm6_t8
  AFkm9 =~ a*Akm1_t9 + d*Akm4_t9 + e*Akm5_t9 + f*Akm6_t9
  AFkm10 =~ a*Akm1_t10 + d*Akm4_t10 + e*Akm5_t10 + f*Akm6_t10
  AFkm11 =~ a*Akm1_t11 + d*Akm4_t11 + e*Akm5_t11 + f*Akm6_t11
  AFkm12 =~ a*Akm1_t12 + d*Akm4_t12 + e*Akm5_t12 + f*Akm6_t12
  AFkm13 =~ a*Akm1_t13 + d*Akm4_t13 + e*Akm5_t13 + f*Akm6_t13
  AFkm14 =~ a*Akm1_t14 + d*Akm4_t14 + e*Akm5_t14 + f*Akm6_t14

'

km.m3.fit <- cfa(km.m3,
                   data = dfSEM,
                   std.lv = T,
                   missing = "ML",
                   )
summary(km.m3.fit, fit.measures = T, standardized =T, ci = T)
```

```{r}
km.m4 <- '
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Unconstrained)
  AFkm1 =~ a*Akm1_t1 + d*Akm4_t1 + e*Akm5_t1 + f*Akm6_t1
  AFkm2 =~ a*Akm1_t2 + d*Akm4_t2 + e*Akm5_t2 + f*Akm6_t2
  AFkm3 =~ a*Akm1_t3 + d*Akm4_t3 + e*Akm5_t3 + f*Akm6_t3
  AFkm4 =~ a*Akm1_t4 + d*Akm4_t4 + e*Akm5_t4 + f*Akm6_t4
  AFkm5 =~ a*Akm1_t5 + d*Akm4_t5 + e*Akm5_t5 + f*Akm6_t5
  AFkm6 =~ a*Akm1_t6 + d*Akm4_t6 + e*Akm5_t6 + f*Akm6_t6
  AFkm7 =~ a*Akm1_t7 + d*Akm4_t7 + e*Akm5_t7 + f*Akm6_t7
  AFkm8 =~ a*Akm1_t8 + d*Akm4_t8 + e*Akm5_t8 + f*Akm6_t8
  AFkm9 =~ a*Akm1_t9 + d*Akm4_t9 + e*Akm5_t9 + f*Akm6_t9
  AFkm10 =~ a*Akm1_t10 + d*Akm4_t10 + e*Akm5_t10 + f*Akm6_t10
  AFkm11 =~ a*Akm1_t11 + d*Akm4_t11 + e*Akm5_t11 + f*Akm6_t11
  AFkm12 =~ a*Akm1_t12 + d*Akm4_t12 + e*Akm5_t12 + f*Akm6_t12
  AFkm13 =~ a*Akm1_t13 + d*Akm4_t13 + e*Akm5_t13 + f*Akm6_t13
  AFkm14 =~ a*Akm1_t14 + d*Akm4_t14 + e*Akm5_t14 + f*Akm6_t14
  
  # Factor models for km at 14 waves (Unconstrained)
  BFkm1 =~ a*Bkm1_t1 + d*Bkm4_t1 + e*Bkm5_t1 + f*Bkm6_t1
  BFkm2 =~ a*Bkm1_t2 + d*Bkm4_t2 + e*Bkm5_t2 + f*Bkm6_t2
  BFkm3 =~ a*Bkm1_t3 + d*Bkm4_t3 + e*Bkm5_t3 + f*Bkm6_t3
  BFkm4 =~ a*Bkm1_t4 + d*Bkm4_t4 + e*Bkm5_t4 + f*Bkm6_t4
  BFkm5 =~ a*Bkm1_t5 + d*Bkm4_t5 + e*Bkm5_t5 + f*Bkm6_t5
  BFkm6 =~ a*Bkm1_t6 + d*Bkm4_t6 + e*Bkm5_t6 + f*Bkm6_t6
  BFkm7 =~ a*Bkm1_t7 + d*Bkm4_t7 + e*Bkm5_t7 + f*Bkm6_t7
  BFkm8 =~ a*Bkm1_t8 + d*Bkm4_t8 + e*Bkm5_t8 + f*Bkm6_t8
  BFkm9 =~ a*Bkm1_t9 + d*Bkm4_t9 + e*Bkm5_t9 + f*Bkm6_t9
  BFkm10 =~ a*Bkm1_t10 + d*Bkm4_t10 + e*Bkm5_t10 + f*Bkm6_t10
  BFkm11 =~ a*Bkm1_t11 + d*Bkm4_t11 + e*Bkm5_t11 + f*Bkm6_t11
  BFkm12 =~ a*Bkm1_t12 + d*Bkm4_t12 + e*Bkm5_t12 + f*Bkm6_t12
  BFkm13 =~ a*Bkm1_t13 + d*Bkm4_t13 + e*Bkm5_t13 + f*Bkm6_t13
  BFkm14 =~ a*Bkm1_t14 + d*Bkm4_t14 + e*Bkm5_t14 + f*Bkm6_t14

'

km.m4.fit <- cfa(km.m4,
                   data = dfSEM,
                   std.lv = T,
                   missing = "ML",
                   )
summary(km.m4.fit, standardized =T, ci = T) #its the fit measures that take forever to cycle
```
if needing to extract these, it should be $predict
```{r}
#predict(km.m4.fit)
```

### Testing PPR Measurment
So the above model doesnt seem to work. Is it the two-person in a row differentiation? Or because the KM measure is just fussy?
PPR should help distinguish those
```{r}
ppr.m1 <- '

  # Factor models for ppr at 14 waves (Constrained)
  AFppr1 =~ g*Appr1_t1 + h*Appr2_t1 + i*Appr3_t1 + j*Appr4_t1
  AFppr2 =~ g*Appr1_t2 + h*Appr2_t2 + i*Appr3_t2 + j*Appr4_t2
  AFppr3 =~ g*Appr1_t3 + h*Appr2_t3 + i*Appr3_t3 + j*Appr4_t3
  AFppr4 =~ g*Appr1_t4 + h*Appr2_t4 + i*Appr3_t4 + j*Appr4_t4
  AFppr5 =~ g*Appr1_t5 + h*Appr2_t5 + i*Appr3_t5 + j*Appr4_t5
  AFppr6 =~ g*Appr1_t6 + h*Appr2_t6 + i*Appr3_t6 + j*Appr4_t6
  AFppr7 =~ g*Appr1_t7 + h*Appr2_t7 + i*Appr3_t7 + j*Appr4_t7
  AFppr8 =~ g*Appr1_t8 + h*Appr2_t8 + i*Appr3_t8 + j*Appr4_t8
  AFppr9 =~ g*Appr1_t9 + h*Appr2_t9 + i*Appr3_t9 + j*Appr4_t9
  AFppr10 =~ g*Appr1_t10 + h*Appr2_t10 + i*Appr3_t10 + j*Appr4_t10
  AFppr11 =~ g*Appr1_t11 + h*Appr2_t11 + i*Appr3_t11 + j*Appr4_t11
  AFppr12 =~ g*Appr1_t12 + h*Appr2_t12 + i*Appr3_t12 + j*Appr4_t12
  AFppr13 =~ g*Appr1_t13 + h*Appr2_t13 + i*Appr3_t13 + j*Appr4_t13
  AFppr14 =~ g*Appr1_t14 + h*Appr2_t14 + i*Appr3_t14 + j*Appr4_t14

  # Factor models for ppr at 14 waves (Constrained)
  BFppr1 =~ g*Bppr1_t1 + h*Bppr2_t1 + i*Bppr3_t1 + j*Bppr4_t1
  BFppr2 =~ g*Bppr1_t2 + h*Bppr2_t2 + i*Bppr3_t2 + j*Bppr4_t2
  BFppr3 =~ g*Bppr1_t3 + h*Bppr2_t3 + i*Bppr3_t3 + j*Bppr4_t3
  BFppr4 =~ g*Bppr1_t4 + h*Bppr2_t4 + i*Bppr3_t4 + j*Bppr4_t4
  BFppr5 =~ g*Bppr1_t5 + h*Bppr2_t5 + i*Bppr3_t5 + j*Bppr4_t5
  BFppr6 =~ g*Bppr1_t6 + h*Bppr2_t6 + i*Bppr3_t6 + j*Bppr4_t6
  BFppr7 =~ g*Bppr1_t7 + h*Bppr2_t7 + i*Bppr3_t7 + j*Bppr4_t7
  BFppr8 =~ g*Bppr1_t8 + h*Bppr2_t8 + i*Bppr3_t8 + j*Bppr4_t8
  BFppr9 =~ g*Bppr1_t9 + h*Bppr2_t9 + i*Bppr3_t9 + j*Bppr4_t9
  BFppr10 =~ g*Bppr1_t10 + h*Bppr2_t10 + i*Bppr3_t10 + j*Bppr4_t10
  BFppr11 =~ g*Bppr1_t11 + h*Bppr2_t11 + i*Bppr3_t11 + j*Bppr4_t11
  BFppr12 =~ g*Bppr1_t12 + h*Bppr2_t12 + i*Bppr3_t12 + j*Bppr4_t12
  BFppr13 =~ g*Bppr1_t13 + h*Bppr2_t13 + i*Bppr3_t13 + j*Bppr4_t13
  BFppr14 =~ g*Bppr1_t14 + h*Bppr2_t14 + i*Bppr3_t14 + j*Bppr4_t14

'

ppr.m1.fit <- cfa(ppr.m1,
    data = dfSEM,
    std.lv = T,
    missing = "ML",
    )
summary(ppr.m1.fit, standardized =T, ci = T) #its the fit measures that take forever to cycle
```

Just trying a single person latent variable
```{r}
ppr.m2 <- '

  # Factor models for ppr at 14 waves (Constrained)
  AFppr1 =~ g*Appr1_t1 + h*Appr2_t1 + i*Appr3_t1 + j*Appr4_t1
  AFppr2 =~ g*Appr1_t2 + h*Appr2_t2 + i*Appr3_t2 + j*Appr4_t2
  AFppr3 =~ g*Appr1_t3 + h*Appr2_t3 + i*Appr3_t3 + j*Appr4_t3
  AFppr4 =~ g*Appr1_t4 + h*Appr2_t4 + i*Appr3_t4 + j*Appr4_t4
  AFppr5 =~ g*Appr1_t5 + h*Appr2_t5 + i*Appr3_t5 + j*Appr4_t5
  AFppr6 =~ g*Appr1_t6 + h*Appr2_t6 + i*Appr3_t6 + j*Appr4_t6
  AFppr7 =~ g*Appr1_t7 + h*Appr2_t7 + i*Appr3_t7 + j*Appr4_t7
  AFppr8 =~ g*Appr1_t8 + h*Appr2_t8 + i*Appr3_t8 + j*Appr4_t8
  AFppr9 =~ g*Appr1_t9 + h*Appr2_t9 + i*Appr3_t9 + j*Appr4_t9
  AFppr10 =~ g*Appr1_t10 + h*Appr2_t10 + i*Appr3_t10 + j*Appr4_t10
  AFppr11 =~ g*Appr1_t11 + h*Appr2_t11 + i*Appr3_t11 + j*Appr4_t11
  AFppr12 =~ g*Appr1_t12 + h*Appr2_t12 + i*Appr3_t12 + j*Appr4_t12
  AFppr13 =~ g*Appr1_t13 + h*Appr2_t13 + i*Appr3_t13 + j*Appr4_t13
  AFppr14 =~ g*Appr1_t14 + h*Appr2_t14 + i*Appr3_t14 + j*Appr4_t14

'

ppr.m2.fit <- cfa(ppr.m2,
    data = dfSEM,
    std.lv = T,
    missing = "ML",
    )
summary(ppr.m2.fit, fit.measures = T, standardized =T, ci = T) #its the fit measures that take forever to cycle
```



### Full Measurement Model
Could also do a PPR specific one, but that one was far more stable historically and its tested in the full model anway, so may as well jump to next step.
Can also check the predicted values from here. e.g. if needing to bail into the MLM world, can use these as vars rather than averages or sums
Can also see if the identification stuff arises here too

This is a just latent var construction. No disaggregation, no grouping correlations accounted for here. This is just for using in a latent mlm, which will *then* have the inner correlations covered
```{r}
measure.m1 <- '
   #####################
  # MEASUREMENT MODEL #
  #####################
  
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Constrained)
  AFkm1 =~ a*Akm1_t1 + d*Akm4_t1 + e*Akm5_t1 + f*Akm6_t1
  AFkm2 =~ a*Akm1_t2 + d*Akm4_t2 + e*Akm5_t2 + f*Akm6_t2
  AFkm3 =~ a*Akm1_t3 + d*Akm4_t3 + e*Akm5_t3 + f*Akm6_t3
  AFkm4 =~ a*Akm1_t4 + d*Akm4_t4 + e*Akm5_t4 + f*Akm6_t4
  AFkm5 =~ a*Akm1_t5 + d*Akm4_t5 + e*Akm5_t5 + f*Akm6_t5
  AFkm6 =~ a*Akm1_t6 + d*Akm4_t6 + e*Akm5_t6 + f*Akm6_t6
  AFkm7 =~ a*Akm1_t7 + d*Akm4_t7 + e*Akm5_t7 + f*Akm6_t7
  AFkm8 =~ a*Akm1_t8 + d*Akm4_t8 + e*Akm5_t8 + f*Akm6_t8
  AFkm9 =~ a*Akm1_t9 + d*Akm4_t9 + e*Akm5_t9 + f*Akm6_t9
  AFkm10 =~ a*Akm1_t10 + d*Akm4_t10 + e*Akm5_t10 + f*Akm6_t10
  AFkm11 =~ a*Akm1_t11 + d*Akm4_t11 + e*Akm5_t11 + f*Akm6_t11
  AFkm12 =~ a*Akm1_t12 + d*Akm4_t12 + e*Akm5_t12 + f*Akm6_t12
  AFkm13 =~ a*Akm1_t13 + d*Akm4_t13 + e*Akm5_t13 + f*Akm6_t13
  AFkm14 =~ a*Akm1_t14 + d*Akm4_t14 + e*Akm5_t14 + f*Akm6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  AFppr1 =~ g*Appr1_t1 + h*Appr2_t1 + i*Appr3_t1 + j*Appr4_t1
  AFppr2 =~ g*Appr1_t2 + h*Appr2_t2 + i*Appr3_t2 + j*Appr4_t2
  AFppr3 =~ g*Appr1_t3 + h*Appr2_t3 + i*Appr3_t3 + j*Appr4_t3
  AFppr4 =~ g*Appr1_t4 + h*Appr2_t4 + i*Appr3_t4 + j*Appr4_t4
  AFppr5 =~ g*Appr1_t5 + h*Appr2_t5 + i*Appr3_t5 + j*Appr4_t5
  AFppr6 =~ g*Appr1_t6 + h*Appr2_t6 + i*Appr3_t6 + j*Appr4_t6
  AFppr7 =~ g*Appr1_t7 + h*Appr2_t7 + i*Appr3_t7 + j*Appr4_t7
  AFppr8 =~ g*Appr1_t8 + h*Appr2_t8 + i*Appr3_t8 + j*Appr4_t8
  AFppr9 =~ g*Appr1_t9 + h*Appr2_t9 + i*Appr3_t9 + j*Appr4_t9
  AFppr10 =~ g*Appr1_t10 + h*Appr2_t10 + i*Appr3_t10 + j*Appr4_t10
  AFppr11 =~ g*Appr1_t11 + h*Appr2_t11 + i*Appr3_t11 + j*Appr4_t11
  AFppr12 =~ g*Appr1_t12 + h*Appr2_t12 + i*Appr3_t12 + j*Appr4_t12
  AFppr13 =~ g*Appr1_t13 + h*Appr2_t13 + i*Appr3_t13 + j*Appr4_t13
  AFppr14 =~ g*Appr1_t14 + h*Appr2_t14 + i*Appr3_t14 + j*Appr4_t14
  
  
   ####### Partner B ######
  #NOTE: Same constraints as the actor imposed here because the partners are indistinguishable--who is "Actor" and "Bartner" for a given couple is arbitrary. E.g. the alternative does not make sense--that all actors have a particular loading of their factors or regression effects, while the partners are different (again, since actor and partner does not hold inherent meaning, like male/female or child/parent, we would not expect those parameters to deviate consistently across the entire sample)
  
  # Factor models for km at 14 waves (Constrained)
  BFkm1 =~ a*Bkm1_t1 + d*Bkm4_t1 + e*Bkm5_t1 + f*Bkm6_t1
  BFkm2 =~ a*Bkm1_t2 + d*Bkm4_t2 + e*Bkm5_t2 + f*Bkm6_t2
  BFkm3 =~ a*Bkm1_t3 + d*Bkm4_t3 + e*Bkm5_t3 + f*Bkm6_t3
  BFkm4 =~ a*Bkm1_t4 + d*Bkm4_t4 + e*Bkm5_t4 + f*Bkm6_t4
  BFkm5 =~ a*Bkm1_t5 + d*Bkm4_t5 + e*Bkm5_t5 + f*Bkm6_t5
  BFkm6 =~ a*Bkm1_t6 + d*Bkm4_t6 + e*Bkm5_t6 + f*Bkm6_t6
  BFkm7 =~ a*Bkm1_t7 + d*Bkm4_t7 + e*Bkm5_t7 + f*Bkm6_t7
  BFkm8 =~ a*Bkm1_t8 + d*Bkm4_t8 + e*Bkm5_t8 + f*Bkm6_t8
  BFkm9 =~ a*Bkm1_t9 + d*Bkm4_t9 + e*Bkm5_t9 + f*Bkm6_t9
  BFkm10 =~ a*Bkm1_t10 + d*Bkm4_t10 + e*Bkm5_t10 + f*Bkm6_t10
  BFkm11 =~ a*Bkm1_t11 + d*Bkm4_t11 + e*Bkm5_t11 + f*Bkm6_t11
  BFkm12 =~ a*Bkm1_t12 + d*Bkm4_t12 + e*Bkm5_t12 + f*Bkm6_t12
  BFkm13 =~ a*Bkm1_t13 + d*Bkm4_t13 + e*Bkm5_t13 + f*Bkm6_t13
  BFkm14 =~ a*Bkm1_t14 + d*Bkm4_t14 + e*Bkm5_t14 + f*Bkm6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  BFppr1 =~ g*Bppr1_t1 + h*Bppr2_t1 + i*Bppr3_t1 + j*Bppr4_t1
  BFppr2 =~ g*Bppr1_t2 + h*Bppr2_t2 + i*Bppr3_t2 + j*Bppr4_t2
  BFppr3 =~ g*Bppr1_t3 + h*Bppr2_t3 + i*Bppr3_t3 + j*Bppr4_t3
  BFppr4 =~ g*Bppr1_t4 + h*Bppr2_t4 + i*Bppr3_t4 + j*Bppr4_t4
  BFppr5 =~ g*Bppr1_t5 + h*Bppr2_t5 + i*Bppr3_t5 + j*Bppr4_t5
  BFppr6 =~ g*Bppr1_t6 + h*Bppr2_t6 + i*Bppr3_t6 + j*Bppr4_t6
  BFppr7 =~ g*Bppr1_t7 + h*Bppr2_t7 + i*Bppr3_t7 + j*Bppr4_t7
  BFppr8 =~ g*Bppr1_t8 + h*Bppr2_t8 + i*Bppr3_t8 + j*Bppr4_t8
  BFppr9 =~ g*Bppr1_t9 + h*Bppr2_t9 + i*Bppr3_t9 + j*Bppr4_t9
  BFppr10 =~ g*Bppr1_t10 + h*Bppr2_t10 + i*Bppr3_t10 + j*Bppr4_t10
  BFppr11 =~ g*Bppr1_t11 + h*Bppr2_t11 + i*Bppr3_t11 + j*Bppr4_t11
  BFppr12 =~ g*Bppr1_t12 + h*Bppr2_t12 + i*Bppr3_t12 + j*Bppr4_t12
  BFppr13 =~ g*Bppr1_t13 + h*Bppr2_t13 + i*Bppr3_t13 + j*Bppr4_t13
  BFppr14 =~ g*Bppr1_t14 + h*Bppr2_t14 + i*Bppr3_t14 + j*Bppr4_t14
  
'

measure.m1.fit <- cfa(measure.m1,
    data = dfSEM,
    std.lv = T,
    missing = "ML",
    )
summary(measure.m1.fit, standardized =T, ci = T) #its the fit measures that take forever to cycle
```


```{r}
measureA.m1 <- '
   #####################
  # MEASUREMENT MODEL #
  #####################
  
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Constrained)
  AFkm1 =~ a*Akm1_t1 + d*Akm4_t1 + e*Akm5_t1 + f*Akm6_t1
  AFkm2 =~ a*Akm1_t2 + d*Akm4_t2 + e*Akm5_t2 + f*Akm6_t2
  AFkm3 =~ a*Akm1_t3 + d*Akm4_t3 + e*Akm5_t3 + f*Akm6_t3
  AFkm4 =~ a*Akm1_t4 + d*Akm4_t4 + e*Akm5_t4 + f*Akm6_t4
  AFkm5 =~ a*Akm1_t5 + d*Akm4_t5 + e*Akm5_t5 + f*Akm6_t5
  AFkm6 =~ a*Akm1_t6 + d*Akm4_t6 + e*Akm5_t6 + f*Akm6_t6
  AFkm7 =~ a*Akm1_t7 + d*Akm4_t7 + e*Akm5_t7 + f*Akm6_t7
  AFkm8 =~ a*Akm1_t8 + d*Akm4_t8 + e*Akm5_t8 + f*Akm6_t8
  AFkm9 =~ a*Akm1_t9 + d*Akm4_t9 + e*Akm5_t9 + f*Akm6_t9
  AFkm10 =~ a*Akm1_t10 + d*Akm4_t10 + e*Akm5_t10 + f*Akm6_t10
  AFkm11 =~ a*Akm1_t11 + d*Akm4_t11 + e*Akm5_t11 + f*Akm6_t11
  AFkm12 =~ a*Akm1_t12 + d*Akm4_t12 + e*Akm5_t12 + f*Akm6_t12
  AFkm13 =~ a*Akm1_t13 + d*Akm4_t13 + e*Akm5_t13 + f*Akm6_t13
  AFkm14 =~ a*Akm1_t14 + d*Akm4_t14 + e*Akm5_t14 + f*Akm6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  AFppr1 =~ g*Appr1_t1 + h*Appr2_t1 + i*Appr3_t1 + j*Appr4_t1
  AFppr2 =~ g*Appr1_t2 + h*Appr2_t2 + i*Appr3_t2 + j*Appr4_t2
  AFppr3 =~ g*Appr1_t3 + h*Appr2_t3 + i*Appr3_t3 + j*Appr4_t3
  AFppr4 =~ g*Appr1_t4 + h*Appr2_t4 + i*Appr3_t4 + j*Appr4_t4
  AFppr5 =~ g*Appr1_t5 + h*Appr2_t5 + i*Appr3_t5 + j*Appr4_t5
  AFppr6 =~ g*Appr1_t6 + h*Appr2_t6 + i*Appr3_t6 + j*Appr4_t6
  AFppr7 =~ g*Appr1_t7 + h*Appr2_t7 + i*Appr3_t7 + j*Appr4_t7
  AFppr8 =~ g*Appr1_t8 + h*Appr2_t8 + i*Appr3_t8 + j*Appr4_t8
  AFppr9 =~ g*Appr1_t9 + h*Appr2_t9 + i*Appr3_t9 + j*Appr4_t9
  AFppr10 =~ g*Appr1_t10 + h*Appr2_t10 + i*Appr3_t10 + j*Appr4_t10
  AFppr11 =~ g*Appr1_t11 + h*Appr2_t11 + i*Appr3_t11 + j*Appr4_t11
  AFppr12 =~ g*Appr1_t12 + h*Appr2_t12 + i*Appr3_t12 + j*Appr4_t12
  AFppr13 =~ g*Appr1_t13 + h*Appr2_t13 + i*Appr3_t13 + j*Appr4_t13
  AFppr14 =~ g*Appr1_t14 + h*Appr2_t14 + i*Appr3_t14 + j*Appr4_t14
  
  
'

measureA.m1.fit <- cfa(measureA.m1,
    data = dfSEM,
    std.lv = T,
    missing = "ML",
    )
summary(measureA.m1.fit, fit.measures = T, standardized =T, ci = T) #its the fit measures that take forever to cycle
```

```{r}
measureB.m1 <- '
  
  # Factor models for km at 14 waves (Constrained)
  BFkm1 =~ a*Bkm1_t1 + d*Bkm4_t1 + e*Bkm5_t1 + f*Bkm6_t1
  BFkm2 =~ a*Bkm1_t2 + d*Bkm4_t2 + e*Bkm5_t2 + f*Bkm6_t2
  BFkm3 =~ a*Bkm1_t3 + d*Bkm4_t3 + e*Bkm5_t3 + f*Bkm6_t3
  BFkm4 =~ a*Bkm1_t4 + d*Bkm4_t4 + e*Bkm5_t4 + f*Bkm6_t4
  BFkm5 =~ a*Bkm1_t5 + d*Bkm4_t5 + e*Bkm5_t5 + f*Bkm6_t5
  BFkm6 =~ a*Bkm1_t6 + d*Bkm4_t6 + e*Bkm5_t6 + f*Bkm6_t6
  BFkm7 =~ a*Bkm1_t7 + d*Bkm4_t7 + e*Bkm5_t7 + f*Bkm6_t7
  BFkm8 =~ a*Bkm1_t8 + d*Bkm4_t8 + e*Bkm5_t8 + f*Bkm6_t8
  BFkm9 =~ a*Bkm1_t9 + d*Bkm4_t9 + e*Bkm5_t9 + f*Bkm6_t9
  BFkm10 =~ a*Bkm1_t10 + d*Bkm4_t10 + e*Bkm5_t10 + f*Bkm6_t10
  BFkm11 =~ a*Bkm1_t11 + d*Bkm4_t11 + e*Bkm5_t11 + f*Bkm6_t11
  BFkm12 =~ a*Bkm1_t12 + d*Bkm4_t12 + e*Bkm5_t12 + f*Bkm6_t12
  BFkm13 =~ a*Bkm1_t13 + d*Bkm4_t13 + e*Bkm5_t13 + f*Bkm6_t13
  BFkm14 =~ a*Bkm1_t14 + d*Bkm4_t14 + e*Bkm5_t14 + f*Bkm6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  BFppr1 =~ g*Bppr1_t1 + h*Bppr2_t1 + i*Bppr3_t1 + j*Bppr4_t1
  BFppr2 =~ g*Bppr1_t2 + h*Bppr2_t2 + i*Bppr3_t2 + j*Bppr4_t2
  BFppr3 =~ g*Bppr1_t3 + h*Bppr2_t3 + i*Bppr3_t3 + j*Bppr4_t3
  BFppr4 =~ g*Bppr1_t4 + h*Bppr2_t4 + i*Bppr3_t4 + j*Bppr4_t4
  BFppr5 =~ g*Bppr1_t5 + h*Bppr2_t5 + i*Bppr3_t5 + j*Bppr4_t5
  BFppr6 =~ g*Bppr1_t6 + h*Bppr2_t6 + i*Bppr3_t6 + j*Bppr4_t6
  BFppr7 =~ g*Bppr1_t7 + h*Bppr2_t7 + i*Bppr3_t7 + j*Bppr4_t7
  BFppr8 =~ g*Bppr1_t8 + h*Bppr2_t8 + i*Bppr3_t8 + j*Bppr4_t8
  BFppr9 =~ g*Bppr1_t9 + h*Bppr2_t9 + i*Bppr3_t9 + j*Bppr4_t9
  BFppr10 =~ g*Bppr1_t10 + h*Bppr2_t10 + i*Bppr3_t10 + j*Bppr4_t10
  BFppr11 =~ g*Bppr1_t11 + h*Bppr2_t11 + i*Bppr3_t11 + j*Bppr4_t11
  BFppr12 =~ g*Bppr1_t12 + h*Bppr2_t12 + i*Bppr3_t12 + j*Bppr4_t12
  BFppr13 =~ g*Bppr1_t13 + h*Bppr2_t13 + i*Bppr3_t13 + j*Bppr4_t13
  BFppr14 =~ g*Bppr1_t14 + h*Bppr2_t14 + i*Bppr3_t14 + j*Bppr4_t14
  
'

measureB.m1.fit <- cfa(measureB.m1,
    data = dfSEM,
    std.lv = T,
    missing = "ML",
    )
summary(measureB.m1.fit, standardized =T, ci = T) #its the fit measures that take forever to cycle
```



Can I make the measurement model without the aggregation?
```{r}
measure.m2 <- '
   #####################
  # MEASUREMENT MODEL #
  #####################
  
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Constrained)
  AFkm1 =~ a*Akm1_t1 + d*Akm4_t1 + e*Akm5_t1 + f*Akm6_t1
  AFkm2 =~ a*Akm1_t2 + d*Akm4_t2 + e*Akm5_t2 + f*Akm6_t2
  AFkm3 =~ a*Akm1_t3 + d*Akm4_t3 + e*Akm5_t3 + f*Akm6_t3
  AFkm4 =~ a*Akm1_t4 + d*Akm4_t4 + e*Akm5_t4 + f*Akm6_t4
  AFkm5 =~ a*Akm1_t5 + d*Akm4_t5 + e*Akm5_t5 + f*Akm6_t5
  AFkm6 =~ a*Akm1_t6 + d*Akm4_t6 + e*Akm5_t6 + f*Akm6_t6
  AFkm7 =~ a*Akm1_t7 + d*Akm4_t7 + e*Akm5_t7 + f*Akm6_t7
  AFkm8 =~ a*Akm1_t8 + d*Akm4_t8 + e*Akm5_t8 + f*Akm6_t8
  AFkm9 =~ a*Akm1_t9 + d*Akm4_t9 + e*Akm5_t9 + f*Akm6_t9
  AFkm10 =~ a*Akm1_t10 + d*Akm4_t10 + e*Akm5_t10 + f*Akm6_t10
  AFkm11 =~ a*Akm1_t11 + d*Akm4_t11 + e*Akm5_t11 + f*Akm6_t11
  AFkm12 =~ a*Akm1_t12 + d*Akm4_t12 + e*Akm5_t12 + f*Akm6_t12
  AFkm13 =~ a*Akm1_t13 + d*Akm4_t13 + e*Akm5_t13 + f*Akm6_t13
  AFkm14 =~ a*Akm1_t14 + d*Akm4_t14 + e*Akm5_t14 + f*Akm6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  AFppr1 =~ g*Appr1_t1 + h*Appr2_t1 + i*Appr3_t1 + j*Appr4_t1
  AFppr2 =~ g*Appr1_t2 + h*Appr2_t2 + i*Appr3_t2 + j*Appr4_t2
  AFppr3 =~ g*Appr1_t3 + h*Appr2_t3 + i*Appr3_t3 + j*Appr4_t3
  AFppr4 =~ g*Appr1_t4 + h*Appr2_t4 + i*Appr3_t4 + j*Appr4_t4
  AFppr5 =~ g*Appr1_t5 + h*Appr2_t5 + i*Appr3_t5 + j*Appr4_t5
  AFppr6 =~ g*Appr1_t6 + h*Appr2_t6 + i*Appr3_t6 + j*Appr4_t6
  AFppr7 =~ g*Appr1_t7 + h*Appr2_t7 + i*Appr3_t7 + j*Appr4_t7
  AFppr8 =~ g*Appr1_t8 + h*Appr2_t8 + i*Appr3_t8 + j*Appr4_t8
  AFppr9 =~ g*Appr1_t9 + h*Appr2_t9 + i*Appr3_t9 + j*Appr4_t9
  AFppr10 =~ g*Appr1_t10 + h*Appr2_t10 + i*Appr3_t10 + j*Appr4_t10
  AFppr11 =~ g*Appr1_t11 + h*Appr2_t11 + i*Appr3_t11 + j*Appr4_t11
  AFppr12 =~ g*Appr1_t12 + h*Appr2_t12 + i*Appr3_t12 + j*Appr4_t12
  AFppr13 =~ g*Appr1_t13 + h*Appr2_t13 + i*Appr3_t13 + j*Appr4_t13
  AFppr14 =~ g*Appr1_t14 + h*Appr2_t14 + i*Appr3_t14 + j*Appr4_t14
  
  
   ####### Partner B ######
  #NOTE: Same constraints as the actor imposed here because the partners are indistinguishable--who is "Actor" and "Bartner" for a given couple is arbitrary. E.g. the alternative does not make sense--that all actors have a particular loading of their factors or regression effects, while the partners are different (again, since actor and partner does not hold inherent meaning, like male/female or child/parent, we would not expect those parameters to deviate consistently across the entire sample)
  
  # Factor models for km at 14 waves (Constrained)
  BFkm1 =~ a*Bkm1_t1 + d*Bkm4_t1 + e*Bkm5_t1 + f*Bkm6_t1
  BFkm2 =~ a*Bkm1_t2 + d*Bkm4_t2 + e*Bkm5_t2 + f*Bkm6_t2
  BFkm3 =~ a*Bkm1_t3 + d*Bkm4_t3 + e*Bkm5_t3 + f*Bkm6_t3
  BFkm4 =~ a*Bkm1_t4 + d*Bkm4_t4 + e*Bkm5_t4 + f*Bkm6_t4
  BFkm5 =~ a*Bkm1_t5 + d*Bkm4_t5 + e*Bkm5_t5 + f*Bkm6_t5
  BFkm6 =~ a*Bkm1_t6 + d*Bkm4_t6 + e*Bkm5_t6 + f*Bkm6_t6
  BFkm7 =~ a*Bkm1_t7 + d*Bkm4_t7 + e*Bkm5_t7 + f*Bkm6_t7
  BFkm8 =~ a*Bkm1_t8 + d*Bkm4_t8 + e*Bkm5_t8 + f*Bkm6_t8
  BFkm9 =~ a*Bkm1_t9 + d*Bkm4_t9 + e*Bkm5_t9 + f*Bkm6_t9
  BFkm10 =~ a*Bkm1_t10 + d*Bkm4_t10 + e*Bkm5_t10 + f*Bkm6_t10
  BFkm11 =~ a*Bkm1_t11 + d*Bkm4_t11 + e*Bkm5_t11 + f*Bkm6_t11
  BFkm12 =~ a*Bkm1_t12 + d*Bkm4_t12 + e*Bkm5_t12 + f*Bkm6_t12
  BFkm13 =~ a*Bkm1_t13 + d*Bkm4_t13 + e*Bkm5_t13 + f*Bkm6_t13
  BFkm14 =~ a*Bkm1_t14 + d*Bkm4_t14 + e*Bkm5_t14 + f*Bkm6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  BFppr1 =~ g*Bppr1_t1 + h*Bppr2_t1 + i*Bppr3_t1 + j*Bppr4_t1
  BFppr2 =~ g*Bppr1_t2 + h*Bppr2_t2 + i*Bppr3_t2 + j*Bppr4_t2
  BFppr3 =~ g*Bppr1_t3 + h*Bppr2_t3 + i*Bppr3_t3 + j*Bppr4_t3
  BFppr4 =~ g*Bppr1_t4 + h*Bppr2_t4 + i*Bppr3_t4 + j*Bppr4_t4
  BFppr5 =~ g*Bppr1_t5 + h*Bppr2_t5 + i*Bppr3_t5 + j*Bppr4_t5
  BFppr6 =~ g*Bppr1_t6 + h*Bppr2_t6 + i*Bppr3_t6 + j*Bppr4_t6
  BFppr7 =~ g*Bppr1_t7 + h*Bppr2_t7 + i*Bppr3_t7 + j*Bppr4_t7
  BFppr8 =~ g*Bppr1_t8 + h*Bppr2_t8 + i*Bppr3_t8 + j*Bppr4_t8
  BFppr9 =~ g*Bppr1_t9 + h*Bppr2_t9 + i*Bppr3_t9 + j*Bppr4_t9
  BFppr10 =~ g*Bppr1_t10 + h*Bppr2_t10 + i*Bppr3_t10 + j*Bppr4_t10
  BFppr11 =~ g*Bppr1_t11 + h*Bppr2_t11 + i*Bppr3_t11 + j*Bppr4_t11
  BFppr12 =~ g*Bppr1_t12 + h*Bppr2_t12 + i*Bppr3_t12 + j*Bppr4_t12
  BFppr13 =~ g*Bppr1_t13 + h*Bppr2_t13 + i*Bppr3_t13 + j*Bppr4_t13
  BFppr14 =~ g*Bppr1_t14 + h*Bppr2_t14 + i*Bppr3_t14 + j*Bppr4_t14
  
   #### Dyadic residual COvariances at item level #### (individual variances are estimated as part of the cfa function default)
  #KM#
  Akm1_t1 ~~ Bkm1_t1; Akm4_t1 ~~ Bkm4_t1 ;  Akm5_t1 ~~ Bkm5_t1 ;  Akm6_t1 ~~ Bkm6_t1
  Akm1_t2 ~~ Bkm1_t2; Akm4_t2 ~~ Bkm4_t2 ;  Akm5_t2 ~~ Bkm5_t2 ;  Akm6_t2 ~~ Bkm6_t2
  Akm1_t3 ~~ Bkm1_t3; Akm4_t3 ~~ Bkm4_t3 ;  Akm5_t3 ~~ Bkm5_t3 ;  Akm6_t3 ~~ Bkm6_t3
  Akm1_t4 ~~ Bkm1_t4; Akm4_t4 ~~ Bkm4_t4 ;  Akm5_t4 ~~ Bkm5_t4 ;  Akm6_t4 ~~ Bkm6_t4
  Akm1_t5 ~~ Bkm1_t5; Akm4_t5 ~~ Bkm4_t5 ;  Akm5_t5 ~~ Bkm5_t5 ;  Akm6_t5 ~~ Bkm6_t5
  Akm1_t6 ~~ Bkm1_t6; Akm4_t6 ~~ Bkm4_t6 ;  Akm5_t6 ~~ Bkm5_t6 ;  Akm6_t6 ~~ Bkm6_t6
  Akm1_t7 ~~ Bkm1_t7; Akm4_t7 ~~ Bkm4_t7 ;  Akm5_t7 ~~ Bkm5_t7 ;  Akm6_t7 ~~ Bkm6_t7
  Akm1_t8 ~~ Bkm1_t8; Akm4_t8 ~~ Bkm4_t8 ;  Akm5_t8 ~~ Bkm5_t8 ;  Akm6_t8 ~~ Bkm6_t8
  Akm1_t9 ~~ Bkm1_t9; Akm4_t9 ~~ Bkm4_t9 ;  Akm5_t9 ~~ Bkm5_t9 ;  Akm6_t9 ~~ Bkm6_t9
  Akm1_t10 ~~ Bkm1_t10; Akm4_t10 ~~ Bkm4_t10 ; Akm5_t10 ~~ Bkm5_t10 ; Akm6_t10 ~~ Bkm6_t10
  Akm1_t11 ~~ Bkm1_t11; Akm4_t11 ~~ Bkm4_t11 ; Akm5_t11 ~~ Bkm5_t11 ; Akm6_t11 ~~ Bkm6_t11
  Akm1_t12 ~~ Bkm1_t12; Akm4_t12 ~~ Bkm4_t12 ; Akm5_t12 ~~ Bkm5_t12 ; Akm6_t12 ~~ Bkm6_t12
  Akm1_t13 ~~ Bkm1_t13; Akm4_t13 ~~ Bkm4_t13 ; Akm5_t13 ~~ Bkm5_t13 ; Akm6_t13 ~~ Bkm6_t13
  Akm1_t14 ~~ Bkm1_t14; Akm4_t14 ~~ Bkm4_t14 ; Akm5_t14 ~~ Bkm5_t14 ; Akm6_t14 ~~ Bkm6_t14
  
  #PPR#
  Appr1_t1 ~~ Bppr1_t1; Appr2_t1 ~~ Bppr2_t1 ; Appr3_t1 ~~ Bppr3_t1 ; Appr4_t1 ~~ Bppr4_t1
  Appr1_t2 ~~ Bppr1_t2; Appr2_t2 ~~ Bppr2_t2 ; Appr3_t2 ~~ Bppr3_t2 ; Appr4_t2 ~~ Bppr4_t2
  Appr1_t3 ~~ Bppr1_t3; Appr2_t3 ~~ Bppr2_t3 ; Appr3_t3 ~~ Bppr3_t3 ; Appr4_t3 ~~ Bppr4_t3
  Appr1_t4 ~~ Bppr1_t4; Appr2_t4 ~~ Bppr2_t4 ; Appr3_t4 ~~ Bppr3_t4 ; Appr4_t4 ~~ Bppr4_t4
  Appr1_t5 ~~ Bppr1_t5; Appr2_t5 ~~ Bppr2_t5 ; Appr3_t5 ~~ Bppr3_t5 ; Appr4_t5 ~~ Bppr4_t5
  Appr1_t6 ~~ Bppr1_t6; Appr2_t6 ~~ Bppr2_t6 ; Appr3_t6 ~~ Bppr3_t6 ; Appr4_t6 ~~ Bppr4_t6
  Appr1_t7 ~~ Bppr1_t7; Appr2_t7 ~~ Bppr2_t7 ; Appr3_t7 ~~ Bppr3_t7 ; Appr4_t7 ~~ Bppr4_t7
  Appr1_t8 ~~ Bppr1_t8; Appr2_t8 ~~ Bppr2_t8 ; Appr3_t8 ~~ Bppr3_t8 ; Appr4_t8 ~~ Bppr4_t8
  Appr1_t9 ~~ Bppr1_t9; Appr2_t9 ~~ Bppr2_t9 ; Appr3_t9 ~~ Bppr3_t9 ; Appr4_t9 ~~ Bppr4_t9
  Appr1_t10 ~~ Bppr1_t10; Appr2_t10 ~~ Bppr2_t10; Appr3_t10 ~~ Bppr3_t10 ; Appr4_t10 ~~ Bppr4_t10
  Appr1_t11 ~~ Bppr1_t11; Appr2_t11 ~~ Bppr2_t11; Appr3_t11 ~~ Bppr3_t11 ; Appr4_t11 ~~ Bppr4_t11
  Appr1_t12 ~~ Bppr1_t12; Appr2_t12 ~~ Bppr2_t12; Appr3_t12 ~~ Bppr3_t12 ; Appr4_t12 ~~ Bppr4_t12
  Appr1_t13 ~~ Bppr1_t13; Appr2_t13 ~~ Bppr2_t13; Appr3_t13 ~~ Bppr3_t13 ; Appr4_t13 ~~ Bppr4_t13
  Appr1_t14 ~~ Bppr1_t14; Appr2_t14 ~~ Bppr2_t14; Appr3_t14 ~~ Bppr3_t14 ; Appr4_t14 ~~ Bppr4_t14

'

measure.m2.fit <- cfa(measure.m2,
    data = dfSEM,
    std.lv = T,
    missing = "ML",
    )
summary(measure.m2.fit, standardized =T, ci = T) #its the fit measures that take forever to cycle
```



### Base, Configural

```{r}
base.m1b <- '

  #####################
  # MEASUREMENT MODEL #
  #####################
  
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Unconstrained)
  AFkm1 =~ Akm1_t1 + Akm4_t1 + Akm5_t1 + Akm6_t1
  AFkm2 =~ Akm1_t2 + Akm4_t2 + Akm5_t2 + Akm6_t2
  AFkm3 =~ Akm1_t3 + Akm4_t3 + Akm5_t3 + Akm6_t3
  AFkm4 =~ Akm1_t4 + Akm4_t4 + Akm5_t4 + Akm6_t4
  AFkm5 =~ Akm1_t5 + Akm4_t5 + Akm5_t5 + Akm6_t5
  AFkm6 =~ Akm1_t6 + Akm4_t6 + Akm5_t6 + Akm6_t6
  AFkm7 =~ Akm1_t7 + Akm4_t7 + Akm5_t7 + Akm6_t7
  AFkm8 =~ Akm1_t8 + Akm4_t8 + Akm5_t8 + Akm6_t8
  AFkm9 =~ Akm1_t9 + Akm4_t9 + Akm5_t9 + Akm6_t9
  AFkm10 =~ Akm1_t10 + Akm4_t10 + Akm5_t10 + Akm6_t10
  AFkm11 =~ Akm1_t11 + Akm4_t11 + Akm5_t11 + Akm6_t11
  AFkm12 =~ Akm1_t12 + Akm4_t12 + Akm5_t12 + Akm6_t12
  AFkm13 =~ Akm1_t13 + Akm4_t13 + Akm5_t13 + Akm6_t13
  AFkm14 =~ Akm1_t14 + Akm4_t14 + Akm5_t14 + Akm6_t14
  
  
  # Factor models for ppr at 14 waves (Unconstrained)
  AFppr1 =~ Appr1_t1 + Appr2_t1 + Appr3_t1 + Appr4_t1
  AFppr2 =~ Appr1_t2 + Appr2_t2 + Appr3_t2 + Appr4_t2
  AFppr3 =~ Appr1_t3 + Appr2_t3 + Appr3_t3 + Appr4_t3
  AFppr4 =~ Appr1_t4 + Appr2_t4 + Appr3_t4 + Appr4_t4
  AFppr5 =~ Appr1_t5 + Appr2_t5 + Appr3_t5 + Appr4_t5
  AFppr6 =~ Appr1_t6 + Appr2_t6 + Appr3_t6 + Appr4_t6
  AFppr7 =~ Appr1_t7 + Appr2_t7 + Appr3_t7 + Appr4_t7
  AFppr8 =~ Appr1_t8 + Appr2_t8 + Appr3_t8 + Appr4_t8
  AFppr9 =~ Appr1_t9 + Appr2_t9 + Appr3_t9 + Appr4_t9
  AFppr10 =~ Appr1_t10 + Appr2_t10 + Appr3_t10 + Appr4_t10
  AFppr11 =~ Appr1_t11 + Appr2_t11 + Appr3_t11 + Appr4_t11
  AFppr12 =~ Appr1_t12 + Appr2_t12 + Appr3_t12 + Appr4_t12
  AFppr13 =~ Appr1_t13 + Appr2_t13 + Appr3_t13 + Appr4_t13
  AFppr14 =~ Appr1_t14 + Appr2_t14 + Appr3_t14 + Appr4_t14
  
  
   ####### Partner B ######

  # Factor models for km at 14 waves (Unconstrained)
  BFkm1 =~ Bkm1_t1 + Bkm4_t1 + Bkm5_t1 + Bkm6_t1
  BFkm2 =~ Bkm1_t2 + Bkm4_t2 + Bkm5_t2 + Bkm6_t2
  BFkm3 =~ Bkm1_t3 + Bkm4_t3 + Bkm5_t3 + Bkm6_t3
  BFkm4 =~ Bkm1_t4 + Bkm4_t4 + Bkm5_t4 + Bkm6_t4
  BFkm5 =~ Bkm1_t5 + Bkm4_t5 + Bkm5_t5 + Bkm6_t5
  BFkm6 =~ Bkm1_t6 + Bkm4_t6 + Bkm5_t6 + Bkm6_t6
  BFkm7 =~ Bkm1_t7 + Bkm4_t7 + Bkm5_t7 + Bkm6_t7
  BFkm8 =~ Bkm1_t8 + Bkm4_t8 + Bkm5_t8 + Bkm6_t8
  BFkm9 =~ Bkm1_t9 + Bkm4_t9 + Bkm5_t9 + Bkm6_t9
  BFkm10 =~ Bkm1_t10 + Bkm4_t10 + Bkm5_t10 + Bkm6_t10
  BFkm11 =~ Bkm1_t11 + Bkm4_t11 + Bkm5_t11 + Bkm6_t11
  BFkm12 =~ Bkm1_t12 + Bkm4_t12 + Bkm5_t12 + Bkm6_t12
  BFkm13 =~ Bkm1_t13 + Bkm4_t13 + Bkm5_t13 + Bkm6_t13
  BFkm14 =~ Bkm1_t14 + Bkm4_t14 + Bkm5_t14 + Bkm6_t14
  
  
  # Factor models for ppr at 14 waves (Unconstrained)
  BFppr1 =~ Bppr1_t1 + Bppr2_t1 + Bppr3_t1 + Bppr4_t1
  BFppr2 =~ Bppr1_t2 + Bppr2_t2 + Bppr3_t2 + Bppr4_t2
  BFppr3 =~ Bppr1_t3 + Bppr2_t3 + Bppr3_t3 + Bppr4_t3
  BFppr4 =~ Bppr1_t4 + Bppr2_t4 + Bppr3_t4 + Bppr4_t4
  BFppr5 =~ Bppr1_t5 + Bppr2_t5 + Bppr3_t5 + Bppr4_t5
  BFppr6 =~ Bppr1_t6 + Bppr2_t6 + Bppr3_t6 + Bppr4_t6
  BFppr7 =~ Bppr1_t7 + Bppr2_t7 + Bppr3_t7 + Bppr4_t7
  BFppr8 =~ Bppr1_t8 + Bppr2_t8 + Bppr3_t8 + Bppr4_t8
  BFppr9 =~ Bppr1_t9 + Bppr2_t9 + Bppr3_t9 + Bppr4_t9
  BFppr10 =~ Bppr1_t10 + Bppr2_t10 + Bppr3_t10 + Bppr4_t10
  BFppr11 =~ Bppr1_t11 + Bppr2_t11 + Bppr3_t11 + Bppr4_t11
  BFppr12 =~ Bppr1_t12 + Bppr2_t12 + Bppr3_t12 + Bppr4_t12
  BFppr13 =~ Bppr1_t13 + Bppr2_t13 + Bppr3_t13 + Bppr4_t13
  BFppr14 =~ Bppr1_t14 + Bppr2_t14 + Bppr3_t14 + Bppr4_t14
  
  #### Dyadic residual COvariances at item level #### (individual variances are estimated as part of the cfa function default)
  #KM#
  Akm1_t1 ~~ Bkm1_t1; Akm4_t1 ~~ Bkm4_t1 ;  Akm5_t1 ~~ Bkm5_t1 ;  Akm6_t1 ~~ Bkm6_t1
  Akm1_t2 ~~ Bkm1_t2; Akm4_t2 ~~ Bkm4_t2 ;  Akm5_t2 ~~ Bkm5_t2 ;  Akm6_t2 ~~ Bkm6_t2
  Akm1_t3 ~~ Bkm1_t3; Akm4_t3 ~~ Bkm4_t3 ;  Akm5_t3 ~~ Bkm5_t3 ;  Akm6_t3 ~~ Bkm6_t3
  Akm1_t4 ~~ Bkm1_t4; Akm4_t4 ~~ Bkm4_t4 ;  Akm5_t4 ~~ Bkm5_t4 ;  Akm6_t4 ~~ Bkm6_t4
  Akm1_t5 ~~ Bkm1_t5; Akm4_t5 ~~ Bkm4_t5 ;  Akm5_t5 ~~ Bkm5_t5 ;  Akm6_t5 ~~ Bkm6_t5
  Akm1_t6 ~~ Bkm1_t6; Akm4_t6 ~~ Bkm4_t6 ;  Akm5_t6 ~~ Bkm5_t6 ;  Akm6_t6 ~~ Bkm6_t6
  Akm1_t7 ~~ Bkm1_t7; Akm4_t7 ~~ Bkm4_t7 ;  Akm5_t7 ~~ Bkm5_t7 ;  Akm6_t7 ~~ Bkm6_t7
  Akm1_t8 ~~ Bkm1_t8; Akm4_t8 ~~ Bkm4_t8 ;  Akm5_t8 ~~ Bkm5_t8 ;  Akm6_t8 ~~ Bkm6_t8
  Akm1_t9 ~~ Bkm1_t9; Akm4_t9 ~~ Bkm4_t9 ;  Akm5_t9 ~~ Bkm5_t9 ;  Akm6_t9 ~~ Bkm6_t9
  Akm1_t10 ~~ Bkm1_t10; Akm4_t10 ~~ Bkm4_t10 ; Akm5_t10 ~~ Bkm5_t10 ; Akm6_t10 ~~ Bkm6_t10
  Akm1_t11 ~~ Bkm1_t11; Akm4_t11 ~~ Bkm4_t11 ; Akm5_t11 ~~ Bkm5_t11 ; Akm6_t11 ~~ Bkm6_t11
  Akm1_t12 ~~ Bkm1_t12; Akm4_t12 ~~ Bkm4_t12 ; Akm5_t12 ~~ Bkm5_t12 ; Akm6_t12 ~~ Bkm6_t12
  Akm1_t13 ~~ Bkm1_t13; Akm4_t13 ~~ Bkm4_t13 ; Akm5_t13 ~~ Bkm5_t13 ; Akm6_t13 ~~ Bkm6_t13
  Akm1_t14 ~~ Bkm1_t14; Akm4_t14 ~~ Bkm4_t14 ; Akm5_t14 ~~ Bkm5_t14 ; Akm6_t14 ~~ Bkm6_t14
  
  #PPR#
  Appr1_t1 ~~ Bppr1_t1; Appr2_t1 ~~ Bppr2_t1 ; Appr3_t1 ~~ Bppr3_t1 ; Appr4_t1 ~~ Bppr4_t1
  Appr1_t2 ~~ Bppr1_t2; Appr2_t2 ~~ Bppr2_t2 ; Appr3_t2 ~~ Bppr3_t2 ; Appr4_t2 ~~ Bppr4_t2
  Appr1_t3 ~~ Bppr1_t3; Appr2_t3 ~~ Bppr2_t3 ; Appr3_t3 ~~ Bppr3_t3 ; Appr4_t3 ~~ Bppr4_t3
  Appr1_t4 ~~ Bppr1_t4; Appr2_t4 ~~ Bppr2_t4 ; Appr3_t4 ~~ Bppr3_t4 ; Appr4_t4 ~~ Bppr4_t4
  Appr1_t5 ~~ Bppr1_t5; Appr2_t5 ~~ Bppr2_t5 ; Appr3_t5 ~~ Bppr3_t5 ; Appr4_t5 ~~ Bppr4_t5
  Appr1_t6 ~~ Bppr1_t6; Appr2_t6 ~~ Bppr2_t6 ; Appr3_t6 ~~ Bppr3_t6 ; Appr4_t6 ~~ Bppr4_t6
  Appr1_t7 ~~ Bppr1_t7; Appr2_t7 ~~ Bppr2_t7 ; Appr3_t7 ~~ Bppr3_t7 ; Appr4_t7 ~~ Bppr4_t7
  Appr1_t8 ~~ Bppr1_t8; Appr2_t8 ~~ Bppr2_t8 ; Appr3_t8 ~~ Bppr3_t8 ; Appr4_t8 ~~ Bppr4_t8
  Appr1_t9 ~~ Bppr1_t9; Appr2_t9 ~~ Bppr2_t9 ; Appr3_t9 ~~ Bppr3_t9 ; Appr4_t9 ~~ Bppr4_t9
  Appr1_t10 ~~ Bppr1_t10; Appr2_t10 ~~ Bppr2_t10; Appr3_t10 ~~ Bppr3_t10 ; Appr4_t10 ~~ Bppr4_t10
  Appr1_t11 ~~ Bppr1_t11; Appr2_t11 ~~ Bppr2_t11; Appr3_t11 ~~ Bppr3_t11 ; Appr4_t11 ~~ Bppr4_t11
  Appr1_t12 ~~ Bppr1_t12; Appr2_t12 ~~ Bppr2_t12; Appr3_t12 ~~ Bppr3_t12 ; Appr4_t12 ~~ Bppr4_t12
  Appr1_t13 ~~ Bppr1_t13; Appr2_t13 ~~ Bppr2_t13; Appr3_t13 ~~ Bppr3_t13 ; Appr4_t13 ~~ Bppr4_t13
  Appr1_t14 ~~ Bppr1_t14; Appr2_t14 ~~ Bppr2_t14; Appr3_t14 ~~ Bppr3_t14 ; Appr4_t14 ~~ Bppr4_t14
  
  
  ################
  # BETWEEN PART #
  ################
  
  
  # Create between factors (RIs)
  ARIkm =~ 1*AFkm1 + 1*AFkm2 + 1*AFkm3 + 1*AFkm4 + 1*AFkm5 + 1*AFkm6 + 1*AFkm7 + 1*AFkm8 + 1*AFkm9 + 1*AFkm10 + 1*AFkm11 + 1*AFkm12 + 1*AFkm13 + 1*AFkm14
  ARIppr =~ 1*AFppr1 + 1*AFppr2 + 1*AFppr3 + 1*AFppr4 + 1*AFppr5 + 1*AFppr6 + 1*AFppr7 + 1*AFppr8 + 1*AFppr9 + 1*AFppr10 + 1*AFppr11 + 1*AFppr12 + 1*AFppr13 + 1*AFppr14
  BRIkm =~ 1*BFkm1 + 1*BFkm2 + 1*BFkm3 + 1*BFkm4 + 1*BFkm5 + 1*BFkm6 + 1*BFkm7 + 1*BFkm8 + 1*BFkm9 + 1*BFkm10 + 1*BFkm11 + 1*BFkm12 + 1*BFkm13 + 1*BFkm14
  BRIppr =~ 1*BFppr1 + 1*BFppr2 + 1*BFppr3 + 1*BFppr4 + 1*BFppr5 + 1*BFppr6 + 1*BFppr7 + 1*BFppr8 + 1*BFppr9 + 1*BFppr10 + 1*BFppr11 + 1*BFppr12 + 1*BFppr13 + 1*BFppr14
  
  # Set residual variances of all Fkm and Fppr vars to 0
  # I think this specifies all variance of the factors goes to either w/n or b/n
  AFkm1 ~~ 0*AFkm1
  AFkm2 ~~ 0*AFkm2
  AFkm3 ~~ 0*AFkm3
  AFkm4 ~~ 0*AFkm4
  AFkm5 ~~ 0*AFkm5
  AFkm6 ~~ 0*AFkm6
  AFkm7 ~~ 0*AFkm7
  AFkm8 ~~ 0*AFkm8
  AFkm9 ~~ 0*AFkm9
  AFkm10 ~~ 0*AFkm10
  AFkm11 ~~ 0*AFkm11
  AFkm12 ~~ 0*AFkm12
  AFkm13 ~~ 0*AFkm13
  AFkm14 ~~ 0*AFkm14
  AFppr1 ~~ 0*AFppr1
  AFppr2 ~~ 0*AFppr2
  AFppr3 ~~ 0*AFppr3
  AFppr4 ~~ 0*AFppr4
  AFppr5 ~~ 0*AFppr5
  AFppr6 ~~ 0*AFppr6
  AFppr7 ~~ 0*AFppr7
  AFppr8 ~~ 0*AFppr8
  AFppr9 ~~ 0*AFppr9
  AFppr10 ~~ 0*AFppr10
  AFppr11 ~~ 0*AFppr11
  AFppr12 ~~ 0*AFppr12
  AFppr13 ~~ 0*AFppr13
  AFppr14 ~~ 0*AFppr14
  
  BFkm1 ~~ 0*BFkm1
  BFkm2 ~~ 0*BFkm2
  BFkm3 ~~ 0*BFkm3
  BFkm4 ~~ 0*BFkm4
  BFkm5 ~~ 0*BFkm5
  BFkm6 ~~ 0*BFkm6
  BFkm7 ~~ 0*BFkm7
  BFkm8 ~~ 0*BFkm8
  BFkm9 ~~ 0*BFkm9
  BFkm10 ~~ 0*BFkm10
  BFkm11 ~~ 0*BFkm11
  BFkm12 ~~ 0*BFkm12
  BFkm13 ~~ 0*BFkm13
  BFkm14 ~~ 0*BFkm14
  BFppr1 ~~ 0*BFppr1
  BFppr2 ~~ 0*BFppr2
  BFppr3 ~~ 0*BFppr3
  BFppr4 ~~ 0*BFppr4
  BFppr5 ~~ 0*BFppr5
  BFppr6 ~~ 0*BFppr6
  BFppr7 ~~ 0*BFppr7
  BFppr8 ~~ 0*BFppr8
  BFppr9 ~~ 0*BFppr9
  BFppr10 ~~ 0*BFppr10
  BFppr11 ~~ 0*BFppr11
  BFppr12 ~~ 0*BFppr12
  BFppr13 ~~ 0*BFppr13
  BFppr14 ~~ 0*BFppr14


  ###############
  # WITHIN PART #
  ###############

  # Create within-components
  AWFkm1 =~ 1*AFkm1
  AWFkm2 =~ 1*AFkm2
  AWFkm3 =~ 1*AFkm3
  AWFkm4 =~ 1*AFkm4
  AWFkm5 =~ 1*AFkm5
  AWFkm6 =~ 1*AFkm6
  AWFkm7 =~ 1*AFkm7
  AWFkm8 =~ 1*AFkm8
  AWFkm9 =~ 1*AFkm9
  AWFkm10 =~ 1*AFkm10
  AWFkm11 =~ 1*AFkm11
  AWFkm12 =~ 1*AFkm12
  AWFkm13 =~ 1*AFkm13
  AWFkm14 =~ 1*AFkm14
  
  AWFppr1 =~ 1*AFppr1
  AWFppr2 =~ 1*AFppr2
  AWFppr3 =~ 1*AFppr3
  AWFppr4 =~ 1*AFppr4
  AWFppr5 =~ 1*AFppr5
  AWFppr6 =~ 1*AFppr6
  AWFppr7 =~ 1*AFppr7
  AWFppr8 =~ 1*AFppr8
  AWFppr9 =~ 1*AFppr9
  AWFppr10 =~ 1*AFppr10
  AWFppr11 =~ 1*AFppr11
  AWFppr12 =~ 1*AFppr12
  AWFppr13 =~ 1*AFppr13
  AWFppr14 =~ 1*AFppr14
  
  BWFkm1 =~ 1*BFkm1
  BWFkm2 =~ 1*BFkm2
  BWFkm3 =~ 1*BFkm3
  BWFkm4 =~ 1*BFkm4
  BWFkm5 =~ 1*BFkm5
  BWFkm6 =~ 1*BFkm6
  BWFkm7 =~ 1*BFkm7
  BWFkm8 =~ 1*BFkm8
  BWFkm9 =~ 1*BFkm9
  BWFkm10 =~ 1*BFkm10
  BWFkm11 =~ 1*BFkm11
  BWFkm12 =~ 1*BFkm12
  BWFkm13 =~ 1*BFkm13
  BWFkm14 =~ 1*BFkm14
  
  BWFppr1 =~ 1*BFppr1
  BWFppr2 =~ 1*BFppr2
  BWFppr3 =~ 1*BFppr3
  BWFppr4 =~ 1*BFppr4
  BWFppr5 =~ 1*BFppr5
  BWFppr6 =~ 1*BFppr6
  BWFppr7 =~ 1*BFppr7
  BWFppr8 =~ 1*BFppr8
  BWFppr9 =~ 1*BFppr9
  BWFppr10 =~ 1*BFppr10
  BWFppr11 =~ 1*BFppr11
  BWFppr12 =~ 1*BFppr12
  BWFppr13 =~ 1*BFppr13
  BWFppr14 =~ 1*BFppr14
  
  
  # Specify lagged effects between within-person centered latent variables
  # Should be 8 total (16 maximum, but indistinguishable constraints down half of them)
  # (we need these to account for Partner Bs previous responses; it needs to be partialed. Non specifying these == to saything those paths are zero) 
  # outcome:individual:type
  # kaa = kama muta outcome: actor : autoregressive (coming from kama muta)
  # kpa = kama muta outcome: partner: autoregressive
  # kac = kama muta outcome: actor : crosslagged (coming from ppr)
  # kpc = kama muta outcome: partner : crosslagged

  # For KM effects
  AWFkm2 ~ kaa1*AWFkm1 + kpa1*BWFkm1 + kac1*AWFppr1 + kpc1*BWFppr1 
  AWFkm3 ~ kaa2*AWFkm2 + kpa2*BWFkm2 + kac2*AWFppr2 + kpc2*BWFppr2 
  AWFkm4 ~ kaa3*AWFkm3 + kpa3*BWFkm3 + kac3*AWFppr3 + kpc3*BWFppr3 
  AWFkm5 ~ kaa4*AWFkm4 + kpa4*BWFkm4 + kac4*AWFppr4 + kpc4*BWFppr4 
  AWFkm6 ~ kaa5*AWFkm5 + kpa5*BWFkm5 + kac5*AWFppr5 + kpc5*BWFppr5 
  AWFkm7 ~ kaa6*AWFkm6 + kpa6*BWFkm6 + kac6*AWFppr6 + kpc6*BWFppr6 
  AWFkm8 ~ kaa7*AWFkm7 + kpa7*BWFkm7 + kac7*AWFppr7 + kpc7*BWFppr7 
  AWFkm9 ~ kaa8*AWFkm8 + kpa8*BWFkm8 + kac8*AWFppr8 + kpc8*BWFppr8 
  AWFkm10 ~ kaa9*AWFkm9 + kpa9*BWFkm9 + kac9*AWFppr9 + kpc9*BWFppr9 
  AWFkm11 ~ kaa10*AWFkm10 + kpa10*BWFkm10 + kac10*AWFppr10 + kpc10*BWFppr10 
  AWFkm12 ~ kaa11*AWFkm11 + kpa11*BWFkm11 + kac11*AWFppr11 + kpc11*BWFppr11 
  AWFkm13 ~ kaa12*AWFkm12 + kpa12*BWFkm12 + kac12*AWFppr12 + kpc12*BWFppr12 
  AWFkm14 ~ kaa13*AWFkm13 + kpa13*BWFkm13 + kac13*AWFppr13 + kpc13*BWFppr13 

  # For PPR effects
  AWFppr2 ~ paa1*AWFppr1 + ppa1*BWFppr1 + pac1*AWFkm1 + ppc1*BWFkm1 
  AWFppr3 ~ paa2*AWFppr2 + ppa2*BWFppr2 + pac2*AWFkm2 + ppc2*BWFkm2 
  AWFppr4 ~ paa3*AWFppr3 + ppa3*BWFppr3 + pac3*AWFkm3 + ppc3*BWFkm3 
  AWFppr5 ~ paa4*AWFppr4 + ppa4*BWFppr4 + pac4*AWFkm4 + ppc4*BWFkm4 
  AWFppr6 ~ paa5*AWFppr5 + ppa5*BWFppr5 + pac5*AWFkm5 + ppc5*BWFkm5 
  AWFppr7 ~ paa6*AWFppr6 + ppa6*BWFppr6 + pac6*AWFkm6 + ppc6*BWFkm6 
  AWFppr8 ~ paa7*AWFppr7 + ppa7*BWFppr7 + pac7*AWFkm7 + ppc7*BWFkm7 
  AWFppr9 ~ paa8*AWFppr8 + ppa8*BWFppr8 + pac8*AWFkm8 + ppc8*BWFkm8 
  AWFppr10 ~ paa9*AWFppr9 + ppa9*BWFppr9 + pac9*AWFkm9 + ppc9*BWFkm9 
  AWFppr11 ~ paa10*AWFppr10 + ppa10*BWFppr10 + pac10*AWFkm10 + ppc10*BWFkm10 
  AWFppr12 ~ paa11*AWFppr11 + ppa11*BWFppr11 + pac11*AWFkm11 + ppc11*BWFkm11 
  AWFppr13 ~ paa12*AWFppr12 + ppa12*BWFppr12 + pac12*AWFkm12 + ppc12*BWFkm12 
  AWFppr14 ~ paa13*AWFppr13 + ppa13*BWFppr13 + pac13*AWFkm13 + ppc13*BWFkm13 
 
  
  # Estimate correlations within same wave
  AWFkm1 ~~ s*AWFppr1 + t*BWFkm1 + u*BWFppr1 
  AWFkm2 ~~ s*AWFppr2 + t*BWFkm2 + u*BWFppr2
  AWFkm3 ~~ s*AWFppr3 + t*BWFkm3 + u*BWFppr3
  AWFkm4 ~~ s*AWFppr4 + t*BWFkm4 + u*BWFppr4
  AWFkm5 ~~ s*AWFppr5 + t*BWFkm5 + u*BWFppr5
  AWFkm6 ~~ s*AWFppr6 + t*BWFkm6 + u*BWFppr6
  AWFkm7 ~~ s*AWFppr7 + t*BWFkm7 + u*BWFppr7
  AWFkm8 ~~ s*AWFppr8 + t*BWFkm8 + u*BWFppr8
  AWFkm9 ~~ s*AWFppr9 + t*BWFkm9 + u*BWFppr9
  AWFkm10 ~~ s*AWFppr10 + t*BWFkm10 + u*BWFppr10
  AWFkm11 ~~ s*AWFppr11 + t*BWFkm11 + u*BWFppr11
  AWFkm12 ~~ s*AWFppr12 + t*BWFkm12 + u*BWFppr12
  AWFkm13 ~~ s*AWFppr13 + t*BWFkm13 + u*BWFppr13
  AWFkm14 ~~ s*AWFppr14 + t*BWFkm14 + u*BWFppr14
  
  BWFkm1 ~~ v*AWFppr1 + w*BWFppr1 
  BWFkm2 ~~ v*AWFppr2 + w*BWFppr2
  BWFkm3 ~~ v*AWFppr3 + w*BWFppr3
  BWFkm4 ~~ v*AWFppr4 + w*BWFppr4
  BWFkm5 ~~ v*AWFppr5 + w*BWFppr5
  BWFkm6 ~~ v*AWFppr6 + w*BWFppr6
  BWFkm7 ~~ v*AWFppr7 + w*BWFppr7
  BWFkm8 ~~ v*AWFppr8 + w*BWFppr8
  BWFkm9 ~~ v*AWFppr9 + w*BWFppr9
  BWFkm10 ~~ v*AWFppr10 + w*BWFppr10
  BWFkm11 ~~ v*AWFppr11 + w*BWFppr11
  BWFkm12 ~~ v*AWFppr12 + w*BWFppr12
  BWFkm13 ~~ v*AWFppr13 + w*BWFppr13
  BWFkm14 ~~ v*AWFppr14 + w*BWFppr14
  
  AWFppr1 ~~ x*BWFppr1 
  AWFppr2 ~~ x*BWFppr2
  AWFppr3 ~~ x*BWFppr3
  AWFppr4 ~~ x*BWFppr4
  AWFppr5 ~~ x*BWFppr5
  AWFppr6 ~~ x*BWFppr6
  AWFppr7 ~~ x*BWFppr7
  AWFppr8 ~~ x*BWFppr8
  AWFppr9 ~~ x*BWFppr9
  AWFppr10 ~~ x*BWFppr10
  AWFppr11 ~~ x*BWFppr11
  AWFppr12 ~~ x*BWFppr12
  AWFppr13 ~~ x*BWFppr13
  AWFppr14 ~~ x*BWFppr14
  
  
  ##########################
  # ADDITIONAL CONSTRAINTS #
  ##########################
  
  # Set correlations between between-factors (RIs) and within-factors at wave 1 at 0
  ARIkm + ARIppr + BRIkm + BRIppr ~~ 0*AWFkm1 + 0*AWFppr1 + 0*BWFkm1 + 0*BWFppr1
  
'


base.m1b.fit <- cfa(base.m1b,
                   data = dfSEM,
                   std.lv = T,
                   missing = "ML"
                   )
summary(base.m1b.fit, standardized =T, ci = T)
```




# Archive of Code and Notes
##### Thoughts on partner effects
I can't label the partners actor and partner, since the actor/partner label is really only relevant for the effects. I need to relabel those.
I also need to make sure that these constraints are appropriate at the measurement and regression levels.


##### Thoughts on residual errors
Past work with basic observed variables (Iida, Kenny etc.) have mentioned this point, however they rarely do this in terms of latent factors. Sakaluk (2021) is the first to explicitly mention that we A) 100% need this in SEM and B) correlating the factors alone is not enough, you need the item cross correlations as well. I think the individual pieces are still covered insofar as Mulder and Hamaker's tutorial does not make extra notion of the individual's items cross loading to each subsequent time-point. As far as I can tell, this is because all of the variance is being forced to load onto the within/between sections thus individual cross variation is covered by the subsequent factor relationships across time. But to get the partner stuff in, I think we  need it


##### Invariance testing notes
Indistinguishability test: According to Sakaluk (2021), we need configural, weak, strong, AND residual invariance for this formal test. This is b/c if dyad members are considered to be identical, thus exchangeable, all elements of the measurement model for each person must ALSO be identical.

Residual invariance is a test that the residual (error) variances, i.e. the stuff not accounted for in the factors of the model, are equivalent across groups. I.e. that partner A and partner B also have the same amount/kind of error. This is very often unnecessary, however it becomes important for considering true indistinguishability of partners
Note: this is a very very new thing to get visibility, so don't expect a lot of guidance or traction here. Its an in-progress area. If I read Sakaluk's interpretation correctly, it is via constraining all of the residual correlations to be the same across items. Partner A and Partner B should have the same loadings (i.e. weak invariance), same intercepts (strong invariance) but also the same item residual terms. I think it makes sense to test this one last then.

It should be the case that we can define the residual variance for an item as its own latent factor, then estimate that residual variance, then allow it to correlate with the other corresponding residual term. E.g.
eAkm1_t1 =~ 1*Akm1_t1; eAkm1_t1 ~~ eAkm1_t1.
eAkm1_t1 is our new residual term for Akm1_t1, which can thus be correlated to other things. While eAkm1_t1 ~~ eAkm1_t1 gives us its variance
(https://groups.google.com/u/0/g/lavaan/c/zT90_tmeJ5M?pli=1) Taken from Roseel himself

##### APIM Test Code


#### Configural
What I thiiink is the freely estimated model, configural invariance
--is the pattern of item loadings and overall factor structure consistent? (e.g. across our groups/individuals of interest). This is tested via a freely estimated model, check with usual model fit criteria.
Insufficient model fit suggests that the organization of latent factors and items differs between the groups/individuals
I.e. we have "configural variance"
```{r}
base.m1 <- '

  #####################
  # MEASUREMENT MODEL #
  #####################
  
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Unconstrained)
  AFkm1 =~ Akm1_t1 + Akm4_t1 + Akm5_t1 + Akm6_t1
  AFkm2 =~ Akm1_t2 + Akm4_t2 + Akm5_t2 + Akm6_t2
  AFkm3 =~ Akm1_t3 + Akm4_t3 + Akm5_t3 + Akm6_t3
  AFkm4 =~ Akm1_t4 + Akm4_t4 + Akm5_t4 + Akm6_t4
  AFkm5 =~ Akm1_t5 + Akm4_t5 + Akm5_t5 + Akm6_t5
  AFkm6 =~ Akm1_t6 + Akm4_t6 + Akm5_t6 + Akm6_t6
  AFkm7 =~ Akm1_t7 + Akm4_t7 + Akm5_t7 + Akm6_t7
  AFkm8 =~ Akm1_t8 + Akm4_t8 + Akm5_t8 + Akm6_t8
  AFkm9 =~ Akm1_t9 + Akm4_t9 + Akm5_t9 + Akm6_t9
  AFkm10 =~ Akm1_t10 + Akm4_t10 + Akm5_t10 + Akm6_t10
  AFkm11 =~ Akm1_t11 + Akm4_t11 + Akm5_t11 + Akm6_t11
  AFkm12 =~ Akm1_t12 + Akm4_t12 + Akm5_t12 + Akm6_t12
  AFkm13 =~ Akm1_t13 + Akm4_t13 + Akm5_t13 + Akm6_t13
  AFkm14 =~ Akm1_t14 + Akm4_t14 + Akm5_t14 + Akm6_t14
  
  
  # Factor models for ppr at 14 waves (Unconstrained)
  AFppr1 =~ Appr1_t1 + Appr2_t1 + Appr3_t1 + Appr4_t1
  AFppr2 =~ Appr1_t2 + Appr2_t2 + Appr3_t2 + Appr4_t2
  AFppr3 =~ Appr1_t3 + Appr2_t3 + Appr3_t3 + Appr4_t3
  AFppr4 =~ Appr1_t4 + Appr2_t4 + Appr3_t4 + Appr4_t4
  AFppr5 =~ Appr1_t5 + Appr2_t5 + Appr3_t5 + Appr4_t5
  AFppr6 =~ Appr1_t6 + Appr2_t6 + Appr3_t6 + Appr4_t6
  AFppr7 =~ Appr1_t7 + Appr2_t7 + Appr3_t7 + Appr4_t7
  AFppr8 =~ Appr1_t8 + Appr2_t8 + Appr3_t8 + Appr4_t8
  AFppr9 =~ Appr1_t9 + Appr2_t9 + Appr3_t9 + Appr4_t9
  AFppr10 =~ Appr1_t10 + Appr2_t10 + Appr3_t10 + Appr4_t10
  AFppr11 =~ Appr1_t11 + Appr2_t11 + Appr3_t11 + Appr4_t11
  AFppr12 =~ Appr1_t12 + Appr2_t12 + Appr3_t12 + Appr4_t12
  AFppr13 =~ Appr1_t13 + Appr2_t13 + Appr3_t13 + Appr4_t13
  AFppr14 =~ Appr1_t14 + Appr2_t14 + Appr3_t14 + Appr4_t14
  
  
   ####### Partner B ######

  # Factor models for km at 14 waves (Unconstrained)
  BFkm1 =~ Bkm1_t1 + Bkm4_t1 + Bkm5_t1 + Bkm6_t1
  BFkm2 =~ Bkm1_t2 + Bkm4_t2 + Bkm5_t2 + Bkm6_t2
  BFkm3 =~ Bkm1_t3 + Bkm4_t3 + Bkm5_t3 + Bkm6_t3
  BFkm4 =~ Bkm1_t4 + Bkm4_t4 + Bkm5_t4 + Bkm6_t4
  BFkm5 =~ Bkm1_t5 + Bkm4_t5 + Bkm5_t5 + Bkm6_t5
  BFkm6 =~ Bkm1_t6 + Bkm4_t6 + Bkm5_t6 + Bkm6_t6
  BFkm7 =~ Bkm1_t7 + Bkm4_t7 + Bkm5_t7 + Bkm6_t7
  BFkm8 =~ Bkm1_t8 + Bkm4_t8 + Bkm5_t8 + Bkm6_t8
  BFkm9 =~ Bkm1_t9 + Bkm4_t9 + Bkm5_t9 + Bkm6_t9
  BFkm10 =~ Bkm1_t10 + Bkm4_t10 + Bkm5_t10 + Bkm6_t10
  BFkm11 =~ Bkm1_t11 + Bkm4_t11 + Bkm5_t11 + Bkm6_t11
  BFkm12 =~ Bkm1_t12 + Bkm4_t12 + Bkm5_t12 + Bkm6_t12
  BFkm13 =~ Bkm1_t13 + Bkm4_t13 + Bkm5_t13 + Bkm6_t13
  BFkm14 =~ Bkm1_t14 + Bkm4_t14 + Bkm5_t14 + Bkm6_t14
  
  
  # Factor models for ppr at 14 waves (Unconstrained)
  BFppr1 =~ Bppr1_t1 + Bppr2_t1 + Bppr3_t1 + Bppr4_t1
  BFppr2 =~ Bppr1_t2 + Bppr2_t2 + Bppr3_t2 + Bppr4_t2
  BFppr3 =~ Bppr1_t3 + Bppr2_t3 + Bppr3_t3 + Bppr4_t3
  BFppr4 =~ Bppr1_t4 + Bppr2_t4 + Bppr3_t4 + Bppr4_t4
  BFppr5 =~ Bppr1_t5 + Bppr2_t5 + Bppr3_t5 + Bppr4_t5
  BFppr6 =~ Bppr1_t6 + Bppr2_t6 + Bppr3_t6 + Bppr4_t6
  BFppr7 =~ Bppr1_t7 + Bppr2_t7 + Bppr3_t7 + Bppr4_t7
  BFppr8 =~ Bppr1_t8 + Bppr2_t8 + Bppr3_t8 + Bppr4_t8
  BFppr9 =~ Bppr1_t9 + Bppr2_t9 + Bppr3_t9 + Bppr4_t9
  BFppr10 =~ Bppr1_t10 + Bppr2_t10 + Bppr3_t10 + Bppr4_t10
  BFppr11 =~ Bppr1_t11 + Bppr2_t11 + Bppr3_t11 + Bppr4_t11
  BFppr12 =~ Bppr1_t12 + Bppr2_t12 + Bppr3_t12 + Bppr4_t12
  BFppr13 =~ Bppr1_t13 + Bppr2_t13 + Bppr3_t13 + Bppr4_t13
  BFppr14 =~ Bppr1_t14 + Bppr2_t14 + Bppr3_t14 + Bppr4_t14
  
  #### Dyadic residual COvariances at item level #### (individual variances are estimated as part of the cfa function default)
  #KM#
  Akm1_t1 ~~ Bkm1_t1; Akm4_t1 ~~ Bkm4_t1 ;  Akm5_t1 ~~ Bkm5_t1 ;  Akm6_t1 ~~ Bkm6_t1
  Akm1_t2 ~~ Bkm1_t2; Akm4_t2 ~~ Bkm4_t2 ;  Akm5_t2 ~~ Bkm5_t2 ;  Akm6_t2 ~~ Bkm6_t2
  Akm1_t3 ~~ Bkm1_t3; Akm4_t3 ~~ Bkm4_t3 ;  Akm5_t3 ~~ Bkm5_t3 ;  Akm6_t3 ~~ Bkm6_t3
  Akm1_t4 ~~ Bkm1_t4; Akm4_t4 ~~ Bkm4_t4 ;  Akm5_t4 ~~ Bkm5_t4 ;  Akm6_t4 ~~ Bkm6_t4
  Akm1_t5 ~~ Bkm1_t5; Akm4_t5 ~~ Bkm4_t5 ;  Akm5_t5 ~~ Bkm5_t5 ;  Akm6_t5 ~~ Bkm6_t5
  Akm1_t6 ~~ Bkm1_t6; Akm4_t6 ~~ Bkm4_t6 ;  Akm5_t6 ~~ Bkm5_t6 ;  Akm6_t6 ~~ Bkm6_t6
  Akm1_t7 ~~ Bkm1_t7; Akm4_t7 ~~ Bkm4_t7 ;  Akm5_t7 ~~ Bkm5_t7 ;  Akm6_t7 ~~ Bkm6_t7
  Akm1_t8 ~~ Bkm1_t8; Akm4_t8 ~~ Bkm4_t8 ;  Akm5_t8 ~~ Bkm5_t8 ;  Akm6_t8 ~~ Bkm6_t8
  Akm1_t9 ~~ Bkm1_t9; Akm4_t9 ~~ Bkm4_t9 ;  Akm5_t9 ~~ Bkm5_t9 ;  Akm6_t9 ~~ Bkm6_t9
  Akm1_t10 ~~ Bkm1_t10; Akm4_t10 ~~ Bkm4_t10 ; Akm5_t10 ~~ Bkm5_t10 ; Akm6_t10 ~~ Bkm6_t10
  Akm1_t11 ~~ Bkm1_t11; Akm4_t11 ~~ Bkm4_t11 ; Akm5_t11 ~~ Bkm5_t11 ; Akm6_t11 ~~ Bkm6_t11
  Akm1_t12 ~~ Bkm1_t12; Akm4_t12 ~~ Bkm4_t12 ; Akm5_t12 ~~ Bkm5_t12 ; Akm6_t12 ~~ Bkm6_t12
  Akm1_t13 ~~ Bkm1_t13; Akm4_t13 ~~ Bkm4_t13 ; Akm5_t13 ~~ Bkm5_t13 ; Akm6_t13 ~~ Bkm6_t13
  Akm1_t14 ~~ Bkm1_t14; Akm4_t14 ~~ Bkm4_t14 ; Akm5_t14 ~~ Bkm5_t14 ; Akm6_t14 ~~ Bkm6_t14
  
  #PPR#
  Appr1_t1 ~~ Bppr1_t1; Appr4_t1 ~~ Bppr4_t1 ; Appr5_t1 ~~ Bppr5_t1 ; Appr6_t1 ~~ Bppr6_t1
  Appr1_t2 ~~ Bppr1_t2; Appr4_t2 ~~ Bppr4_t2 ; Appr5_t2 ~~ Bppr5_t2 ; Appr6_t2 ~~ Bppr6_t2
  Appr1_t3 ~~ Bppr1_t3; Appr4_t3 ~~ Bppr4_t3 ; Appr5_t3 ~~ Bppr5_t3 ; Appr6_t3 ~~ Bppr6_t3
  Appr1_t4 ~~ Bppr1_t4; Appr4_t4 ~~ Bppr4_t4 ; Appr5_t4 ~~ Bppr5_t4 ; Appr6_t4 ~~ Bppr6_t4
  Appr1_t5 ~~ Bppr1_t5; Appr4_t5 ~~ Bppr4_t5 ; Appr5_t5 ~~ Bppr5_t5 ; Appr6_t5 ~~ Bppr6_t5
  Appr1_t6 ~~ Bppr1_t6; Appr4_t6 ~~ Bppr4_t6 ; Appr5_t6 ~~ Bppr5_t6 ; Appr6_t6 ~~ Bppr6_t6
  Appr1_t7 ~~ Bppr1_t7; Appr4_t7 ~~ Bppr4_t7 ; Appr5_t7 ~~ Bppr5_t7 ; Appr6_t7 ~~ Bppr6_t7
  Appr1_t8 ~~ Bppr1_t8; Appr4_t8 ~~ Bppr4_t8 ; Appr5_t8 ~~ Bppr5_t8 ; Appr6_t8 ~~ Bppr6_t8
  Appr1_t9 ~~ Bppr1_t9; Appr4_t9 ~~ Bppr4_t9 ; Appr5_t9 ~~ Bppr5_t9 ; Appr6_t9 ~~ Bppr6_t9
  Appr1_t10 ~~ Bppr1_t10; Appr4_t10 ~~ Bppr4_t10; Appr5_t10 ~~ Bppr5_t10 ; Appr6_t10 ~~ Bppr6_t10
  Appr1_t11 ~~ Bppr1_t11; Appr4_t11 ~~ Bppr4_t11; Appr5_t11 ~~ Bppr5_t11 ; Appr6_t11 ~~ Bppr6_t11
  Appr1_t12 ~~ Bppr1_t12; Appr4_t12 ~~ Bppr4_t12; Appr5_t12 ~~ Bppr5_t12 ; Appr6_t12 ~~ Bppr6_t12
  Appr1_t13 ~~ Bppr1_t13; Appr4_t13 ~~ Bppr4_t13; Appr5_t13 ~~ Bppr5_t13 ; Appr6_t13 ~~ Bppr6_t13
  Appr1_t14 ~~ Bppr1_t14; Appr4_t14 ~~ Bppr4_t14; Appr5_t14 ~~ Bppr5_t14 ; Appr6_t14 ~~ Bppr6_t14
  
  
  ################
  # BETWEEN PART #
  ################
  
  
  # Create between factors (RIs)
  ARIkm =~ 1*AFkm1 + 1*AFkm2 + 1*AFkm3 + 1*AFkm4 + 1*AFkm5 + 1*AFkm6 + 1*AFkm7 + 1*AFkm8 + 1*AFkm9 + 1*AFkm10 + 1*AFkm11 + 1*AFkm12 + 1*AFkm13 + 1*AFkm14
  ARIppr =~ 1*AFppr1 + 1*AFppr2 + 1*AFppr3 + 1*AFppr4 + 1*AFppr5 + 1*AFppr6 + 1*AFppr7 + 1*AFppr8 + 1*AFppr9 + 1*AFppr10 + 1*AFppr11 + 1*AFppr12 + 1*AFppr13 + 1*AFppr14
  BRIkm =~ 1*BFkm1 + 1*BFkm2 + 1*BFkm3 + 1*BFkm4 + 1*BFkm5 + 1*BFkm6 + 1*BFkm7 + 1*BFkm8 + 1*BFkm9 + 1*BFkm10 + 1*BFkm11 + 1*BFkm12 + 1*BFkm13 + 1*BFkm14
  BRIppr =~ 1*BFppr1 + 1*BFppr2 + 1*BFppr3 + 1*BFppr4 + 1*BFppr5 + 1*BFppr6 + 1*BFppr7 + 1*BFppr8 + 1*BFppr9 + 1*BFppr10 + 1*BFppr11 + 1*BFppr12 + 1*BFppr13 + 1*BFppr14
  
  # Set residual variances of all Fkm and Fppr vars to 0
  # I think this specifies all variance of the factors goes to either w/n or b/n
  AFkm1 ~~ 0*AFkm1
  AFkm2 ~~ 0*AFkm2
  AFkm3 ~~ 0*AFkm3
  AFkm4 ~~ 0*AFkm4
  AFkm5 ~~ 0*AFkm5
  AFkm6 ~~ 0*AFkm6
  AFkm7 ~~ 0*AFkm7
  AFkm8 ~~ 0*AFkm8
  AFkm9 ~~ 0*AFkm9
  AFkm10 ~~ 0*AFkm10
  AFkm11 ~~ 0*AFkm11
  AFkm12 ~~ 0*AFkm12
  AFkm13 ~~ 0*AFkm13
  AFkm14 ~~ 0*AFkm14
  AFppr1 ~~ 0*AFppr1
  AFppr2 ~~ 0*AFppr2
  AFppr3 ~~ 0*AFppr3
  AFppr4 ~~ 0*AFppr4
  AFppr5 ~~ 0*AFppr5
  AFppr6 ~~ 0*AFppr6
  AFppr7 ~~ 0*AFppr7
  AFppr8 ~~ 0*AFppr8
  AFppr9 ~~ 0*AFppr9
  AFppr10 ~~ 0*AFppr10
  AFppr11 ~~ 0*AFppr11
  AFppr12 ~~ 0*AFppr12
  AFppr13 ~~ 0*AFppr13
  AFppr14 ~~ 0*AFppr14
  
  BFkm1 ~~ 0*BFkm1
  BFkm2 ~~ 0*BFkm2
  BFkm3 ~~ 0*BFkm3
  BFkm4 ~~ 0*BFkm4
  BFkm5 ~~ 0*BFkm5
  BFkm6 ~~ 0*BFkm6
  BFkm7 ~~ 0*BFkm7
  BFkm8 ~~ 0*BFkm8
  BFkm9 ~~ 0*BFkm9
  BFkm10 ~~ 0*BFkm10
  BFkm11 ~~ 0*BFkm11
  BFkm12 ~~ 0*BFkm12
  BFkm13 ~~ 0*BFkm13
  BFkm14 ~~ 0*BFkm14
  BFppr1 ~~ 0*BFppr1
  BFppr2 ~~ 0*BFppr2
  BFppr3 ~~ 0*BFppr3
  BFppr4 ~~ 0*BFppr4
  BFppr5 ~~ 0*BFppr5
  BFppr6 ~~ 0*BFppr6
  BFppr7 ~~ 0*BFppr7
  BFppr8 ~~ 0*BFppr8
  BFppr9 ~~ 0*BFppr9
  BFppr10 ~~ 0*BFppr10
  BFppr11 ~~ 0*BFppr11
  BFppr12 ~~ 0*BFppr12
  BFppr13 ~~ 0*BFppr13
  BFppr14 ~~ 0*BFppr14


  ###############
  # WITHIN PART #
  ###############

  # Create within-components
  AWFkm1 =~ 1*AFkm1
  AWFkm2 =~ 1*AFkm2
  AWFkm3 =~ 1*AFkm3
  AWFkm4 =~ 1*AFkm4
  AWFkm5 =~ 1*AFkm5
  AWFkm6 =~ 1*AFkm6
  AWFkm7 =~ 1*AFkm7
  AWFkm8 =~ 1*AFkm8
  AWFkm9 =~ 1*AFkm9
  AWFkm10 =~ 1*AFkm10
  AWFkm11 =~ 1*AFkm11
  AWFkm12 =~ 1*AFkm12
  AWFkm13 =~ 1*AFkm13
  AWFkm14 =~ 1*AFkm14
  
  AWFppr1 =~ 1*AFppr1
  AWFppr2 =~ 1*AFppr2
  AWFppr3 =~ 1*AFppr3
  AWFppr4 =~ 1*AFppr4
  AWFppr5 =~ 1*AFppr5
  AWFppr6 =~ 1*AFppr6
  AWFppr7 =~ 1*AFppr7
  AWFppr8 =~ 1*AFppr8
  AWFppr9 =~ 1*AFppr9
  AWFppr10 =~ 1*AFppr10
  AWFppr11 =~ 1*AFppr11
  AWFppr12 =~ 1*AFppr12
  AWFppr13 =~ 1*AFppr13
  AWFppr14 =~ 1*AFppr14
  
  BWFkm1 =~ 1*BFkm1
  BWFkm2 =~ 1*BFkm2
  BWFkm3 =~ 1*BFkm3
  BWFkm4 =~ 1*BFkm4
  BWFkm5 =~ 1*BFkm5
  BWFkm6 =~ 1*BFkm6
  BWFkm7 =~ 1*BFkm7
  BWFkm8 =~ 1*BFkm8
  BWFkm9 =~ 1*BFkm9
  BWFkm10 =~ 1*BFkm10
  BWFkm11 =~ 1*BFkm11
  BWFkm12 =~ 1*BFkm12
  BWFkm13 =~ 1*BFkm13
  BWFkm14 =~ 1*BFkm14
  
  BWFppr1 =~ 1*BFppr1
  BWFppr2 =~ 1*BFppr2
  BWFppr3 =~ 1*BFppr3
  BWFppr4 =~ 1*BFppr4
  BWFppr5 =~ 1*BFppr5
  BWFppr6 =~ 1*BFppr6
  BWFppr7 =~ 1*BFppr7
  BWFppr8 =~ 1*BFppr8
  BWFppr9 =~ 1*BFppr9
  BWFppr10 =~ 1*BFppr10
  BWFppr11 =~ 1*BFppr11
  BWFppr12 =~ 1*BFppr12
  BWFppr13 =~ 1*BFppr13
  BWFppr14 =~ 1*BFppr14
  
  
  # Specify lagged effects between within-person centered latent variables
  # Should be 8 total (16 maximum, but indistinguishable constraints down half of them)
  # (we need these to account for Partner Bs previous responses; it needs to be partialed. Non specifying these == to saything those paths are zero) 
  # outcome:individual:type
  # kaa = kama muta outcome: actor : autoregressive (coming from kama muta)
  # kpa = kama muta outcome: partner: autoregressive
  # kac = kama muta outcome: actor : crosslagged (coming from ppr)
  # kpc = kama muta outcome: partner : crosslagged

  # For KM effects.(I might not need the B paths, actually! These are regressions, not definitions, so they should NOT be caring partialing variance. So probs can take out.  # Might want to compare just in case though)
  AWFkm2 ~ kaa1*AWFkm1 + kpa1*BWFkm1 + kac1*AWFppr1 + kpc1*BWFppr1 
  BWFkm2 ~ kaa1*BWFkm1 + kpa1*AWFkm1 + kac1*BWFppr1 + kpc1*AWFppr1
  AWFkm3 ~ kaa2*AWFkm2 + kpa2*BWFkm2 + kac2*AWFppr2 + kpc2*BWFppr2 
  BWFkm3 ~ kaa2*BWFkm2 + kpa2*AWFkm2 + kac2*BWFppr2 + kpc2*AWFppr2
  AWFkm4 ~ kaa3*AWFkm3 + kpa3*BWFkm3 + kac3*AWFppr3 + kpc3*BWFppr3 
  BWFkm4 ~ kaa3*BWFkm3 + kpa3*AWFkm3 + kac3*BWFppr3 + kpc3*AWFppr3
  AWFkm5 ~ kaa4*AWFkm4 + kpa4*BWFkm4 + kac4*AWFppr4 + kpc4*BWFppr4 
  BWFkm5 ~ kaa4*BWFkm4 + kpa4*AWFkm4 + kac4*BWFppr4 + kpc4*AWFppr4
  AWFkm6 ~ kaa5*AWFkm5 + kpa5*BWFkm5 + kac5*AWFppr5 + kpc5*BWFppr5 
  BWFkm6 ~ kaa5*BWFkm5 + kpa5*AWFkm5 + kac5*BWFppr5 + kpc5*AWFppr5
  AWFkm7 ~ kaa6*AWFkm6 + kpa6*BWFkm6 + kac6*AWFppr6 + kpc6*BWFppr6 
  BWFkm7 ~ kaa6*BWFkm6 + kpa6*AWFkm6 + kac6*BWFppr6 + kpc6*AWFppr6
  AWFkm8 ~ kaa7*AWFkm7 + kpa7*BWFkm7 + kac7*AWFppr7 + kpc7*BWFppr7 
  BWFkm8 ~ kaa7*BWFkm7 + kpa7*AWFkm7 + kac7*BWFppr7 + kpc7*AWFppr7
  AWFkm9 ~ kaa8*AWFkm8 + kpa8*BWFkm8 + kac8*AWFppr8 + kpc8*BWFppr8 
  BWFkm9 ~ kaa8*BWFkm8 + kpa8*AWFkm8 + kac8*BWFppr8 + kpc8*AWFppr8
  AWFkm10 ~ kaa9*AWFkm9 + kpa9*BWFkm9 + kac9*AWFppr9 + kpc9*BWFppr9 
  BWFkm10 ~ kaa9*BWFkm9 + kpa9*AWFkm9 + kac9*BWFppr9 + kpc9*AWFppr9
  AWFkm11 ~ kaa10*AWFkm10 + kpa10*BWFkm10 + kac10*AWFppr10 + kpc10*BWFppr10 
  BWFkm11 ~ kaa10*BWFkm10 + kpa10*AWFkm10 + kac10*BWFppr10 + kpc10*AWFppr10
  AWFkm12 ~ kaa11*AWFkm11 + kpa11*BWFkm11 + kac11*AWFppr11 + kpc11*BWFppr11 
  BWFkm12 ~ kaa11*BWFkm11 + kpa11*AWFkm11 + kac11*BWFppr11 + kpc11*AWFppr11
  AWFkm13 ~ kaa12*AWFkm12 + kpa12*BWFkm12 + kac12*AWFppr12 + kpc12*BWFppr12 
  BWFkm13 ~ kaa12*BWFkm12 + kpa12*AWFkm12 + kac12*BWFppr12 + kpc12*AWFppr12
  AWFkm14 ~ kaa13*AWFkm13 + kpa13*BWFkm13 + kac13*AWFppr13 + kpc13*BWFppr13 
  BWFkm14 ~ kaa13*BWFkm13 + kpa13*AWFkm13 + kac13*BWFppr13 + kpc13*AWFppr13
  
  # For PPR effects
  AWFppr2 ~ paa1*AWFppr1 + ppa1*BWFppr1 + pac1*AWFkm1 + ppc1*BWFkm1 
  BWFppr2 ~ paa1*BWFppr1 + ppa1*AWFppr1 + pac1*BWFkm1 + ppc1*AWFkm1
  AWFppr3 ~ paa2*AWFppr2 + ppa2*BWFppr2 + pac2*AWFkm2 + ppc2*BWFkm2 
  BWFppr3 ~ paa2*BWFppr2 + ppa2*AWFppr2 + pac2*BWFkm2 + ppc2*AWFkm2
  AWFppr4 ~ paa3*AWFppr3 + ppa3*BWFppr3 + pac3*AWFkm3 + ppc3*BWFkm3 
  BWFppr4 ~ paa3*BWFppr3 + ppa3*AWFppr3 + pac3*BWFkm3 + ppc3*AWFkm3
  AWFppr5 ~ paa4*AWFppr4 + ppa4*BWFppr4 + pac4*AWFkm4 + ppc4*BWFkm4 
  BWFppr5 ~ paa4*BWFppr4 + ppa4*AWFppr4 + pac4*BWFkm4 + ppc4*AWFkm4
  AWFppr6 ~ paa5*AWFppr5 + ppa5*BWFppr5 + pac5*AWFkm5 + ppc5*BWFkm5 
  BWFppr6 ~ paa5*BWFppr5 + ppa5*AWFppr5 + pac5*BWFkm5 + ppc5*AWFkm5
  AWFppr7 ~ paa6*AWFppr6 + ppa6*BWFppr6 + pac6*AWFkm6 + ppc6*BWFkm6 
  BWFppr7 ~ paa6*BWFppr6 + ppa6*AWFppr6 + pac6*BWFkm6 + ppc6*AWFkm6
  AWFppr8 ~ paa7*AWFppr7 + ppa7*BWFppr7 + pac7*AWFkm7 + ppc7*BWFkm7 
  BWFppr8 ~ paa7*BWFppr7 + ppa7*AWFppr7 + pac7*BWFkm7 + ppc7*AWFkm7
  AWFppr9 ~ paa8*AWFppr8 + ppa8*BWFppr8 + pac8*AWFkm8 + ppc8*BWFkm8 
  BWFppr9 ~ paa8*BWFppr8 + ppa8*AWFppr8 + pac8*BWFkm8 + ppc8*AWFkm8
  AWFppr10 ~ paa9*AWFppr9 + ppa9*BWFppr9 + pac9*AWFkm9 + ppc9*BWFkm9 
  BWFppr10 ~ paa9*BWFppr9 + ppa9*AWFppr9 + pac9*BWFkm9 + ppc9*AWFkm9
  AWFppr11 ~ paa10*AWFppr10 + ppa10*BWFppr10 + pac10*AWFkm10 + ppc10*BWFkm10 
  BWFppr11 ~ paa10*BWFppr10 + ppa10*AWFppr10 + pac10*BWFkm10 + ppc10*AWFkm10
  AWFppr12 ~ paa11*AWFppr11 + ppa11*BWFppr11 + pac11*AWFkm11 + ppc11*BWFkm11 
  BWFppr12 ~ paa11*BWFppr11 + ppa11*AWFppr11 + pac11*BWFkm11 + ppc11*AWFkm11
  AWFppr13 ~ paa12*AWFppr12 + ppa12*BWFppr12 + pac12*AWFkm12 + ppc12*BWFkm12 
  BWFppr13 ~ paa12*BWFppr12 + ppa12*AWFppr12 + pac12*BWFkm12 + ppc12*AWFkm12
  AWFppr14 ~ paa13*AWFppr13 + ppa13*BWFppr13 + pac13*AWFkm13 + ppc13*BWFkm13 
  BWFppr14 ~ paa13*BWFppr13 + ppa13*AWFppr13 + pac13*BWFkm13 + ppc13*AWFkm13

  
  
  # Estimate correlations within same wave
  AWFkm1 ~~ s*AWFppr1 + t*BWFkm1 + u*BWFppr1 
  AWFkm2 ~~ s*AWFppr2 + t*BWFkm2 + u*BWFppr2
  AWFkm3 ~~ s*AWFppr3 + t*BWFkm3 + u*BWFppr3
  AWFkm4 ~~ s*AWFppr4 + t*BWFkm4 + u*BWFppr4
  AWFkm5 ~~ s*AWFppr5 + t*BWFkm5 + u*BWFppr5
  AWFkm6 ~~ s*AWFppr6 + t*BWFkm6 + u*BWFppr6
  AWFkm7 ~~ s*AWFppr7 + t*BWFkm7 + u*BWFppr7
  AWFkm8 ~~ s*AWFppr8 + t*BWFkm8 + u*BWFppr8
  AWFkm9 ~~ s*AWFppr9 + t*BWFkm9 + u*BWFppr9
  AWFkm10 ~~ s*AWFppr10 + t*BWFkm10 + u*BWFppr10
  AWFkm11 ~~ s*AWFppr11 + t*BWFkm11 + u*BWFppr11
  AWFkm12 ~~ s*AWFppr12 + t*BWFkm12 + u*BWFppr12
  AWFkm13 ~~ s*AWFppr13 + t*BWFkm13 + u*BWFppr13
  AWFkm14 ~~ s*AWFppr14 + t*BWFkm14 + u*BWFppr14
  
  BWFkm1 ~~ v*AWFppr1 + w*BWFppr1 
  BWFkm2 ~~ v*AWFppr2 + w*BWFppr2
  BWFkm3 ~~ v*AWFppr3 + w*BWFppr3
  BWFkm4 ~~ v*AWFppr4 + w*BWFppr4
  BWFkm5 ~~ v*AWFppr5 + w*BWFppr5
  BWFkm6 ~~ v*AWFppr6 + w*BWFppr6
  BWFkm7 ~~ v*AWFppr7 + w*BWFppr7
  BWFkm8 ~~ v*AWFppr8 + w*BWFppr8
  BWFkm9 ~~ v*AWFppr9 + w*BWFppr9
  BWFkm10 ~~ v*AWFppr10 + w*BWFppr10
  BWFkm11 ~~ v*AWFppr11 + w*BWFppr11
  BWFkm12 ~~ v*AWFppr12 + w*BWFppr12
  BWFkm13 ~~ v*AWFppr13 + w*BWFppr13
  BWFkm14 ~~ v*AWFppr14 + w*BWFppr14
  
  AWFppr1 ~~ x*BWFppr1 
  AWFppr2 ~~ x*BWFppr2
  AWFppr3 ~~ x*BWFppr3
  AWFppr4 ~~ x*BWFppr4
  AWFppr5 ~~ x*BWFppr5
  AWFppr6 ~~ x*BWFppr6
  AWFppr7 ~~ x*BWFppr7
  AWFppr8 ~~ x*BWFppr8
  AWFppr9 ~~ x*BWFppr9
  AWFppr10 ~~ x*BWFppr10
  AWFppr11 ~~ x*BWFppr11
  AWFppr12 ~~ x*BWFppr12
  AWFppr13 ~~ x*BWFppr13
  AWFppr14 ~~ x*BWFppr14
  
  
  ##########################
  # ADDITIONAL CONSTRAINTS #
  ##########################
  
  # Set correlations between between-factors (RIs) and within-factors at wave 1 at 0
  ARIkm + ARIppr + BRIkm + BRIppr ~~ 0*AWFkm1 + 0*AWFppr1 + 0*BWFkm1 + 0*BWFppr1
  
'


base.m1.fit <- cfa(base.m1,
                   data = dfSEM,
                   std.lv = T,
                   missing = "ML"
                   )
summary(base.m1.fit,fit.measures = T, standardized =T, ci = T)
```

base.m1b is the same but just taking out those partner regressions that should be unnecessary, redundant calculations
```{r}
base.m1b <- '

  #####################
  # MEASUREMENT MODEL #
  #####################
  
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Unconstrained)
  AFkm1 =~ Akm1_t1 + Akm4_t1 + Akm5_t1 + Akm6_t1
  AFkm2 =~ Akm1_t2 + Akm4_t2 + Akm5_t2 + Akm6_t2
  AFkm3 =~ Akm1_t3 + Akm4_t3 + Akm5_t3 + Akm6_t3
  AFkm4 =~ Akm1_t4 + Akm4_t4 + Akm5_t4 + Akm6_t4
  AFkm5 =~ Akm1_t5 + Akm4_t5 + Akm5_t5 + Akm6_t5
  AFkm6 =~ Akm1_t6 + Akm4_t6 + Akm5_t6 + Akm6_t6
  AFkm7 =~ Akm1_t7 + Akm4_t7 + Akm5_t7 + Akm6_t7
  AFkm8 =~ Akm1_t8 + Akm4_t8 + Akm5_t8 + Akm6_t8
  AFkm9 =~ Akm1_t9 + Akm4_t9 + Akm5_t9 + Akm6_t9
  AFkm10 =~ Akm1_t10 + Akm4_t10 + Akm5_t10 + Akm6_t10
  AFkm11 =~ Akm1_t11 + Akm4_t11 + Akm5_t11 + Akm6_t11
  AFkm12 =~ Akm1_t12 + Akm4_t12 + Akm5_t12 + Akm6_t12
  AFkm13 =~ Akm1_t13 + Akm4_t13 + Akm5_t13 + Akm6_t13
  AFkm14 =~ Akm1_t14 + Akm4_t14 + Akm5_t14 + Akm6_t14
  
  
  # Factor models for ppr at 14 waves (Unconstrained)
  AFppr1 =~ Appr1_t1 + Appr2_t1 + Appr3_t1 + Appr4_t1
  AFppr2 =~ Appr1_t2 + Appr2_t2 + Appr3_t2 + Appr4_t2
  AFppr3 =~ Appr1_t3 + Appr2_t3 + Appr3_t3 + Appr4_t3
  AFppr4 =~ Appr1_t4 + Appr2_t4 + Appr3_t4 + Appr4_t4
  AFppr5 =~ Appr1_t5 + Appr2_t5 + Appr3_t5 + Appr4_t5
  AFppr6 =~ Appr1_t6 + Appr2_t6 + Appr3_t6 + Appr4_t6
  AFppr7 =~ Appr1_t7 + Appr2_t7 + Appr3_t7 + Appr4_t7
  AFppr8 =~ Appr1_t8 + Appr2_t8 + Appr3_t8 + Appr4_t8
  AFppr9 =~ Appr1_t9 + Appr2_t9 + Appr3_t9 + Appr4_t9
  AFppr10 =~ Appr1_t10 + Appr2_t10 + Appr3_t10 + Appr4_t10
  AFppr11 =~ Appr1_t11 + Appr2_t11 + Appr3_t11 + Appr4_t11
  AFppr12 =~ Appr1_t12 + Appr2_t12 + Appr3_t12 + Appr4_t12
  AFppr13 =~ Appr1_t13 + Appr2_t13 + Appr3_t13 + Appr4_t13
  AFppr14 =~ Appr1_t14 + Appr2_t14 + Appr3_t14 + Appr4_t14
  
  
   ####### Partner B ######

  # Factor models for km at 14 waves (Unconstrained)
  BFkm1 =~ Bkm1_t1 + Bkm4_t1 + Bkm5_t1 + Bkm6_t1
  BFkm2 =~ Bkm1_t2 + Bkm4_t2 + Bkm5_t2 + Bkm6_t2
  BFkm3 =~ Bkm1_t3 + Bkm4_t3 + Bkm5_t3 + Bkm6_t3
  BFkm4 =~ Bkm1_t4 + Bkm4_t4 + Bkm5_t4 + Bkm6_t4
  BFkm5 =~ Bkm1_t5 + Bkm4_t5 + Bkm5_t5 + Bkm6_t5
  BFkm6 =~ Bkm1_t6 + Bkm4_t6 + Bkm5_t6 + Bkm6_t6
  BFkm7 =~ Bkm1_t7 + Bkm4_t7 + Bkm5_t7 + Bkm6_t7
  BFkm8 =~ Bkm1_t8 + Bkm4_t8 + Bkm5_t8 + Bkm6_t8
  BFkm9 =~ Bkm1_t9 + Bkm4_t9 + Bkm5_t9 + Bkm6_t9
  BFkm10 =~ Bkm1_t10 + Bkm4_t10 + Bkm5_t10 + Bkm6_t10
  BFkm11 =~ Bkm1_t11 + Bkm4_t11 + Bkm5_t11 + Bkm6_t11
  BFkm12 =~ Bkm1_t12 + Bkm4_t12 + Bkm5_t12 + Bkm6_t12
  BFkm13 =~ Bkm1_t13 + Bkm4_t13 + Bkm5_t13 + Bkm6_t13
  BFkm14 =~ Bkm1_t14 + Bkm4_t14 + Bkm5_t14 + Bkm6_t14
  
  
  # Factor models for ppr at 14 waves (Unconstrained)
  BFppr1 =~ Bppr1_t1 + Bppr2_t1 + Bppr3_t1 + Bppr4_t1
  BFppr2 =~ Bppr1_t2 + Bppr2_t2 + Bppr3_t2 + Bppr4_t2
  BFppr3 =~ Bppr1_t3 + Bppr2_t3 + Bppr3_t3 + Bppr4_t3
  BFppr4 =~ Bppr1_t4 + Bppr2_t4 + Bppr3_t4 + Bppr4_t4
  BFppr5 =~ Bppr1_t5 + Bppr2_t5 + Bppr3_t5 + Bppr4_t5
  BFppr6 =~ Bppr1_t6 + Bppr2_t6 + Bppr3_t6 + Bppr4_t6
  BFppr7 =~ Bppr1_t7 + Bppr2_t7 + Bppr3_t7 + Bppr4_t7
  BFppr8 =~ Bppr1_t8 + Bppr2_t8 + Bppr3_t8 + Bppr4_t8
  BFppr9 =~ Bppr1_t9 + Bppr2_t9 + Bppr3_t9 + Bppr4_t9
  BFppr10 =~ Bppr1_t10 + Bppr2_t10 + Bppr3_t10 + Bppr4_t10
  BFppr11 =~ Bppr1_t11 + Bppr2_t11 + Bppr3_t11 + Bppr4_t11
  BFppr12 =~ Bppr1_t12 + Bppr2_t12 + Bppr3_t12 + Bppr4_t12
  BFppr13 =~ Bppr1_t13 + Bppr2_t13 + Bppr3_t13 + Bppr4_t13
  BFppr14 =~ Bppr1_t14 + Bppr2_t14 + Bppr3_t14 + Bppr4_t14
  
  #### Dyadic residual COvariances at item level #### (individual variances are estimated as part of the cfa function default)
  #KM#
  Akm1_t1 ~~ Bkm1_t1; Akm4_t1 ~~ Bkm4_t1 ;  Akm5_t1 ~~ Bkm5_t1 ;  Akm6_t1 ~~ Bkm6_t1
  Akm1_t2 ~~ Bkm1_t2; Akm4_t2 ~~ Bkm4_t2 ;  Akm5_t2 ~~ Bkm5_t2 ;  Akm6_t2 ~~ Bkm6_t2
  Akm1_t3 ~~ Bkm1_t3; Akm4_t3 ~~ Bkm4_t3 ;  Akm5_t3 ~~ Bkm5_t3 ;  Akm6_t3 ~~ Bkm6_t3
  Akm1_t4 ~~ Bkm1_t4; Akm4_t4 ~~ Bkm4_t4 ;  Akm5_t4 ~~ Bkm5_t4 ;  Akm6_t4 ~~ Bkm6_t4
  Akm1_t5 ~~ Bkm1_t5; Akm4_t5 ~~ Bkm4_t5 ;  Akm5_t5 ~~ Bkm5_t5 ;  Akm6_t5 ~~ Bkm6_t5
  Akm1_t6 ~~ Bkm1_t6; Akm4_t6 ~~ Bkm4_t6 ;  Akm5_t6 ~~ Bkm5_t6 ;  Akm6_t6 ~~ Bkm6_t6
  Akm1_t7 ~~ Bkm1_t7; Akm4_t7 ~~ Bkm4_t7 ;  Akm5_t7 ~~ Bkm5_t7 ;  Akm6_t7 ~~ Bkm6_t7
  Akm1_t8 ~~ Bkm1_t8; Akm4_t8 ~~ Bkm4_t8 ;  Akm5_t8 ~~ Bkm5_t8 ;  Akm6_t8 ~~ Bkm6_t8
  Akm1_t9 ~~ Bkm1_t9; Akm4_t9 ~~ Bkm4_t9 ;  Akm5_t9 ~~ Bkm5_t9 ;  Akm6_t9 ~~ Bkm6_t9
  Akm1_t10 ~~ Bkm1_t10; Akm4_t10 ~~ Bkm4_t10 ; Akm5_t10 ~~ Bkm5_t10 ; Akm6_t10 ~~ Bkm6_t10
  Akm1_t11 ~~ Bkm1_t11; Akm4_t11 ~~ Bkm4_t11 ; Akm5_t11 ~~ Bkm5_t11 ; Akm6_t11 ~~ Bkm6_t11
  Akm1_t12 ~~ Bkm1_t12; Akm4_t12 ~~ Bkm4_t12 ; Akm5_t12 ~~ Bkm5_t12 ; Akm6_t12 ~~ Bkm6_t12
  Akm1_t13 ~~ Bkm1_t13; Akm4_t13 ~~ Bkm4_t13 ; Akm5_t13 ~~ Bkm5_t13 ; Akm6_t13 ~~ Bkm6_t13
  Akm1_t14 ~~ Bkm1_t14; Akm4_t14 ~~ Bkm4_t14 ; Akm5_t14 ~~ Bkm5_t14 ; Akm6_t14 ~~ Bkm6_t14
  
  #PPR#
  Appr1_t1 ~~ Bppr1_t1; Appr4_t1 ~~ Bppr4_t1 ; Appr5_t1 ~~ Bppr5_t1 ; Appr6_t1 ~~ Bppr6_t1
  Appr1_t2 ~~ Bppr1_t2; Appr4_t2 ~~ Bppr4_t2 ; Appr5_t2 ~~ Bppr5_t2 ; Appr6_t2 ~~ Bppr6_t2
  Appr1_t3 ~~ Bppr1_t3; Appr4_t3 ~~ Bppr4_t3 ; Appr5_t3 ~~ Bppr5_t3 ; Appr6_t3 ~~ Bppr6_t3
  Appr1_t4 ~~ Bppr1_t4; Appr4_t4 ~~ Bppr4_t4 ; Appr5_t4 ~~ Bppr5_t4 ; Appr6_t4 ~~ Bppr6_t4
  Appr1_t5 ~~ Bppr1_t5; Appr4_t5 ~~ Bppr4_t5 ; Appr5_t5 ~~ Bppr5_t5 ; Appr6_t5 ~~ Bppr6_t5
  Appr1_t6 ~~ Bppr1_t6; Appr4_t6 ~~ Bppr4_t6 ; Appr5_t6 ~~ Bppr5_t6 ; Appr6_t6 ~~ Bppr6_t6
  Appr1_t7 ~~ Bppr1_t7; Appr4_t7 ~~ Bppr4_t7 ; Appr5_t7 ~~ Bppr5_t7 ; Appr6_t7 ~~ Bppr6_t7
  Appr1_t8 ~~ Bppr1_t8; Appr4_t8 ~~ Bppr4_t8 ; Appr5_t8 ~~ Bppr5_t8 ; Appr6_t8 ~~ Bppr6_t8
  Appr1_t9 ~~ Bppr1_t9; Appr4_t9 ~~ Bppr4_t9 ; Appr5_t9 ~~ Bppr5_t9 ; Appr6_t9 ~~ Bppr6_t9
  Appr1_t10 ~~ Bppr1_t10; Appr4_t10 ~~ Bppr4_t10; Appr5_t10 ~~ Bppr5_t10 ; Appr6_t10 ~~ Bppr6_t10
  Appr1_t11 ~~ Bppr1_t11; Appr4_t11 ~~ Bppr4_t11; Appr5_t11 ~~ Bppr5_t11 ; Appr6_t11 ~~ Bppr6_t11
  Appr1_t12 ~~ Bppr1_t12; Appr4_t12 ~~ Bppr4_t12; Appr5_t12 ~~ Bppr5_t12 ; Appr6_t12 ~~ Bppr6_t12
  Appr1_t13 ~~ Bppr1_t13; Appr4_t13 ~~ Bppr4_t13; Appr5_t13 ~~ Bppr5_t13 ; Appr6_t13 ~~ Bppr6_t13
  Appr1_t14 ~~ Bppr1_t14; Appr4_t14 ~~ Bppr4_t14; Appr5_t14 ~~ Bppr5_t14 ; Appr6_t14 ~~ Bppr6_t14
  
  
  ################
  # BETWEEN PART #
  ################
  
  
  # Create between factors (RIs)
  ARIkm =~ 1*AFkm1 + 1*AFkm2 + 1*AFkm3 + 1*AFkm4 + 1*AFkm5 + 1*AFkm6 + 1*AFkm7 + 1*AFkm8 + 1*AFkm9 + 1*AFkm10 + 1*AFkm11 + 1*AFkm12 + 1*AFkm13 + 1*AFkm14
  ARIppr =~ 1*AFppr1 + 1*AFppr2 + 1*AFppr3 + 1*AFppr4 + 1*AFppr5 + 1*AFppr6 + 1*AFppr7 + 1*AFppr8 + 1*AFppr9 + 1*AFppr10 + 1*AFppr11 + 1*AFppr12 + 1*AFppr13 + 1*AFppr14
  BRIkm =~ 1*BFkm1 + 1*BFkm2 + 1*BFkm3 + 1*BFkm4 + 1*BFkm5 + 1*BFkm6 + 1*BFkm7 + 1*BFkm8 + 1*BFkm9 + 1*BFkm10 + 1*BFkm11 + 1*BFkm12 + 1*BFkm13 + 1*BFkm14
  BRIppr =~ 1*BFppr1 + 1*BFppr2 + 1*BFppr3 + 1*BFppr4 + 1*BFppr5 + 1*BFppr6 + 1*BFppr7 + 1*BFppr8 + 1*BFppr9 + 1*BFppr10 + 1*BFppr11 + 1*BFppr12 + 1*BFppr13 + 1*BFppr14
  
  # Set residual variances of all Fkm and Fppr vars to 0
  # I think this specifies all variance of the factors goes to either w/n or b/n
  AFkm1 ~~ 0*AFkm1
  AFkm2 ~~ 0*AFkm2
  AFkm3 ~~ 0*AFkm3
  AFkm4 ~~ 0*AFkm4
  AFkm5 ~~ 0*AFkm5
  AFkm6 ~~ 0*AFkm6
  AFkm7 ~~ 0*AFkm7
  AFkm8 ~~ 0*AFkm8
  AFkm9 ~~ 0*AFkm9
  AFkm10 ~~ 0*AFkm10
  AFkm11 ~~ 0*AFkm11
  AFkm12 ~~ 0*AFkm12
  AFkm13 ~~ 0*AFkm13
  AFkm14 ~~ 0*AFkm14
  AFppr1 ~~ 0*AFppr1
  AFppr2 ~~ 0*AFppr2
  AFppr3 ~~ 0*AFppr3
  AFppr4 ~~ 0*AFppr4
  AFppr5 ~~ 0*AFppr5
  AFppr6 ~~ 0*AFppr6
  AFppr7 ~~ 0*AFppr7
  AFppr8 ~~ 0*AFppr8
  AFppr9 ~~ 0*AFppr9
  AFppr10 ~~ 0*AFppr10
  AFppr11 ~~ 0*AFppr11
  AFppr12 ~~ 0*AFppr12
  AFppr13 ~~ 0*AFppr13
  AFppr14 ~~ 0*AFppr14
  
  BFkm1 ~~ 0*BFkm1
  BFkm2 ~~ 0*BFkm2
  BFkm3 ~~ 0*BFkm3
  BFkm4 ~~ 0*BFkm4
  BFkm5 ~~ 0*BFkm5
  BFkm6 ~~ 0*BFkm6
  BFkm7 ~~ 0*BFkm7
  BFkm8 ~~ 0*BFkm8
  BFkm9 ~~ 0*BFkm9
  BFkm10 ~~ 0*BFkm10
  BFkm11 ~~ 0*BFkm11
  BFkm12 ~~ 0*BFkm12
  BFkm13 ~~ 0*BFkm13
  BFkm14 ~~ 0*BFkm14
  BFppr1 ~~ 0*BFppr1
  BFppr2 ~~ 0*BFppr2
  BFppr3 ~~ 0*BFppr3
  BFppr4 ~~ 0*BFppr4
  BFppr5 ~~ 0*BFppr5
  BFppr6 ~~ 0*BFppr6
  BFppr7 ~~ 0*BFppr7
  BFppr8 ~~ 0*BFppr8
  BFppr9 ~~ 0*BFppr9
  BFppr10 ~~ 0*BFppr10
  BFppr11 ~~ 0*BFppr11
  BFppr12 ~~ 0*BFppr12
  BFppr13 ~~ 0*BFppr13
  BFppr14 ~~ 0*BFppr14


  ###############
  # WITHIN PART #
  ###############

  # Create within-components
  AWFkm1 =~ 1*AFkm1
  AWFkm2 =~ 1*AFkm2
  AWFkm3 =~ 1*AFkm3
  AWFkm4 =~ 1*AFkm4
  AWFkm5 =~ 1*AFkm5
  AWFkm6 =~ 1*AFkm6
  AWFkm7 =~ 1*AFkm7
  AWFkm8 =~ 1*AFkm8
  AWFkm9 =~ 1*AFkm9
  AWFkm10 =~ 1*AFkm10
  AWFkm11 =~ 1*AFkm11
  AWFkm12 =~ 1*AFkm12
  AWFkm13 =~ 1*AFkm13
  AWFkm14 =~ 1*AFkm14
  
  AWFppr1 =~ 1*AFppr1
  AWFppr2 =~ 1*AFppr2
  AWFppr3 =~ 1*AFppr3
  AWFppr4 =~ 1*AFppr4
  AWFppr5 =~ 1*AFppr5
  AWFppr6 =~ 1*AFppr6
  AWFppr7 =~ 1*AFppr7
  AWFppr8 =~ 1*AFppr8
  AWFppr9 =~ 1*AFppr9
  AWFppr10 =~ 1*AFppr10
  AWFppr11 =~ 1*AFppr11
  AWFppr12 =~ 1*AFppr12
  AWFppr13 =~ 1*AFppr13
  AWFppr14 =~ 1*AFppr14
  
  BWFkm1 =~ 1*BFkm1
  BWFkm2 =~ 1*BFkm2
  BWFkm3 =~ 1*BFkm3
  BWFkm4 =~ 1*BFkm4
  BWFkm5 =~ 1*BFkm5
  BWFkm6 =~ 1*BFkm6
  BWFkm7 =~ 1*BFkm7
  BWFkm8 =~ 1*BFkm8
  BWFkm9 =~ 1*BFkm9
  BWFkm10 =~ 1*BFkm10
  BWFkm11 =~ 1*BFkm11
  BWFkm12 =~ 1*BFkm12
  BWFkm13 =~ 1*BFkm13
  BWFkm14 =~ 1*BFkm14
  
  BWFppr1 =~ 1*BFppr1
  BWFppr2 =~ 1*BFppr2
  BWFppr3 =~ 1*BFppr3
  BWFppr4 =~ 1*BFppr4
  BWFppr5 =~ 1*BFppr5
  BWFppr6 =~ 1*BFppr6
  BWFppr7 =~ 1*BFppr7
  BWFppr8 =~ 1*BFppr8
  BWFppr9 =~ 1*BFppr9
  BWFppr10 =~ 1*BFppr10
  BWFppr11 =~ 1*BFppr11
  BWFppr12 =~ 1*BFppr12
  BWFppr13 =~ 1*BFppr13
  BWFppr14 =~ 1*BFppr14
  
  
  # Specify lagged effects between within-person centered latent variables
  # Should be 8 total (16 maximum, but indistinguishable constraints down half of them)
  # (we need these to account for Partner Bs previous responses; it needs to be partialed. Non specifying these == to saything those paths are zero) 
  # outcome:individual:type
  # kaa = kama muta outcome: actor : autoregressive (coming from kama muta)
  # kpa = kama muta outcome: partner: autoregressive
  # kac = kama muta outcome: actor : crosslagged (coming from ppr)
  # kpc = kama muta outcome: partner : crosslagged

  # For KM effects
  AWFkm2 ~ kaa1*AWFkm1 + kpa1*BWFkm1 + kac1*AWFppr1 + kpc1*BWFppr1 
  AWFkm3 ~ kaa2*AWFkm2 + kpa2*BWFkm2 + kac2*AWFppr2 + kpc2*BWFppr2 
  AWFkm4 ~ kaa3*AWFkm3 + kpa3*BWFkm3 + kac3*AWFppr3 + kpc3*BWFppr3 
  AWFkm5 ~ kaa4*AWFkm4 + kpa4*BWFkm4 + kac4*AWFppr4 + kpc4*BWFppr4 
  AWFkm6 ~ kaa5*AWFkm5 + kpa5*BWFkm5 + kac5*AWFppr5 + kpc5*BWFppr5 
  AWFkm7 ~ kaa6*AWFkm6 + kpa6*BWFkm6 + kac6*AWFppr6 + kpc6*BWFppr6 
  AWFkm8 ~ kaa7*AWFkm7 + kpa7*BWFkm7 + kac7*AWFppr7 + kpc7*BWFppr7 
  AWFkm9 ~ kaa8*AWFkm8 + kpa8*BWFkm8 + kac8*AWFppr8 + kpc8*BWFppr8 
  AWFkm10 ~ kaa9*AWFkm9 + kpa9*BWFkm9 + kac9*AWFppr9 + kpc9*BWFppr9 
  AWFkm11 ~ kaa10*AWFkm10 + kpa10*BWFkm10 + kac10*AWFppr10 + kpc10*BWFppr10 
  AWFkm12 ~ kaa11*AWFkm11 + kpa11*BWFkm11 + kac11*AWFppr11 + kpc11*BWFppr11 
  AWFkm13 ~ kaa12*AWFkm12 + kpa12*BWFkm12 + kac12*AWFppr12 + kpc12*BWFppr12 
  AWFkm14 ~ kaa13*AWFkm13 + kpa13*BWFkm13 + kac13*AWFppr13 + kpc13*BWFppr13 

  # For PPR effects
  AWFppr2 ~ paa1*AWFppr1 + ppa1*BWFppr1 + pac1*AWFkm1 + ppc1*BWFkm1 
  AWFppr3 ~ paa2*AWFppr2 + ppa2*BWFppr2 + pac2*AWFkm2 + ppc2*BWFkm2 
  AWFppr4 ~ paa3*AWFppr3 + ppa3*BWFppr3 + pac3*AWFkm3 + ppc3*BWFkm3 
  AWFppr5 ~ paa4*AWFppr4 + ppa4*BWFppr4 + pac4*AWFkm4 + ppc4*BWFkm4 
  AWFppr6 ~ paa5*AWFppr5 + ppa5*BWFppr5 + pac5*AWFkm5 + ppc5*BWFkm5 
  AWFppr7 ~ paa6*AWFppr6 + ppa6*BWFppr6 + pac6*AWFkm6 + ppc6*BWFkm6 
  AWFppr8 ~ paa7*AWFppr7 + ppa7*BWFppr7 + pac7*AWFkm7 + ppc7*BWFkm7 
  AWFppr9 ~ paa8*AWFppr8 + ppa8*BWFppr8 + pac8*AWFkm8 + ppc8*BWFkm8 
  AWFppr10 ~ paa9*AWFppr9 + ppa9*BWFppr9 + pac9*AWFkm9 + ppc9*BWFkm9 
  AWFppr11 ~ paa10*AWFppr10 + ppa10*BWFppr10 + pac10*AWFkm10 + ppc10*BWFkm10 
  AWFppr12 ~ paa11*AWFppr11 + ppa11*BWFppr11 + pac11*AWFkm11 + ppc11*BWFkm11 
  AWFppr13 ~ paa12*AWFppr12 + ppa12*BWFppr12 + pac12*AWFkm12 + ppc12*BWFkm12 
  AWFppr14 ~ paa13*AWFppr13 + ppa13*BWFppr13 + pac13*AWFkm13 + ppc13*BWFkm13 
 
  
  # Estimate correlations within same wave
  AWFkm1 ~~ s*AWFppr1 + t*BWFkm1 + u*BWFppr1 
  AWFkm2 ~~ s*AWFppr2 + t*BWFkm2 + u*BWFppr2
  AWFkm3 ~~ s*AWFppr3 + t*BWFkm3 + u*BWFppr3
  AWFkm4 ~~ s*AWFppr4 + t*BWFkm4 + u*BWFppr4
  AWFkm5 ~~ s*AWFppr5 + t*BWFkm5 + u*BWFppr5
  AWFkm6 ~~ s*AWFppr6 + t*BWFkm6 + u*BWFppr6
  AWFkm7 ~~ s*AWFppr7 + t*BWFkm7 + u*BWFppr7
  AWFkm8 ~~ s*AWFppr8 + t*BWFkm8 + u*BWFppr8
  AWFkm9 ~~ s*AWFppr9 + t*BWFkm9 + u*BWFppr9
  AWFkm10 ~~ s*AWFppr10 + t*BWFkm10 + u*BWFppr10
  AWFkm11 ~~ s*AWFppr11 + t*BWFkm11 + u*BWFppr11
  AWFkm12 ~~ s*AWFppr12 + t*BWFkm12 + u*BWFppr12
  AWFkm13 ~~ s*AWFppr13 + t*BWFkm13 + u*BWFppr13
  AWFkm14 ~~ s*AWFppr14 + t*BWFkm14 + u*BWFppr14
  
  BWFkm1 ~~ v*AWFppr1 + w*BWFppr1 
  BWFkm2 ~~ v*AWFppr2 + w*BWFppr2
  BWFkm3 ~~ v*AWFppr3 + w*BWFppr3
  BWFkm4 ~~ v*AWFppr4 + w*BWFppr4
  BWFkm5 ~~ v*AWFppr5 + w*BWFppr5
  BWFkm6 ~~ v*AWFppr6 + w*BWFppr6
  BWFkm7 ~~ v*AWFppr7 + w*BWFppr7
  BWFkm8 ~~ v*AWFppr8 + w*BWFppr8
  BWFkm9 ~~ v*AWFppr9 + w*BWFppr9
  BWFkm10 ~~ v*AWFppr10 + w*BWFppr10
  BWFkm11 ~~ v*AWFppr11 + w*BWFppr11
  BWFkm12 ~~ v*AWFppr12 + w*BWFppr12
  BWFkm13 ~~ v*AWFppr13 + w*BWFppr13
  BWFkm14 ~~ v*AWFppr14 + w*BWFppr14
  
  AWFppr1 ~~ x*BWFppr1 
  AWFppr2 ~~ x*BWFppr2
  AWFppr3 ~~ x*BWFppr3
  AWFppr4 ~~ x*BWFppr4
  AWFppr5 ~~ x*BWFppr5
  AWFppr6 ~~ x*BWFppr6
  AWFppr7 ~~ x*BWFppr7
  AWFppr8 ~~ x*BWFppr8
  AWFppr9 ~~ x*BWFppr9
  AWFppr10 ~~ x*BWFppr10
  AWFppr11 ~~ x*BWFppr11
  AWFppr12 ~~ x*BWFppr12
  AWFppr13 ~~ x*BWFppr13
  AWFppr14 ~~ x*BWFppr14
  
  
  ##########################
  # ADDITIONAL CONSTRAINTS #
  ##########################
  
  # Set correlations between between-factors (RIs) and within-factors at wave 1 at 0
  ARIkm + ARIppr + BRIkm + BRIppr ~~ 0*AWFkm1 + 0*AWFppr1 + 0*BWFkm1 + 0*BWFppr1
  
'


base.m1b.fit <- cfa(base.m1b,
                   data = dfSEM,
                   std.lv = T,
                   missing = "ML"
                   )
summary(base.m1b.fit,fit.measures = T, standardized =T, ci = T)
```





base.m1 should get the residuals properly specified there (as per:https://lavaan.ugent.be/tutorial/sem.html, which shows that residual correlations are specified like we have so far). But if we need to make that even more specific, here is how we would do it. This coding is necessary if we want to do a test of indistinguishability which would fix all of these to be the same later on. I think this is overkill atm, but good to have if needed. 
You'd do something like:
eAkm1_t1 =~ 1*Akm1_t1; eAkm1_t1 ~~ a*eAkm1_t1
eBkm1_t1 =~ 1*Bkm1_t1; eBkm1_t1 ~~ a*eBkm1_t1; this would get both Partner A and Partner B to have the same residual variance.
eAkm1_t1 ~~ eBkm1_t1 #correlating residual variances between Partner A and Partner B
```{r}
base.m2 <- '

  #####################
  # MEASUREMENT MODEL #
  #####################
  
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Unconstrained)
  AFkm1 =~ Akm1_t1 + Akm4_t1 + Akm5_t1 + Akm6_t1
  AFkm2 =~ Akm1_t2 + Akm4_t2 + Akm5_t2 + Akm6_t2
  AFkm3 =~ Akm1_t3 + Akm4_t3 + Akm5_t3 + Akm6_t3
  AFkm4 =~ Akm1_t4 + Akm4_t4 + Akm5_t4 + Akm6_t4
  AFkm5 =~ Akm1_t5 + Akm4_t5 + Akm5_t5 + Akm6_t5
  AFkm6 =~ Akm1_t6 + Akm4_t6 + Akm5_t6 + Akm6_t6
  AFkm7 =~ Akm1_t7 + Akm4_t7 + Akm5_t7 + Akm6_t7
  AFkm8 =~ Akm1_t8 + Akm4_t8 + Akm5_t8 + Akm6_t8
  AFkm9 =~ Akm1_t9 + Akm4_t9 + Akm5_t9 + Akm6_t9
  AFkm10 =~ Akm1_t10 + Akm4_t10 + Akm5_t10 + Akm6_t10
  AFkm11 =~ Akm1_t11 + Akm4_t11 + Akm5_t11 + Akm6_t11
  AFkm12 =~ Akm1_t12 + Akm4_t12 + Akm5_t12 + Akm6_t12
  AFkm13 =~ Akm1_t13 + Akm4_t13 + Akm5_t13 + Akm6_t13
  AFkm14 =~ Akm1_t14 + Akm4_t14 + Akm5_t14 + Akm6_t14
  
  
  # Factor models for ppr at 14 waves (Unconstrained)
  AFppr1 =~ Appr1_t1 + Appr2_t1 + Appr3_t1 + Appr4_t1
  AFppr2 =~ Appr1_t2 + Appr2_t2 + Appr3_t2 + Appr4_t2
  AFppr3 =~ Appr1_t3 + Appr2_t3 + Appr3_t3 + Appr4_t3
  AFppr4 =~ Appr1_t4 + Appr2_t4 + Appr3_t4 + Appr4_t4
  AFppr5 =~ Appr1_t5 + Appr2_t5 + Appr3_t5 + Appr4_t5
  AFppr6 =~ Appr1_t6 + Appr2_t6 + Appr3_t6 + Appr4_t6
  AFppr7 =~ Appr1_t7 + Appr2_t7 + Appr3_t7 + Appr4_t7
  AFppr8 =~ Appr1_t8 + Appr2_t8 + Appr3_t8 + Appr4_t8
  AFppr9 =~ Appr1_t9 + Appr2_t9 + Appr3_t9 + Appr4_t9
  AFppr10 =~ Appr1_t10 + Appr2_t10 + Appr3_t10 + Appr4_t10
  AFppr11 =~ Appr1_t11 + Appr2_t11 + Appr3_t11 + Appr4_t11
  AFppr12 =~ Appr1_t12 + Appr2_t12 + Appr3_t12 + Appr4_t12
  AFppr13 =~ Appr1_t13 + Appr2_t13 + Appr3_t13 + Appr4_t13
  AFppr14 =~ Appr1_t14 + Appr2_t14 + Appr3_t14 + Appr4_t14
  
  
   ####### Partner B ######

  # Factor models for km at 14 waves (Unconstrained)
  BFkm1 =~ Bkm1_t1 + Bkm4_t1 + Bkm5_t1 + Bkm6_t1
  BFkm2 =~ Bkm1_t2 + Bkm4_t2 + Bkm5_t2 + Bkm6_t2
  BFkm3 =~ Bkm1_t3 + Bkm4_t3 + Bkm5_t3 + Bkm6_t3
  BFkm4 =~ Bkm1_t4 + Bkm4_t4 + Bkm5_t4 + Bkm6_t4
  BFkm5 =~ Bkm1_t5 + Bkm4_t5 + Bkm5_t5 + Bkm6_t5
  BFkm6 =~ Bkm1_t6 + Bkm4_t6 + Bkm5_t6 + Bkm6_t6
  BFkm7 =~ Bkm1_t7 + Bkm4_t7 + Bkm5_t7 + Bkm6_t7
  BFkm8 =~ Bkm1_t8 + Bkm4_t8 + Bkm5_t8 + Bkm6_t8
  BFkm9 =~ Bkm1_t9 + Bkm4_t9 + Bkm5_t9 + Bkm6_t9
  BFkm10 =~ Bkm1_t10 + Bkm4_t10 + Bkm5_t10 + Bkm6_t10
  BFkm11 =~ Bkm1_t11 + Bkm4_t11 + Bkm5_t11 + Bkm6_t11
  BFkm12 =~ Bkm1_t12 + Bkm4_t12 + Bkm5_t12 + Bkm6_t12
  BFkm13 =~ Bkm1_t13 + Bkm4_t13 + Bkm5_t13 + Bkm6_t13
  BFkm14 =~ Bkm1_t14 + Bkm4_t14 + Bkm5_t14 + Bkm6_t14
  
  
  # Factor models for ppr at 14 waves (Unconstrained)
  BFppr1 =~ Bppr1_t1 + Bppr2_t1 + Bppr3_t1 + Bppr4_t1
  BFppr2 =~ Bppr1_t2 + Bppr2_t2 + Bppr3_t2 + Bppr4_t2
  BFppr3 =~ Bppr1_t3 + Bppr2_t3 + Bppr3_t3 + Bppr4_t3
  BFppr4 =~ Bppr1_t4 + Bppr2_t4 + Bppr3_t4 + Bppr4_t4
  BFppr5 =~ Bppr1_t5 + Bppr2_t5 + Bppr3_t5 + Bppr4_t5
  BFppr6 =~ Bppr1_t6 + Bppr2_t6 + Bppr3_t6 + Bppr4_t6
  BFppr7 =~ Bppr1_t7 + Bppr2_t7 + Bppr3_t7 + Bppr4_t7
  BFppr8 =~ Bppr1_t8 + Bppr2_t8 + Bppr3_t8 + Bppr4_t8
  BFppr9 =~ Bppr1_t9 + Bppr2_t9 + Bppr3_t9 + Bppr4_t9
  BFppr10 =~ Bppr1_t10 + Bppr2_t10 + Bppr3_t10 + Bppr4_t10
  BFppr11 =~ Bppr1_t11 + Bppr2_t11 + Bppr3_t11 + Bppr4_t11
  BFppr12 =~ Bppr1_t12 + Bppr2_t12 + Bppr3_t12 + Bppr4_t12
  BFppr13 =~ Bppr1_t13 + Bppr2_t13 + Bppr3_t13 + Bppr4_t13
  BFppr14 =~ Bppr1_t14 + Bppr2_t14 + Bppr3_t14 + Bppr4_t14
  
  #### Dyadic residual COvariances at item level #### (individual variances are estimated as part of the cfa function default)
  #KM#
  eAkm1_t1 =~ 1*Akm1_t1; eAkm1_t1 ~~ eAkm1_t1 #defining residual variance; then estimating
  eBkm1_t1 =~ 1*Bkm1_t1; eBkm1_t1 ~~ eBkm1_t1; 
  eAkm1_t1 ~~ eBkm1_t1 #correlating residual variances between Partner A and Partner B
  eAkm1_t2 =~ 1*Akm1_t2; eAkm1_t2 ~~ eAkm1_t2 
  eBkm1_t2 =~ 1*Bkm1_t2; eBkm1_t2 ~~ eBkm1_t2; 
  eAkm1_t2 ~~ eBkm1_t2 
  eAkm1_t3 =~ 1*Akm1_t3; eAkm1_t3 ~~ eAkm1_t3 
  eBkm1_t3 =~ 1*Bkm1_t3; eBkm1_t3 ~~ eBkm1_t3; 
  eAkm1_t3 ~~ eBkm1_t3 
  eAkm1_t4 =~ 1*Akm1_t4; eAkm1_t4 ~~ eAkm1_t4 
  eBkm1_t4 =~ 1*Bkm1_t4; eBkm1_t4 ~~ eBkm1_t4; 
  eAkm1_t4 ~~ eBkm1_t4
  eAkm1_t5 =~ 1*Akm1_t5; eAkm1_t5 ~~ eAkm1_t5 
  eBkm1_t5 =~ 1*Bkm1_t5; eBkm1_t5 ~~ eBkm1_t5; 
  eAkm1_t5 ~~ eBkm1_t5 
  eAkm1_t6 =~ 1*Akm1_t6; eAkm1_t6 ~~ eAkm1_t6 
  eBkm1_t6 =~ 1*Bkm1_t6; eBkm1_t6 ~~ eBkm1_t6; 
  eAkm1_t6 ~~ eBkm1_t6 
  eAkm1_t7 =~ 1*Akm1_t7; eAkm1_t7 ~~ eAkm1_t7 
  eBkm1_t7 =~ 1*Bkm1_t7; eBkm1_t7 ~~ eBkm1_t7; 
  eAkm1_t7 ~~ eBkm1_t7 
  eAkm1_t8 =~ 1*Akm1_t8; eAkm1_t8 ~~ eAkm1_t8 
  eBkm1_t8 =~ 1*Bkm1_t8; eBkm1_t8 ~~ eBkm1_t8; 
  eAkm1_t8 ~~ eBkm1_t8 
  eAkm1_t9 =~ 1*Akm1_t9; eAkm1_t9 ~~ eAkm1_t9 
  eBkm1_t9 =~ 1*Bkm1_t9; eBkm1_t9 ~~ eBkm1_t9; 
  eAkm1_t9 ~~ eBkm1_t9 
  eAkm1_t10 =~ 1*Akm1_t10; eAkm1_t10 ~~ eAkm1_t10 
  eBkm1_t10 =~ 1*Bkm1_t10; eBkm1_t10 ~~ eBkm1_t10; 
  eAkm1_t10 ~~ eBkm1_t10 
  eAkm1_t11 =~ 1*Akm1_t11; eAkm1_t11 ~~ eAkm1_t11 
  eBkm1_t11 =~ 1*Bkm1_t11; eBkm1_t11 ~~ eBkm1_t11; 
  eAkm1_t11 ~~ eBkm1_t11 
  eAkm1_t12 =~ 1*Akm1_t12; eAkm1_t12 ~~ eAkm1_t12 
  eBkm1_t12 =~ 1*Bkm1_t12; eBkm1_t12 ~~ eBkm1_t12; 
  eAkm1_t12 ~~ eBkm1_t12 
  eAkm1_t13 =~ 1*Akm1_t13; eAkm1_t13 ~~ eAkm1_t13 
  eBkm1_t13 =~ 1*Bkm1_t13; eBkm1_t13 ~~ eBkm1_t13; 
  eAkm1_t13 ~~ eBkm1_t13 
  eAkm1_t14 =~ 1*Akm1_t14; eAkm1_t14 ~~ eAkm1_t14 
  eBkm1_t14 =~ 1*Bkm1_t14; eBkm1_t14 ~~ eBkm1_t14; 
  eAkm1_t14 ~~ eBkm1_t14 
  
  eAkm2_t1 =~ 1*Akm2_t1; eAkm2_t1 ~~ eAkm2_t1 #defining residual variance; then estimating
  eBkm2_t1 =~ 1*Bkm2_t1; eBkm2_t1 ~~ eBkm2_t1; 
  eAkm2_t1 ~~ eBkm2_t1 #correlating residual variances between Partner A and Partner B
  eAkm2_t2 =~ 1*Akm2_t2; eAkm2_t2 ~~ eAkm2_t2 
  eBkm2_t2 =~ 1*Bkm2_t2; eBkm2_t2 ~~ eBkm2_t2; 
  eAkm2_t2 ~~ eBkm2_t2 
  eAkm2_t3 =~ 1*Akm2_t3; eAkm2_t3 ~~ eAkm2_t3 
  eBkm2_t3 =~ 1*Bkm2_t3; eBkm2_t3 ~~ eBkm2_t3; 
  eAkm2_t3 ~~ eBkm2_t3 
  eAkm2_t4 =~ 1*Akm2_t4; eAkm2_t4 ~~ eAkm2_t4 
  eBkm2_t4 =~ 1*Bkm2_t4; eBkm2_t4 ~~ eBkm2_t4; 
  eAkm2_t4 ~~ eBkm2_t4
  eAkm2_t5 =~ 1*Akm2_t5; eAkm2_t5 ~~ eAkm2_t5 
  eBkm2_t5 =~ 1*Bkm2_t5; eBkm2_t5 ~~ eBkm2_t5; 
  eAkm2_t5 ~~ eBkm2_t5 
  eAkm2_t6 =~ 1*Akm2_t6; eAkm2_t6 ~~ eAkm2_t6 
  eBkm2_t6 =~ 1*Bkm2_t6; eBkm2_t6 ~~ eBkm2_t6; 
  eAkm2_t6 ~~ eBkm2_t6 
  eAkm2_t7 =~ 1*Akm2_t7; eAkm2_t7 ~~ eAkm2_t7 
  eBkm2_t7 =~ 1*Bkm2_t7; eBkm2_t7 ~~ eBkm2_t7; 
  eAkm2_t7 ~~ eBkm2_t7 
  eAkm2_t8 =~ 1*Akm2_t8; eAkm2_t8 ~~ eAkm2_t8 
  eBkm2_t8 =~ 1*Bkm2_t8; eBkm2_t8 ~~ eBkm2_t8; 
  eAkm2_t8 ~~ eBkm2_t8 
  eAkm2_t9 =~ 1*Akm2_t9; eAkm2_t9 ~~ eAkm2_t9 
  eBkm2_t9 =~ 1*Bkm2_t9; eBkm2_t9 ~~ eBkm2_t9; 
  eAkm2_t9 ~~ eBkm2_t9 
  eAkm2_t10 =~ 1*Akm2_t10; eAkm2_t10 ~~ eAkm2_t10 
  eBkm2_t10 =~ 1*Bkm2_t10; eBkm2_t10 ~~ eBkm2_t10; 
  eAkm2_t10 ~~ eBkm2_t10 
  eAkm2_t11 =~ 1*Akm2_t11; eAkm2_t11 ~~ eAkm2_t11 
  eBkm2_t11 =~ 1*Bkm2_t11; eBkm2_t11 ~~ eBkm2_t11; 
  eAkm2_t11 ~~ eBkm2_t11 
  eAkm2_t12 =~ 1*Akm2_t12; eAkm2_t12 ~~ eAkm2_t12 
  eBkm2_t12 =~ 1*Bkm2_t12; eBkm2_t12 ~~ eBkm2_t12; 
  eAkm2_t12 ~~ eBkm2_t12 
  eAkm2_t13 =~ 1*Akm2_t13; eAkm2_t13 ~~ eAkm2_t13 
  eBkm2_t13 =~ 1*Bkm2_t13; eBkm2_t13 ~~ eBkm2_t13; 
  eAkm2_t13 ~~ eBkm2_t13 
  eAkm2_t14 =~ 1*Akm2_t14; eAkm2_t14 ~~ eAkm2_t14 
  eBkm2_t14 =~ 1*Bkm2_t14; eBkm2_t14 ~~ eBkm2_t14; 
  eAkm2_t14 ~~ eBkm2_t14 
  
  #etc. etc. for each one...Oh geez
  
  #PPR#
  eAppr1_t1 =~ 1*Appr1_t1; eAppr1_t1 ~~ eAppr1_t1 #defining residual variance; then estimating
  eBppr1_t1 =~ 1*Bppr1_t1; eBppr1_t1 ~~ eBppr1_t1; 
  eAppr1_t1 ~~ eBppr1_t1 #correlating residual variances between Partner A and Partner B
  eAppr1_t2 =~ 1*Appr1_t2; eAppr1_t2 ~~ eAppr1_t2 
  eBppr1_t2 =~ 1*Bppr1_t2; eBppr1_t2 ~~ eBppr1_t2; 
  eAppr1_t2 ~~ eBppr1_t2 
  eAppr1_t3 =~ 1*Appr1_t3; eAppr1_t3 ~~ eAppr1_t3 
  eBppr1_t3 =~ 1*Bppr1_t3; eBppr1_t3 ~~ eBppr1_t3; 
  eAppr1_t3 ~~ eBppr1_t3 
  eAppr1_t4 =~ 1*Appr1_t4; eAppr1_t4 ~~ eAppr1_t4 
  eBppr1_t4 =~ 1*Bppr1_t4; eBppr1_t4 ~~ eBppr1_t4; 
  eAppr1_t4 ~~ eBppr1_t4
  eAppr1_t5 =~ 1*Appr1_t5; eAppr1_t5 ~~ eAppr1_t5 
  eBppr1_t5 =~ 1*Bppr1_t5; eBppr1_t5 ~~ eBppr1_t5; 
  eAppr1_t5 ~~ eBppr1_t5 
  eAppr1_t6 =~ 1*Appr1_t6; eAppr1_t6 ~~ eAppr1_t6 
  eBppr1_t6 =~ 1*Bppr1_t6; eBppr1_t6 ~~ eBppr1_t6; 
  eAppr1_t6 ~~ eBppr1_t6 
  eAppr1_t7 =~ 1*Appr1_t7; eAppr1_t7 ~~ eAppr1_t7 
  eBppr1_t7 =~ 1*Bppr1_t7; eBppr1_t7 ~~ eBppr1_t7; 
  eAppr1_t7 ~~ eBppr1_t7 
  eAppr1_t8 =~ 1*Appr1_t8; eAppr1_t8 ~~ eAppr1_t8 
  eBppr1_t8 =~ 1*Bppr1_t8; eBppr1_t8 ~~ eBppr1_t8; 
  eAppr1_t8 ~~ eBppr1_t8 
  eAppr1_t9 =~ 1*Appr1_t9; eAppr1_t9 ~~ eAppr1_t9 
  eBppr1_t9 =~ 1*Bppr1_t9; eBppr1_t9 ~~ eBppr1_t9; 
  eAppr1_t9 ~~ eBppr1_t9 
  eAppr1_t10 =~ 1*Appr1_t10; eAppr1_t10 ~~ eAppr1_t10 
  eBppr1_t10 =~ 1*Bppr1_t10; eBppr1_t10 ~~ eBppr1_t10; 
  eAppr1_t10 ~~ eBppr1_t10 
  eAppr1_t11 =~ 1*Appr1_t11; eAppr1_t11 ~~ eAppr1_t11 
  eBppr1_t11 =~ 1*Bppr1_t11; eBppr1_t11 ~~ eBppr1_t11; 
  eAppr1_t11 ~~ eBppr1_t11 
  eAppr1_t12 =~ 1*Appr1_t12; eAppr1_t12 ~~ eAppr1_t12 
  eBppr1_t12 =~ 1*Bppr1_t12; eBppr1_t12 ~~ eBppr1_t12; 
  eAppr1_t12 ~~ eBppr1_t12 
  eAppr1_t13 =~ 1*Appr1_t13; eAppr1_t13 ~~ eAppr1_t13 
  eBppr1_t13 =~ 1*Bppr1_t13; eBppr1_t13 ~~ eBppr1_t13; 
  eAppr1_t13 ~~ eBppr1_t13 
  eAppr1_t14 =~ 1*Appr1_t14; eAppr1_t14 ~~ eAppr1_t14 
  eBppr1_t14 =~ 1*Bppr1_t14; eBppr1_t14 ~~ eBppr1_t14; 
  eAppr1_t14 ~~ eBppr1_t14 
  
  ################
  # BETWEEN PART #
  ################
  
  
  # Create between factors (RIs)
  ARIkm =~ 1*AFkm1 + 1*AFkm2 + 1*AFkm3 + 1*AFkm4 + 1*AFkm5 + 1*AFkm6 + 1*AFkm7 + 1*AFkm8 + 1*AFkm9 + 1*AFkm10 + 1*AFkm11 + 1*AFkm12 + 1*AFkm13 + 1*AFkm14
  ARIppr =~ 1*AFppr1 + 1*AFppr2 + 1*AFppr3 + 1*AFppr4 + 1*AFppr5 + 1*AFppr6 + 1*AFppr7 + 1*AFppr8 + 1*AFppr9 + 1*AFppr10 + 1*AFppr11 + 1*AFppr12 + 1*AFppr13 + 1*AFppr14
  BRIkm =~ 1*BFkm1 + 1*BFkm2 + 1*BFkm3 + 1*BFkm4 + 1*BFkm5 + 1*BFkm6 + 1*BFkm7 + 1*BFkm8 + 1*BFkm9 + 1*BFkm10 + 1*BFkm11 + 1*BFkm12 + 1*BFkm13 + 1*BFkm14
  BRIppr =~ 1*BFppr1 + 1*BFppr2 + 1*BFppr3 + 1*BFppr4 + 1*BFppr5 + 1*BFppr6 + 1*BFppr7 + 1*BFppr8 + 1*BFppr9 + 1*BFppr10 + 1*BFppr11 + 1*BFppr12 + 1*BFppr13 + 1*BFppr14
  
  # Set residual variances of all Fkm and Fppr vars to 0
  # I think this specifies all variance of the factors goes to either w/n or b/n
  AFkm1 ~~ 0*AFkm1
  AFkm2 ~~ 0*AFkm2
  AFkm3 ~~ 0*AFkm3
  AFkm4 ~~ 0*AFkm4
  AFkm5 ~~ 0*AFkm5
  AFkm6 ~~ 0*AFkm6
  AFkm7 ~~ 0*AFkm7
  AFkm8 ~~ 0*AFkm8
  AFkm9 ~~ 0*AFkm9
  AFkm10 ~~ 0*AFkm10
  AFkm11 ~~ 0*AFkm11
  AFkm12 ~~ 0*AFkm12
  AFkm13 ~~ 0*AFkm13
  AFkm14 ~~ 0*AFkm14
  AFppr1 ~~ 0*AFppr1
  AFppr2 ~~ 0*AFppr2
  AFppr3 ~~ 0*AFppr3
  AFppr4 ~~ 0*AFppr4
  AFppr5 ~~ 0*AFppr5
  AFppr6 ~~ 0*AFppr6
  AFppr7 ~~ 0*AFppr7
  AFppr8 ~~ 0*AFppr8
  AFppr9 ~~ 0*AFppr9
  AFppr10 ~~ 0*AFppr10
  AFppr11 ~~ 0*AFppr11
  AFppr12 ~~ 0*AFppr12
  AFppr13 ~~ 0*AFppr13
  AFppr14 ~~ 0*AFppr14
  
  BFkm1 ~~ 0*BFkm1
  BFkm2 ~~ 0*BFkm2
  BFkm3 ~~ 0*BFkm3
  BFkm4 ~~ 0*BFkm4
  BFkm5 ~~ 0*BFkm5
  BFkm6 ~~ 0*BFkm6
  BFkm7 ~~ 0*BFkm7
  BFkm8 ~~ 0*BFkm8
  BFkm9 ~~ 0*BFkm9
  BFkm10 ~~ 0*BFkm10
  BFkm11 ~~ 0*BFkm11
  BFkm12 ~~ 0*BFkm12
  BFkm13 ~~ 0*BFkm13
  BFkm14 ~~ 0*BFkm14
  BFppr1 ~~ 0*BFppr1
  BFppr2 ~~ 0*BFppr2
  BFppr3 ~~ 0*BFppr3
  BFppr4 ~~ 0*BFppr4
  BFppr5 ~~ 0*BFppr5
  BFppr6 ~~ 0*BFppr6
  BFppr7 ~~ 0*BFppr7
  BFppr8 ~~ 0*BFppr8
  BFppr9 ~~ 0*BFppr9
  BFppr10 ~~ 0*BFppr10
  BFppr11 ~~ 0*BFppr11
  BFppr12 ~~ 0*BFppr12
  BFppr13 ~~ 0*BFppr13
  BFppr14 ~~ 0*BFppr14


  ###############
  # WITHIN PART #
  ###############

  # Create within-components
  AWFkm1 =~ 1*AFkm1
  AWFkm2 =~ 1*AFkm2
  AWFkm3 =~ 1*AFkm3
  AWFkm4 =~ 1*AFkm4
  AWFkm5 =~ 1*AFkm5
  AWFkm6 =~ 1*AFkm6
  AWFkm7 =~ 1*AFkm7
  AWFkm8 =~ 1*AFkm8
  AWFkm9 =~ 1*AFkm9
  AWFkm10 =~ 1*AFkm10
  AWFkm11 =~ 1*AFkm11
  AWFkm12 =~ 1*AFkm12
  AWFkm13 =~ 1*AFkm13
  AWFkm14 =~ 1*AFkm14
  
  AWFppr1 =~ 1*AFppr1
  AWFppr2 =~ 1*AFppr2
  AWFppr3 =~ 1*AFppr3
  AWFppr4 =~ 1*AFppr4
  AWFppr5 =~ 1*AFppr5
  AWFppr6 =~ 1*AFppr6
  AWFppr7 =~ 1*AFppr7
  AWFppr8 =~ 1*AFppr8
  AWFppr9 =~ 1*AFppr9
  AWFppr10 =~ 1*AFppr10
  AWFppr11 =~ 1*AFppr11
  AWFppr12 =~ 1*AFppr12
  AWFppr13 =~ 1*AFppr13
  AWFppr14 =~ 1*AFppr14
  
  BWFkm1 =~ 1*BFkm1
  BWFkm2 =~ 1*BFkm2
  BWFkm3 =~ 1*BFkm3
  BWFkm4 =~ 1*BFkm4
  BWFkm5 =~ 1*BFkm5
  BWFkm6 =~ 1*BFkm6
  BWFkm7 =~ 1*BFkm7
  BWFkm8 =~ 1*BFkm8
  BWFkm9 =~ 1*BFkm9
  BWFkm10 =~ 1*BFkm10
  BWFkm11 =~ 1*BFkm11
  BWFkm12 =~ 1*BFkm12
  BWFkm13 =~ 1*BFkm13
  BWFkm14 =~ 1*BFkm14
  
  BWFppr1 =~ 1*BFppr1
  BWFppr2 =~ 1*BFppr2
  BWFppr3 =~ 1*BFppr3
  BWFppr4 =~ 1*BFppr4
  BWFppr5 =~ 1*BFppr5
  BWFppr6 =~ 1*BFppr6
  BWFppr7 =~ 1*BFppr7
  BWFppr8 =~ 1*BFppr8
  BWFppr9 =~ 1*BFppr9
  BWFppr10 =~ 1*BFppr10
  BWFppr11 =~ 1*BFppr11
  BWFppr12 =~ 1*BFppr12
  BWFppr13 =~ 1*BFppr13
  BWFppr14 =~ 1*BFppr14
  
  
  # Specify lagged effects between within-person centered latent variables
  AWFkm2 + AWFppr2 ~ AWFkm1 + AWFppr1 + BWFkm1 + BWFppr1 
  AWFkm3 + AWFppr3 ~ AWFkm2 + AWFppr2 + BWFkm2 + BWFppr2
  AWFkm4 + AWFppr4 ~ AWFkm3 + AWFppr3 + BWFkm3 + BWFppr3
  AWFkm5 + AWFppr5 ~ AWFkm4 + AWFppr4 + BWFkm4 + BWFppr4
  AWFkm6 + AWFppr6 ~ AWFkm5 + AWFppr5 + BWFkm5 + BWFppr5
  AWFkm7 + AWFppr7 ~ AWFkm6 + AWFppr6 + BWFkm6 + BWFppr6 
  AWFkm8 + AWFppr8 ~ AWFkm7 + AWFppr7 + BWFkm7 + BWFppr7
  AWFkm9 + AWFppr9 ~ AWFkm8 + AWFppr8 + BWFkm8 + BWFppr8
  AWFkm10 + AWFppr10 ~ AWFkm9 + AWFppr9 + BWFkm9 + BWFppr9
  AWFkm11 + AWFppr11 ~ AWFkm10 + AWFppr10 + BWFkm10 + BWFppr10
  AWFkm12 + AWFppr12 ~ AWFkm11 + AWFppr11 + BWFkm11 + BWFppr11
  AWFkm13 + AWFppr13 ~ AWFkm12 + AWFppr12 + BWFkm12 + BWFppr12
  AWFkm14 + AWFppr14 ~ AWFkm13 + AWFppr13 + BWFkm13 + BWFppr13
  
  
  # Estimate correlations within same wave
  AWFkm1 ~~ s*AWFppr1 + t*BWFkm1 + u*BWFppr1 
  AWFkm2 ~~ s*AWFppr2 + t*BWFkm2 + u*BWFppr2
  AWFkm3 ~~ s*AWFppr3 + t*BWFkm3 + u*BWFppr3
  AWFkm4 ~~ s*AWFppr4 + t*BWFkm4 + u*BWFppr4
  AWFkm5 ~~ s*AWFppr5 + t*BWFkm5 + u*BWFppr5
  AWFkm6 ~~ s*AWFppr6 + t*BWFkm6 + u*BWFppr6
  AWFkm7 ~~ s*AWFppr7 + t*BWFkm7 + u*BWFppr7
  AWFkm8 ~~ s*AWFppr8 + t*BWFkm8 + u*BWFppr8
  AWFkm9 ~~ s*AWFppr9 + t*BWFkm9 + u*BWFppr9
  AWFkm10 ~~ s*AWFppr10 + t*BWFkm10 + u*BWFppr10
  AWFkm11 ~~ s*AWFppr11 + t*BWFkm11 + u*BWFppr11
  AWFkm12 ~~ s*AWFppr12 + t*BWFkm12 + u*BWFppr12
  AWFkm13 ~~ s*AWFppr13 + t*BWFkm13 + u*BWFppr13
  AWFkm14 ~~ s*AWFppr14 + t*BWFkm14 + u*BWFppr14
  
  BWFkm1 ~~ v*AWFppr1 + w*BWFppr1 
  BWFkm2 ~~ v*AWFppr2 + w*BWFppr2
  BWFkm3 ~~ v*AWFppr3 + w*BWFppr3
  BWFkm4 ~~ v*AWFppr4 + w*BWFppr4
  BWFkm5 ~~ v*AWFppr5 + w*BWFppr5
  BWFkm6 ~~ v*AWFppr6 + w*BWFppr6
  BWFkm7 ~~ v*AWFppr7 + w*BWFppr7
  BWFkm8 ~~ v*AWFppr8 + w*BWFppr8
  BWFkm9 ~~ v*AWFppr9 + w*BWFppr9
  BWFkm10 ~~ v*AWFppr10 + w*BWFppr10
  BWFkm11 ~~ v*AWFppr11 + w*BWFppr11
  BWFkm12 ~~ v*AWFppr12 + w*BWFppr12
  BWFkm13 ~~ v*AWFppr13 + w*BWFppr13
  BWFkm14 ~~ v*AWFppr14 + w*BWFppr14
  
  AWFppr1 ~~ x*BWFppr1 
  AWFppr2 ~~ x*BWFppr2
  AWFppr3 ~~ x*BWFppr3
  AWFppr4 ~~ x*BWFppr4
  AWFppr5 ~~ x*BWFppr5
  AWFppr6 ~~ x*BWFppr6
  AWFppr7 ~~ x*BWFppr7
  AWFppr8 ~~ x*BWFppr8
  AWFppr9 ~~ x*BWFppr9
  AWFppr10 ~~ x*BWFppr10
  AWFppr11 ~~ x*BWFppr11
  AWFppr12 ~~ x*BWFppr12
  AWFppr13 ~~ x*BWFppr13
  AWFppr14 ~~ x*BWFppr14
  
  
  ##########################
  # ADDITIONAL CONSTRAINTS #
  ##########################
  
  # Set correlations between between-factors (RIs) and within-factors at wave 1 at 0
  ARIkm + ARIppr + BRIkm + BRIppr ~~ 0*AWFkm1 + 0*AWFppr1 + 0*BWFkm1 + 0*BWFppr1
  
'


base.m2.fit <- cfa(base.m2,
                   data = dfSEM,
                   std.lv = T,
                   missing = "ML"
                   )
summary(base.m2.fit,fit.measures = T, standardized =T, ci = T)
```

#### Weak factor invariance model

--loading or weak or metric invariance is whether the item loadings are equivalent across the groups/individuals. This is tested by constraining the item loadings to be equal across groups/individuals
```{r}
weak.m1 <- '

  #####################
  # MEASUREMENT MODEL #
  #####################
  
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Constrained)
  AFkm1 =~ a*Akm1_t1 + d*Akm4_t1 + e*Akm5_t1 + f*Akm6_t1
  AFkm2 =~ a*Akm1_t2 + d*Akm4_t2 + e*Akm5_t2 + f*Akm6_t2
  AFkm3 =~ a*Akm1_t3 + d*Akm4_t3 + e*Akm5_t3 + f*Akm6_t3
  AFkm4 =~ a*Akm1_t4 + d*Akm4_t4 + e*Akm5_t4 + f*Akm6_t4
  AFkm5 =~ a*Akm1_t5 + d*Akm4_t5 + e*Akm5_t5 + f*Akm6_t5
  AFkm6 =~ a*Akm1_t6 + d*Akm4_t6 + e*Akm5_t6 + f*Akm6_t6
  AFkm7 =~ a*Akm1_t7 + d*Akm4_t7 + e*Akm5_t7 + f*Akm6_t7
  AFkm8 =~ a*Akm1_t8 + d*Akm4_t8 + e*Akm5_t8 + f*Akm6_t8
  AFkm9 =~ a*Akm1_t9 + d*Akm4_t9 + e*Akm5_t9 + f*Akm6_t9
  AFkm10 =~ a*Akm1_t10 + d*Akm4_t10 + e*Akm5_t10 + f*Akm6_t10
  AFkm11 =~ a*Akm1_t11 + d*Akm4_t11 + e*Akm5_t11 + f*Akm6_t11
  AFkm12 =~ a*Akm1_t12 + d*Akm4_t12 + e*Akm5_t12 + f*Akm6_t12
  AFkm13 =~ a*Akm1_t13 + d*Akm4_t13 + e*Akm5_t13 + f*Akm6_t13
  AFkm14 =~ a*Akm1_t14 + d*Akm4_t14 + e*Akm5_t14 + f*Akm6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  AFppr1 =~ g*Appr1_t1 + h*Appr2_t1 + i*Appr3_t1 + j*Appr4_t1
  AFppr2 =~ g*Appr1_t2 + h*Appr2_t2 + i*Appr3_t2 + j*Appr4_t2
  AFppr3 =~ g*Appr1_t3 + h*Appr2_t3 + i*Appr3_t3 + j*Appr4_t3
  AFppr4 =~ g*Appr1_t4 + h*Appr2_t4 + i*Appr3_t4 + j*Appr4_t4
  AFppr5 =~ g*Appr1_t5 + h*Appr2_t5 + i*Appr3_t5 + j*Appr4_t5
  AFppr6 =~ g*Appr1_t6 + h*Appr2_t6 + i*Appr3_t6 + j*Appr4_t6
  AFppr7 =~ g*Appr1_t7 + h*Appr2_t7 + i*Appr3_t7 + j*Appr4_t7
  AFppr8 =~ g*Appr1_t8 + h*Appr2_t8 + i*Appr3_t8 + j*Appr4_t8
  AFppr9 =~ g*Appr1_t9 + h*Appr2_t9 + i*Appr3_t9 + j*Appr4_t9
  AFppr10 =~ g*Appr1_t10 + h*Appr2_t10 + i*Appr3_t10 + j*Appr4_t10
  AFppr11 =~ g*Appr1_t11 + h*Appr2_t11 + i*Appr3_t11 + j*Appr4_t11
  AFppr12 =~ g*Appr1_t12 + h*Appr2_t12 + i*Appr3_t12 + j*Appr4_t12
  AFppr13 =~ g*Appr1_t13 + h*Appr2_t13 + i*Appr3_t13 + j*Appr4_t13
  AFppr14 =~ g*Appr1_t14 + h*Appr2_t14 + i*Appr3_t14 + j*Appr4_t14
  
  
   ####### Partner B ######
  #NOTE: Same constraints as the actor imposed here because the partners are indistinguishable--who is "Actor" and "Bartner" for a given couple is arbitrary. E.g. the alternative does not make sense--that all actors have a particular loading of their factors or regression effects, while the partners are different (again, since actor and partner does not hold inherent meaning, like male/female or child/parent, we would not expect those parameters to deviate consistently across the entire sample)
  
  # Factor models for km at 14 waves (Constrained)
  BFkm1 =~ a*Bkm1_t1 + d*Bkm4_t1 + e*Bkm5_t1 + f*Bkm6_t1
  BFkm2 =~ a*Bkm1_t2 + d*Bkm4_t2 + e*Bkm5_t2 + f*Bkm6_t2
  BFkm3 =~ a*Bkm1_t3 + d*Bkm4_t3 + e*Bkm5_t3 + f*Bkm6_t3
  BFkm4 =~ a*Bkm1_t4 + d*Bkm4_t4 + e*Bkm5_t4 + f*Bkm6_t4
  BFkm5 =~ a*Bkm1_t5 + d*Bkm4_t5 + e*Bkm5_t5 + f*Bkm6_t5
  BFkm6 =~ a*Bkm1_t6 + d*Bkm4_t6 + e*Bkm5_t6 + f*Bkm6_t6
  BFkm7 =~ a*Bkm1_t7 + d*Bkm4_t7 + e*Bkm5_t7 + f*Bkm6_t7
  BFkm8 =~ a*Bkm1_t8 + d*Bkm4_t8 + e*Bkm5_t8 + f*Bkm6_t8
  BFkm9 =~ a*Bkm1_t9 + d*Bkm4_t9 + e*Bkm5_t9 + f*Bkm6_t9
  BFkm10 =~ a*Bkm1_t10 + d*Bkm4_t10 + e*Bkm5_t10 + f*Bkm6_t10
  BFkm11 =~ a*Bkm1_t11 + d*Bkm4_t11 + e*Bkm5_t11 + f*Bkm6_t11
  BFkm12 =~ a*Bkm1_t12 + d*Bkm4_t12 + e*Bkm5_t12 + f*Bkm6_t12
  BFkm13 =~ a*Bkm1_t13 + d*Bkm4_t13 + e*Bkm5_t13 + f*Bkm6_t13
  BFkm14 =~ a*Bkm1_t14 + d*Bkm4_t14 + e*Bkm5_t14 + f*Bkm6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  BFppr1 =~ g*Bppr1_t1 + h*Bppr2_t1 + i*Bppr3_t1 + j*Bppr4_t1
  BFppr2 =~ g*Bppr1_t2 + h*Bppr2_t2 + i*Bppr3_t2 + j*Bppr4_t2
  BFppr3 =~ g*Bppr1_t3 + h*Bppr2_t3 + i*Bppr3_t3 + j*Bppr4_t3
  BFppr4 =~ g*Bppr1_t4 + h*Bppr2_t4 + i*Bppr3_t4 + j*Bppr4_t4
  BFppr5 =~ g*Bppr1_t5 + h*Bppr2_t5 + i*Bppr3_t5 + j*Bppr4_t5
  BFppr6 =~ g*Bppr1_t6 + h*Bppr2_t6 + i*Bppr3_t6 + j*Bppr4_t6
  BFppr7 =~ g*Bppr1_t7 + h*Bppr2_t7 + i*Bppr3_t7 + j*Bppr4_t7
  BFppr8 =~ g*Bppr1_t8 + h*Bppr2_t8 + i*Bppr3_t8 + j*Bppr4_t8
  BFppr9 =~ g*Bppr1_t9 + h*Bppr2_t9 + i*Bppr3_t9 + j*Bppr4_t9
  BFppr10 =~ g*Bppr1_t10 + h*Bppr2_t10 + i*Bppr3_t10 + j*Bppr4_t10
  BFppr11 =~ g*Bppr1_t11 + h*Bppr2_t11 + i*Bppr3_t11 + j*Bppr4_t11
  BFppr12 =~ g*Bppr1_t12 + h*Bppr2_t12 + i*Bppr3_t12 + j*Bppr4_t12
  BFppr13 =~ g*Bppr1_t13 + h*Bppr2_t13 + i*Bppr3_t13 + j*Bppr4_t13
  BFppr14 =~ g*Bppr1_t14 + h*Bppr2_t14 + i*Bppr3_t14 + j*Bppr4_t14
  
   #### Dyadic residual COvariances at item level #### (individual variances are estimated as part of the cfa function default)
  #KM#
  Akm1_t1 ~~ Bkm1_t1; Akm4_t1 ~~ Bkm4_t1 ;  Akm5_t1 ~~ Bkm5_t1 ;  Akm6_t1 ~~ Bkm6_t1
  Akm1_t2 ~~ Bkm1_t2; Akm4_t2 ~~ Bkm4_t2 ;  Akm5_t2 ~~ Bkm5_t2 ;  Akm6_t2 ~~ Bkm6_t2
  Akm1_t3 ~~ Bkm1_t3; Akm4_t3 ~~ Bkm4_t3 ;  Akm5_t3 ~~ Bkm5_t3 ;  Akm6_t3 ~~ Bkm6_t3
  Akm1_t4 ~~ Bkm1_t4; Akm4_t4 ~~ Bkm4_t4 ;  Akm5_t4 ~~ Bkm5_t4 ;  Akm6_t4 ~~ Bkm6_t4
  Akm1_t5 ~~ Bkm1_t5; Akm4_t5 ~~ Bkm4_t5 ;  Akm5_t5 ~~ Bkm5_t5 ;  Akm6_t5 ~~ Bkm6_t5
  Akm1_t6 ~~ Bkm1_t6; Akm4_t6 ~~ Bkm4_t6 ;  Akm5_t6 ~~ Bkm5_t6 ;  Akm6_t6 ~~ Bkm6_t6
  Akm1_t7 ~~ Bkm1_t7; Akm4_t7 ~~ Bkm4_t7 ;  Akm5_t7 ~~ Bkm5_t7 ;  Akm6_t7 ~~ Bkm6_t7
  Akm1_t8 ~~ Bkm1_t8; Akm4_t8 ~~ Bkm4_t8 ;  Akm5_t8 ~~ Bkm5_t8 ;  Akm6_t8 ~~ Bkm6_t8
  Akm1_t9 ~~ Bkm1_t9; Akm4_t9 ~~ Bkm4_t9 ;  Akm5_t9 ~~ Bkm5_t9 ;  Akm6_t9 ~~ Bkm6_t9
  Akm1_t10 ~~ Bkm1_t10; Akm4_t10 ~~ Bkm4_t10 ; Akm5_t10 ~~ Bkm5_t10 ; Akm6_t10 ~~ Bkm6_t10
  Akm1_t11 ~~ Bkm1_t11; Akm4_t11 ~~ Bkm4_t11 ; Akm5_t11 ~~ Bkm5_t11 ; Akm6_t11 ~~ Bkm6_t11
  Akm1_t12 ~~ Bkm1_t12; Akm4_t12 ~~ Bkm4_t12 ; Akm5_t12 ~~ Bkm5_t12 ; Akm6_t12 ~~ Bkm6_t12
  Akm1_t13 ~~ Bkm1_t13; Akm4_t13 ~~ Bkm4_t13 ; Akm5_t13 ~~ Bkm5_t13 ; Akm6_t13 ~~ Bkm6_t13
  Akm1_t14 ~~ Bkm1_t14; Akm4_t14 ~~ Bkm4_t14 ; Akm5_t14 ~~ Bkm5_t14 ; Akm6_t14 ~~ Bkm6_t14
  
  #PPR#
  Appr1_t1 ~~ Bppr1_t1; Appr2_t1 ~~ Bppr2_t1 ; Appr3_t1 ~~ Bppr3_t1 ; Appr4_t1 ~~ Bppr4_t1
  Appr1_t2 ~~ Bppr1_t2; Appr2_t2 ~~ Bppr2_t2 ; Appr3_t2 ~~ Bppr3_t2 ; Appr4_t2 ~~ Bppr4_t2
  Appr1_t3 ~~ Bppr1_t3; Appr2_t3 ~~ Bppr2_t3 ; Appr3_t3 ~~ Bppr3_t3 ; Appr4_t3 ~~ Bppr4_t3
  Appr1_t4 ~~ Bppr1_t4; Appr2_t4 ~~ Bppr2_t4 ; Appr3_t4 ~~ Bppr3_t4 ; Appr4_t4 ~~ Bppr4_t4
  Appr1_t5 ~~ Bppr1_t5; Appr2_t5 ~~ Bppr2_t5 ; Appr3_t5 ~~ Bppr3_t5 ; Appr4_t5 ~~ Bppr4_t5
  Appr1_t6 ~~ Bppr1_t6; Appr2_t6 ~~ Bppr2_t6 ; Appr3_t6 ~~ Bppr3_t6 ; Appr4_t6 ~~ Bppr4_t6
  Appr1_t7 ~~ Bppr1_t7; Appr2_t7 ~~ Bppr2_t7 ; Appr3_t7 ~~ Bppr3_t7 ; Appr4_t7 ~~ Bppr4_t7
  Appr1_t8 ~~ Bppr1_t8; Appr2_t8 ~~ Bppr2_t8 ; Appr3_t8 ~~ Bppr3_t8 ; Appr4_t8 ~~ Bppr4_t8
  Appr1_t9 ~~ Bppr1_t9; Appr2_t9 ~~ Bppr2_t9 ; Appr3_t9 ~~ Bppr3_t9 ; Appr4_t9 ~~ Bppr4_t9
  Appr1_t10 ~~ Bppr1_t10; Appr2_t10 ~~ Bppr2_t10; Appr3_t10 ~~ Bppr3_t10 ; Appr4_t10 ~~ Bppr4_t10
  Appr1_t11 ~~ Bppr1_t11; Appr2_t11 ~~ Bppr2_t11; Appr3_t11 ~~ Bppr3_t11 ; Appr4_t11 ~~ Bppr4_t11
  Appr1_t12 ~~ Bppr1_t12; Appr2_t12 ~~ Bppr2_t12; Appr3_t12 ~~ Bppr3_t12 ; Appr4_t12 ~~ Bppr4_t12
  Appr1_t13 ~~ Bppr1_t13; Appr2_t13 ~~ Bppr2_t13; Appr3_t13 ~~ Bppr3_t13 ; Appr4_t13 ~~ Bppr4_t13
  Appr1_t14 ~~ Bppr1_t14; Appr2_t14 ~~ Bppr2_t14; Appr3_t14 ~~ Bppr3_t14 ; Appr4_t14 ~~ Bppr4_t14
  
  ################
  # BETWEEN PART #
  ################
  
  
  # Create between factors (RIs)
  ARIkm =~ 1*AFkm1 + 1*AFkm2 + 1*AFkm3 + 1*AFkm4 + 1*AFkm5 + 1*AFkm6 + 1*AFkm7 + 1*AFkm8 + 1*AFkm9 + 1*AFkm10 + 1*AFkm11 + 1*AFkm12 + 1*AFkm13 + 1*AFkm14
  ARIppr =~ 1*AFppr1 + 1*AFppr2 + 1*AFppr3 + 1*AFppr4 + 1*AFppr5 + 1*AFppr6 + 1*AFppr7 + 1*AFppr8 + 1*AFppr9 + 1*AFppr10 + 1*AFppr11 + 1*AFppr12 + 1*AFppr13 + 1*AFppr14
  BRIkm =~ 1*BFkm1 + 1*BFkm2 + 1*BFkm3 + 1*BFkm4 + 1*BFkm5 + 1*BFkm6 + 1*BFkm7 + 1*BFkm8 + 1*BFkm9 + 1*BFkm10 + 1*BFkm11 + 1*BFkm12 + 1*BFkm13 + 1*BFkm14
  BRIppr =~ 1*BFppr1 + 1*BFppr2 + 1*BFppr3 + 1*BFppr4 + 1*BFppr5 + 1*BFppr6 + 1*BFppr7 + 1*BFppr8 + 1*BFppr9 + 1*BFppr10 + 1*BFppr11 + 1*BFppr12 + 1*BFppr13 + 1*BFppr14
  
  # Set residual variances of all Fkm and Fppr vars to 0
  # I think this specifies all variance of the factors goes to either w/n or b/n
  AFkm1 ~~ 0*AFkm1
  AFkm2 ~~ 0*AFkm2
  AFkm3 ~~ 0*AFkm3
  AFkm4 ~~ 0*AFkm4
  AFkm5 ~~ 0*AFkm5
  AFkm6 ~~ 0*AFkm6
  AFkm7 ~~ 0*AFkm7
  AFkm8 ~~ 0*AFkm8
  AFkm9 ~~ 0*AFkm9
  AFkm10 ~~ 0*AFkm10
  AFkm11 ~~ 0*AFkm11
  AFkm12 ~~ 0*AFkm12
  AFkm13 ~~ 0*AFkm13
  AFkm14 ~~ 0*AFkm14
  AFppr1 ~~ 0*AFppr1
  AFppr2 ~~ 0*AFppr2
  AFppr3 ~~ 0*AFppr3
  AFppr4 ~~ 0*AFppr4
  AFppr5 ~~ 0*AFppr5
  AFppr6 ~~ 0*AFppr6
  AFppr7 ~~ 0*AFppr7
  AFppr8 ~~ 0*AFppr8
  AFppr9 ~~ 0*AFppr9
  AFppr10 ~~ 0*AFppr10
  AFppr11 ~~ 0*AFppr11
  AFppr12 ~~ 0*AFppr12
  AFppr13 ~~ 0*AFppr13
  AFppr14 ~~ 0*AFppr14
  
  BFkm1 ~~ 0*BFkm1
  BFkm2 ~~ 0*BFkm2
  BFkm3 ~~ 0*BFkm3
  BFkm4 ~~ 0*BFkm4
  BFkm5 ~~ 0*BFkm5
  BFkm6 ~~ 0*BFkm6
  BFkm7 ~~ 0*BFkm7
  BFkm8 ~~ 0*BFkm8
  BFkm9 ~~ 0*BFkm9
  BFkm10 ~~ 0*BFkm10
  BFkm11 ~~ 0*BFkm11
  BFkm12 ~~ 0*BFkm12
  BFkm13 ~~ 0*BFkm13
  BFkm14 ~~ 0*BFkm14
  BFppr1 ~~ 0*BFppr1
  BFppr2 ~~ 0*BFppr2
  BFppr3 ~~ 0*BFppr3
  BFppr4 ~~ 0*BFppr4
  BFppr5 ~~ 0*BFppr5
  BFppr6 ~~ 0*BFppr6
  BFppr7 ~~ 0*BFppr7
  BFppr8 ~~ 0*BFppr8
  BFppr9 ~~ 0*BFppr9
  BFppr10 ~~ 0*BFppr10
  BFppr11 ~~ 0*BFppr11
  BFppr12 ~~ 0*BFppr12
  BFppr13 ~~ 0*BFppr13
  BFppr14 ~~ 0*BFppr14


  ###############
  # WITHIN BART #
  ###############

  # Create within-components
  AWFkm1 =~ 1*AFkm1
  AWFkm2 =~ 1*AFkm2
  AWFkm3 =~ 1*AFkm3
  AWFkm4 =~ 1*AFkm4
  AWFkm5 =~ 1*AFkm5
  AWFkm6 =~ 1*AFkm6
  AWFkm7 =~ 1*AFkm7
  AWFkm8 =~ 1*AFkm8
  AWFkm9 =~ 1*AFkm9
  AWFkm10 =~ 1*AFkm10
  AWFkm11 =~ 1*AFkm11
  AWFkm12 =~ 1*AFkm12
  AWFkm13 =~ 1*AFkm13
  AWFkm14 =~ 1*AFkm14
  
  AWFppr1 =~ 1*AFppr1
  AWFppr2 =~ 1*AFppr2
  AWFppr3 =~ 1*AFppr3
  AWFppr4 =~ 1*AFppr4
  AWFppr5 =~ 1*AFppr5
  AWFppr6 =~ 1*AFppr6
  AWFppr7 =~ 1*AFppr7
  AWFppr8 =~ 1*AFppr8
  AWFppr9 =~ 1*AFppr9
  AWFppr10 =~ 1*AFppr10
  AWFppr11 =~ 1*AFppr11
  AWFppr12 =~ 1*AFppr12
  AWFppr13 =~ 1*AFppr13
  AWFppr14 =~ 1*AFppr14
  
  BWFkm1 =~ 1*BFkm1
  BWFkm2 =~ 1*BFkm2
  BWFkm3 =~ 1*BFkm3
  BWFkm4 =~ 1*BFkm4
  BWFkm5 =~ 1*BFkm5
  BWFkm6 =~ 1*BFkm6
  BWFkm7 =~ 1*BFkm7
  BWFkm8 =~ 1*BFkm8
  BWFkm9 =~ 1*BFkm9
  BWFkm10 =~ 1*BFkm10
  BWFkm11 =~ 1*BFkm11
  BWFkm12 =~ 1*BFkm12
  BWFkm13 =~ 1*BFkm13
  BWFkm14 =~ 1*BFkm14
  
  BWFppr1 =~ 1*BFppr1
  BWFppr2 =~ 1*BFppr2
  BWFppr3 =~ 1*BFppr3
  BWFppr4 =~ 1*BFppr4
  BWFppr5 =~ 1*BFppr5
  BWFppr6 =~ 1*BFppr6
  BWFppr7 =~ 1*BFppr7
  BWFppr8 =~ 1*BFppr8
  BWFppr9 =~ 1*BFppr9
  BWFppr10 =~ 1*BFppr10
  BWFppr11 =~ 1*BFppr11
  BWFppr12 =~ 1*BFppr12
  BWFppr13 =~ 1*BFppr13
  BWFppr14 =~ 1*BFppr14
  
  # Specify lagged effects between within-person centered latent variables
  # Should be 8 total (16 maximum, but indistinguishable constraints down half of them)
    # (we need these to account for Partner Bs previous responses; it needs to be partialed. Non specifying these == to saything those paths are zero) 
  # outcome:individual:type
  # kaa = kama muta outcome: actor : autoregressive (coming from kama muta)
  # kpa = kama muta outcome: partner: autoregressive
  # kac = kama muta outcome: actor : crosslagged (coming from ppr)
  # kpc = kama muta outcome: partner : crosslagged

  # For KM effects.
  AWFkm2 ~ kaa1*AWFkm1 + kpa1*BWFkm1 + kac1*AWFppr1 + kpc1*BWFppr1 
  BWFkm2 ~ kaa1*BWFkm1 + kpa1*AWFkm1 + kac1*BWFppr1 + kpc1*AWFppr1
  AWFkm3 ~ kaa2*AWFkm2 + kpa2*BWFkm2 + kac2*AWFppr2 + kpc2*BWFppr2 
  BWFkm3 ~ kaa2*BWFkm2 + kpa2*AWFkm2 + kac2*BWFppr2 + kpc2*AWFppr2
  AWFkm4 ~ kaa3*AWFkm3 + kpa3*BWFkm3 + kac3*AWFppr3 + kpc3*BWFppr3 
  BWFkm4 ~ kaa3*BWFkm3 + kpa3*AWFkm3 + kac3*BWFppr3 + kpc3*AWFppr3
  AWFkm5 ~ kaa4*AWFkm4 + kpa4*BWFkm4 + kac4*AWFppr4 + kpc4*BWFppr4 
  BWFkm5 ~ kaa4*BWFkm4 + kpa4*AWFkm4 + kac4*BWFppr4 + kpc4*AWFppr4
  AWFkm6 ~ kaa5*AWFkm5 + kpa5*BWFkm5 + kac5*AWFppr5 + kpc5*BWFppr5 
  BWFkm6 ~ kaa5*BWFkm5 + kpa5*AWFkm5 + kac5*BWFppr5 + kpc5*AWFppr5
  AWFkm7 ~ kaa6*AWFkm6 + kpa6*BWFkm6 + kac6*AWFppr6 + kpc6*BWFppr6 
  BWFkm7 ~ kaa6*BWFkm6 + kpa6*AWFkm6 + kac6*BWFppr6 + kpc6*AWFppr6
  AWFkm8 ~ kaa7*AWFkm7 + kpa7*BWFkm7 + kac7*AWFppr7 + kpc7*BWFppr7 
  BWFkm8 ~ kaa7*BWFkm7 + kpa7*AWFkm7 + kac7*BWFppr7 + kpc7*AWFppr7
  AWFkm9 ~ kaa8*AWFkm8 + kpa8*BWFkm8 + kac8*AWFppr8 + kpc8*BWFppr8 
  BWFkm9 ~ kaa8*BWFkm8 + kpa8*AWFkm8 + kac8*BWFppr8 + kpc8*AWFppr8
  AWFkm10 ~ kaa9*AWFkm9 + kpa9*BWFkm9 + kac9*AWFppr9 + kpc9*BWFppr9 
  BWFkm10 ~ kaa9*BWFkm9 + kpa9*AWFkm9 + kac9*BWFppr9 + kpc9*AWFppr9
  AWFkm11 ~ kaa10*AWFkm10 + kpa10*BWFkm10 + kac10*AWFppr10 + kpc10*BWFppr10 
  BWFkm11 ~ kaa10*BWFkm10 + kpa10*AWFkm10 + kac10*BWFppr10 + kpc10*AWFppr10
  AWFkm12 ~ kaa11*AWFkm11 + kpa11*BWFkm11 + kac11*AWFppr11 + kpc11*BWFppr11 
  BWFkm12 ~ kaa11*BWFkm11 + kpa11*AWFkm11 + kac11*BWFppr11 + kpc11*AWFppr11
  AWFkm13 ~ kaa12*AWFkm12 + kpa12*BWFkm12 + kac12*AWFppr12 + kpc12*BWFppr12 
  BWFkm13 ~ kaa12*BWFkm12 + kpa12*AWFkm12 + kac12*BWFppr12 + kpc12*AWFppr12
  AWFkm14 ~ kaa13*AWFkm13 + kpa13*BWFkm13 + kac13*AWFppr13 + kpc13*BWFppr13 
  BWFkm14 ~ kaa13*BWFkm13 + kpa13*AWFkm13 + kac13*BWFppr13 + kpc13*AWFppr13
  
  # For PPR effects
  AWFppr2 ~ paa1*AWFppr1 + ppa1*BWFppr1 + pac1*AWFkm1 + ppc1*BWFkm1 
  BWFppr2 ~ paa1*BWFppr1 + ppa1*AWFppr1 + pac1*BWFkm1 + ppc1*AWFkm1
  AWFppr3 ~ paa2*AWFppr2 + ppa2*BWFppr2 + pac2*AWFkm2 + ppc2*BWFkm2 
  BWFppr3 ~ paa2*BWFppr2 + ppa2*AWFppr2 + pac2*BWFkm2 + ppc2*AWFkm2
  AWFppr4 ~ paa3*AWFppr3 + ppa3*BWFppr3 + pac3*AWFkm3 + ppc3*BWFkm3 
  BWFppr4 ~ paa3*BWFppr3 + ppa3*AWFppr3 + pac3*BWFkm3 + ppc3*AWFkm3
  AWFppr5 ~ paa4*AWFppr4 + ppa4*BWFppr4 + pac4*AWFkm4 + ppc4*BWFkm4 
  BWFppr5 ~ paa4*BWFppr4 + ppa4*AWFppr4 + pac4*BWFkm4 + ppc4*AWFkm4
  AWFppr6 ~ paa5*AWFppr5 + ppa5*BWFppr5 + pac5*AWFkm5 + ppc5*BWFkm5 
  BWFppr6 ~ paa5*BWFppr5 + ppa5*AWFppr5 + pac5*BWFkm5 + ppc5*AWFkm5
  AWFppr7 ~ paa6*AWFppr6 + ppa6*BWFppr6 + pac6*AWFkm6 + ppc6*BWFkm6 
  BWFppr7 ~ paa6*BWFppr6 + ppa6*AWFppr6 + pac6*BWFkm6 + ppc6*AWFkm6
  AWFppr8 ~ paa7*AWFppr7 + ppa7*BWFppr7 + pac7*AWFkm7 + ppc7*BWFkm7 
  BWFppr8 ~ paa7*BWFppr7 + ppa7*AWFppr7 + pac7*BWFkm7 + ppc7*AWFkm7
  AWFppr9 ~ paa8*AWFppr8 + ppa8*BWFppr8 + pac8*AWFkm8 + ppc8*BWFkm8 
  BWFppr9 ~ paa8*BWFppr8 + ppa8*AWFppr8 + pac8*BWFkm8 + ppc8*AWFkm8
  AWFppr10 ~ paa9*AWFppr9 + ppa9*BWFppr9 + pac9*AWFkm9 + ppc9*BWFkm9 
  BWFppr10 ~ paa9*BWFppr9 + ppa9*AWFppr9 + pac9*BWFkm9 + ppc9*AWFkm9
  AWFppr11 ~ paa10*AWFppr10 + ppa10*BWFppr10 + pac10*AWFkm10 + ppc10*BWFkm10 
  BWFppr11 ~ paa10*BWFppr10 + ppa10*AWFppr10 + pac10*BWFkm10 + ppc10*AWFkm10
  AWFppr12 ~ paa11*AWFppr11 + ppa11*BWFppr11 + pac11*AWFkm11 + ppc11*BWFkm11 
  BWFppr12 ~ paa11*BWFppr11 + ppa11*AWFppr11 + pac11*BWFkm11 + ppc11*AWFkm11
  AWFppr13 ~ paa12*AWFppr12 + ppa12*BWFppr12 + pac12*AWFkm12 + ppc12*BWFkm12 
  BWFppr13 ~ paa12*BWFppr12 + ppa12*AWFppr12 + pac12*BWFkm12 + ppc12*AWFkm12
  AWFppr14 ~ paa13*AWFppr13 + ppa13*BWFppr13 + pac13*AWFkm13 + ppc13*BWFkm13 
  BWFppr14 ~ paa13*BWFppr13 + ppa13*AWFppr13 + pac13*BWFkm13 + ppc13*AWFkm13
  
  
  # Estimate correlations within same wave
  AWFkm1 ~~ s*AWFppr1 + t*BWFkm1 + u*BWFppr1 
  AWFkm2 ~~ s*AWFppr2 + t*BWFkm2 + u*BWFppr2
  AWFkm3 ~~ s*AWFppr3 + t*BWFkm3 + u*BWFppr3
  AWFkm4 ~~ s*AWFppr4 + t*BWFkm4 + u*BWFppr4
  AWFkm5 ~~ s*AWFppr5 + t*BWFkm5 + u*BWFppr5
  AWFkm6 ~~ s*AWFppr6 + t*BWFkm6 + u*BWFppr6
  AWFkm7 ~~ s*AWFppr7 + t*BWFkm7 + u*BWFppr7
  AWFkm8 ~~ s*AWFppr8 + t*BWFkm8 + u*BWFppr8
  AWFkm9 ~~ s*AWFppr9 + t*BWFkm9 + u*BWFppr9
  AWFkm10 ~~ s*AWFppr10 + t*BWFkm10 + u*BWFppr10
  AWFkm11 ~~ s*AWFppr11 + t*BWFkm11 + u*BWFppr11
  AWFkm12 ~~ s*AWFppr12 + t*BWFkm12 + u*BWFppr12
  AWFkm13 ~~ s*AWFppr13 + t*BWFkm13 + u*BWFppr13
  AWFkm14 ~~ s*AWFppr14 + t*BWFkm14 + u*BWFppr14
  
  BWFkm1 ~~ v*AWFppr1 + w*BWFppr1 
  BWFkm2 ~~ v*AWFppr2 + w*BWFppr2
  BWFkm3 ~~ v*AWFppr3 + w*BWFppr3
  BWFkm4 ~~ v*AWFppr4 + w*BWFppr4
  BWFkm5 ~~ v*AWFppr5 + w*BWFppr5
  BWFkm6 ~~ v*AWFppr6 + w*BWFppr6
  BWFkm7 ~~ v*AWFppr7 + w*BWFppr7
  BWFkm8 ~~ v*AWFppr8 + w*BWFppr8
  BWFkm9 ~~ v*AWFppr9 + w*BWFppr9
  BWFkm10 ~~ v*AWFppr10 + w*BWFppr10
  BWFkm11 ~~ v*AWFppr11 + w*BWFppr11
  BWFkm12 ~~ v*AWFppr12 + w*BWFppr12
  BWFkm13 ~~ v*AWFppr13 + w*BWFppr13
  BWFkm14 ~~ v*AWFppr14 + w*BWFppr14
  
  AWFppr1 ~~ x*BWFppr1 
  AWFppr2 ~~ x*BWFppr2
  AWFppr3 ~~ x*BWFppr3
  AWFppr4 ~~ x*BWFppr4
  AWFppr5 ~~ x*BWFppr5
  AWFppr6 ~~ x*BWFppr6
  AWFppr7 ~~ x*BWFppr7
  AWFppr8 ~~ x*BWFppr8
  AWFppr9 ~~ x*BWFppr9
  AWFppr10 ~~ x*BWFppr10
  AWFppr11 ~~ x*BWFppr11
  AWFppr12 ~~ x*BWFppr12
  AWFppr13 ~~ x*BWFppr13
  AWFppr14 ~~ x*BWFppr14
  
  
  ##########################
  # ADDITIONAL CONSTRAINTS #
  ##########################
  
  # Set correlations between between-factors (RIs) and within-factors at wave 1 at 0
  ARIkm + ARIppr + BRIkm + BRIppr ~~ 0*AWFkm1 + 0*AWFppr1 + 0*BWFkm1 + 0*BWFppr1
  
'


weak.m1.fit <- cfa(weak.m1,
                   data = dfSEM,
                   std.lv = T,
                   missing = "ML"
                   )
summary(weak.m1.fit,fit.measures = T, standardized =T, ci = T)
```


#### Strong
Copying from the strong invariance model (the best one for S3). Build off of this one
--Intercept or scalar invariance is when the items are expected to have the same predicted value when their corresponding latent vars take on a value of zero. E.g. if your latent var of PPR is 0, I would expect all the items to have the same value (0). 
We test this by using a constrained item loading model (weak) and adding on constraints for the item intercepts to be equal 

```{r}
strong.m1 <- '

  #####################
  # MEASUREMENT MODEL #
  #####################
  
  ####### Partner A ######
  
  # Factor models for km at 14 waves (Constrained)
  AFkm1 =~ a*Akm1_t1 + d*Akm4_t1 + e*Akm5_t1 + f*Akm6_t1
  AFkm2 =~ a*Akm1_t2 + d*Akm4_t2 + e*Akm5_t2 + f*Akm6_t2
  AFkm3 =~ a*Akm1_t3 + d*Akm4_t3 + e*Akm5_t3 + f*Akm6_t3
  AFkm4 =~ a*Akm1_t4 + d*Akm4_t4 + e*Akm5_t4 + f*Akm6_t4
  AFkm5 =~ a*Akm1_t5 + d*Akm4_t5 + e*Akm5_t5 + f*Akm6_t5
  AFkm6 =~ a*Akm1_t6 + d*Akm4_t6 + e*Akm5_t6 + f*Akm6_t6
  AFkm7 =~ a*Akm1_t7 + d*Akm4_t7 + e*Akm5_t7 + f*Akm6_t7
  AFkm8 =~ a*Akm1_t8 + d*Akm4_t8 + e*Akm5_t8 + f*Akm6_t8
  AFkm9 =~ a*Akm1_t9 + d*Akm4_t9 + e*Akm5_t9 + f*Akm6_t9
  AFkm10 =~ a*Akm1_t10 + d*Akm4_t10 + e*Akm5_t10 + f*Akm6_t10
  AFkm11 =~ a*Akm1_t11 + d*Akm4_t11 + e*Akm5_t11 + f*Akm6_t11
  AFkm12 =~ a*Akm1_t12 + d*Akm4_t12 + e*Akm5_t12 + f*Akm6_t12
  AFkm13 =~ a*Akm1_t13 + d*Akm4_t13 + e*Akm5_t13 + f*Akm6_t13
  AFkm14 =~ a*Akm1_t14 + d*Akm4_t14 + e*Akm5_t14 + f*Akm6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  AFppr1 =~ g*Appr1_t1 + h*Appr2_t1 + i*Appr3_t1 + j*Appr4_t1
  AFppr2 =~ g*Appr1_t2 + h*Appr2_t2 + i*Appr3_t2 + j*Appr4_t2
  AFppr3 =~ g*Appr1_t3 + h*Appr2_t3 + i*Appr3_t3 + j*Appr4_t3
  AFppr4 =~ g*Appr1_t4 + h*Appr2_t4 + i*Appr3_t4 + j*Appr4_t4
  AFppr5 =~ g*Appr1_t5 + h*Appr2_t5 + i*Appr3_t5 + j*Appr4_t5
  AFppr6 =~ g*Appr1_t6 + h*Appr2_t6 + i*Appr3_t6 + j*Appr4_t6
  AFppr7 =~ g*Appr1_t7 + h*Appr2_t7 + i*Appr3_t7 + j*Appr4_t7
  AFppr8 =~ g*Appr1_t8 + h*Appr2_t8 + i*Appr3_t8 + j*Appr4_t8
  AFppr9 =~ g*Appr1_t9 + h*Appr2_t9 + i*Appr3_t9 + j*Appr4_t9
  AFppr10 =~ g*Appr1_t10 + h*Appr2_t10 + i*Appr3_t10 + j*Appr4_t10
  AFppr11 =~ g*Appr1_t11 + h*Appr2_t11 + i*Appr3_t11 + j*Appr4_t11
  AFppr12 =~ g*Appr1_t12 + h*Appr2_t12 + i*Appr3_t12 + j*Appr4_t12
  AFppr13 =~ g*Appr1_t13 + h*Appr2_t13 + i*Appr3_t13 + j*Appr4_t13
  AFppr14 =~ g*Appr1_t14 + h*Appr2_t14 + i*Appr3_t14 + j*Appr4_t14
  
  
  # Constrained intercepts over time (Strong invariance constraint)
  Akm1_t1 + Akm1_t2 + Akm1_t3 + Akm1_t4 + Akm1_t5 + Akm1_t6 + Akm1_t7 + Akm1_t8 + Akm1_t9 + Akm1_t10 + Akm1_t11 + Akm1_t12 + Akm1_t13 + Akm1_t14  ~ k*1
  Akm4_t1 + Akm4_t2 + Akm4_t3 + Akm4_t4 + Akm4_t5 + Akm4_t6 + Akm4_t7 + Akm4_t8 + Akm4_t9 + Akm4_t10 + Akm4_t11 + Akm4_t12 + Akm4_t13 + Akm4_t14 ~ l*1
  Akm5_t1 + Akm5_t2 + Akm5_t3 + Akm5_t4 + Akm5_t5 + Akm5_t6 + Akm5_t7 + Akm5_t8 + Akm5_t9 + Akm5_t10 + Akm5_t11 + Akm5_t12 + Akm5_t13 + Akm5_t14 ~ m*1
  Akm6_t1 + Akm6_t2 + Akm6_t3 + Akm6_t4 + Akm6_t5 + Akm6_t6 + Akm6_t7 + Akm6_t8 + Akm6_t9 + Akm6_t10 + Akm6_t11 + Akm6_t12 + Akm6_t13 + Akm6_t14 ~ n*1
  
  Appr1_t1 + Appr1_t2 + Appr1_t3 + Appr1_t4 + Appr1_t5 + Appr1_t6 + Appr1_t7 + Appr1_t8 + Appr1_t9 + Appr1_t10 + Appr1_t11 + Appr1_t12 + Appr1_t13 + Appr1_t14 ~ o*1
  Appr2_t1 + Appr2_t2 + Appr2_t3 + Appr2_t4 + Appr2_t5 + Appr2_t6 + Appr2_t7 + Appr2_t8 + Appr2_t9 + Appr2_t10 + Appr2_t11 + Appr2_t12 + Appr2_t13 + Appr2_t14 ~ p*1
  Appr3_t1 + Appr3_t2 + Appr3_t3 + Appr3_t4 + Appr3_t5 + Appr3_t6 + Appr3_t7 + Appr3_t8 + Appr3_t9 + Appr3_t10 + Appr3_t11 + Appr3_t12 + Appr3_t13 + Appr3_t14 ~ q*1
  Appr4_t1 + Appr4_t2 + Appr4_t3 + Appr4_t4 + Appr4_t5 + Appr4_t6 + Appr4_t7 + Appr4_t8 + Appr4_t9 + Appr4_t10 + Appr4_t11 + Appr4_t12 + Appr4_t13 + Appr4_t14 ~ r*1
  
  
  # Free latent means from t=2 onward (Strong invariance constraint: only do this in combination with constraints on intercepts, above)
  AFkm2 + AFkm3 + AFkm4 + AFkm5 + AFkm6 + AFkm7 + AFkm8 + AFkm9 + AFkm10 + AFkm11 + AFkm12 + AFkm13 + AFkm14 + AFppr2 + AFppr3 + AFppr4 + AFppr5 + AFppr6 + AFppr7 + AFppr8 + AFppr9 + AFppr10 + AFppr11 + AFppr12 + AFppr13 + AFppr14 ~ 1
  
  ####### Partner B ######
  #NOTE: Same constraints as the actor imposed here because the partners are indistinguishable--who is "Actor" and "Bartner" for a given couple is arbitrary. E.g. the alternative does not make sense--that all actors have a particular loading of their factors or regression effects, while the partners are different (again, since actor and partner does not hold inherent meaning, like male/female or child/parent, we would not expect those parameters to deviate consistently across the entire sample)
  
  # Factor models for km at 14 waves (Constrained)
  BFkm1 =~ a*Bkm1_t1 + d*Bkm4_t1 + e*Bkm5_t1 + f*Bkm6_t1
  BFkm2 =~ a*Bkm1_t2 + d*Bkm4_t2 + e*Bkm5_t2 + f*Bkm6_t2
  BFkm3 =~ a*Bkm1_t3 + d*Bkm4_t3 + e*Bkm5_t3 + f*Bkm6_t3
  BFkm4 =~ a*Bkm1_t4 + d*Bkm4_t4 + e*Bkm5_t4 + f*Bkm6_t4
  BFkm5 =~ a*Bkm1_t5 + d*Bkm4_t5 + e*Bkm5_t5 + f*Bkm6_t5
  BFkm6 =~ a*Bkm1_t6 + d*Bkm4_t6 + e*Bkm5_t6 + f*Bkm6_t6
  BFkm7 =~ a*Bkm1_t7 + d*Bkm4_t7 + e*Bkm5_t7 + f*Bkm6_t7
  BFkm8 =~ a*Bkm1_t8 + d*Bkm4_t8 + e*Bkm5_t8 + f*Bkm6_t8
  BFkm9 =~ a*Bkm1_t9 + d*Bkm4_t9 + e*Bkm5_t9 + f*Bkm6_t9
  BFkm10 =~ a*Bkm1_t10 + d*Bkm4_t10 + e*Bkm5_t10 + f*Bkm6_t10
  BFkm11 =~ a*Bkm1_t11 + d*Bkm4_t11 + e*Bkm5_t11 + f*Bkm6_t11
  BFkm12 =~ a*Bkm1_t12 + d*Bkm4_t12 + e*Bkm5_t12 + f*Bkm6_t12
  BFkm13 =~ a*Bkm1_t13 + d*Bkm4_t13 + e*Bkm5_t13 + f*Bkm6_t13
  BFkm14 =~ a*Bkm1_t14 + d*Bkm4_t14 + e*Bkm5_t14 + f*Bkm6_t14
  
  
  # Factor models for ppr at 14 waves (Constrained)
  BFppr1 =~ g*Bppr1_t1 + h*Bppr2_t1 + i*Bppr3_t1 + j*Bppr4_t1
  BFppr2 =~ g*Bppr1_t2 + h*Bppr2_t2 + i*Bppr3_t2 + j*Bppr4_t2
  BFppr3 =~ g*Bppr1_t3 + h*Bppr2_t3 + i*Bppr3_t3 + j*Bppr4_t3
  BFppr4 =~ g*Bppr1_t4 + h*Bppr2_t4 + i*Bppr3_t4 + j*Bppr4_t4
  BFppr5 =~ g*Bppr1_t5 + h*Bppr2_t5 + i*Bppr3_t5 + j*Bppr4_t5
  BFppr6 =~ g*Bppr1_t6 + h*Bppr2_t6 + i*Bppr3_t6 + j*Bppr4_t6
  BFppr7 =~ g*Bppr1_t7 + h*Bppr2_t7 + i*Bppr3_t7 + j*Bppr4_t7
  BFppr8 =~ g*Bppr1_t8 + h*Bppr2_t8 + i*Bppr3_t8 + j*Bppr4_t8
  BFppr9 =~ g*Bppr1_t9 + h*Bppr2_t9 + i*Bppr3_t9 + j*Bppr4_t9
  BFppr10 =~ g*Bppr1_t10 + h*Bppr2_t10 + i*Bppr3_t10 + j*Bppr4_t10
  BFppr11 =~ g*Bppr1_t11 + h*Bppr2_t11 + i*Bppr3_t11 + j*Bppr4_t11
  BFppr12 =~ g*Bppr1_t12 + h*Bppr2_t12 + i*Bppr3_t12 + j*Bppr4_t12
  BFppr13 =~ g*Bppr1_t13 + h*Bppr2_t13 + i*Bppr3_t13 + j*Bppr4_t13
  BFppr14 =~ g*Bppr1_t14 + h*Bppr2_t14 + i*Bppr3_t14 + j*Bppr4_t14
  
  
  
  # Constrained intercepts over time (Strong invariance constraint)
  Bkm1_t1 + Bkm1_t2 + Bkm1_t3 + Bkm1_t4 + Bkm1_t5 + Bkm1_t6 + Bkm1_t7 + Bkm1_t8 + Bkm1_t9 + Bkm1_t10 + Bkm1_t11 + Bkm1_t12 + Bkm1_t13 + Bkm1_t14  ~ k*1
  Bkm4_t1 + Bkm4_t2 + Bkm4_t3 + Bkm4_t4 + Bkm4_t5 + Bkm4_t6 + Bkm4_t7 + Bkm4_t8 + Bkm4_t9 + Bkm4_t10 + Bkm4_t11 + Bkm4_t12 + Bkm4_t13 + Bkm4_t14 ~ l*1
  Bkm5_t1 + Bkm5_t2 + Bkm5_t3 + Bkm5_t4 + Bkm5_t5 + Bkm5_t6 + Bkm5_t7 + Bkm5_t8 + Bkm5_t9 + Bkm5_t10 + Bkm5_t11 + Bkm5_t12 + Bkm5_t13 + Bkm5_t14 ~ m*1
  Bkm6_t1 + Bkm6_t2 + Bkm6_t3 + Bkm6_t4 + Bkm6_t5 + Bkm6_t6 + Bkm6_t7 + Bkm6_t8 + Bkm6_t9 + Bkm6_t10 + Bkm6_t11 + Bkm6_t12 + Bkm6_t13 + Bkm6_t14 ~ n*1
  
  Bppr1_t1 + Bppr1_t2 + Bppr1_t3 + Bppr1_t4 + Bppr1_t5 + Bppr1_t6 + Bppr1_t7 + Bppr1_t8 + Bppr1_t9 + Bppr1_t10 + Bppr1_t11 + Bppr1_t12 + Bppr1_t13 + Bppr1_t14 ~ o*1
  Bppr2_t1 + Bppr2_t2 + Bppr2_t3 + Bppr2_t4 + Bppr2_t5 + Bppr2_t6 + Bppr2_t7 + Bppr2_t8 + Bppr2_t9 + Bppr2_t10 + Bppr2_t11 + Bppr2_t12 + Bppr2_t13 + Bppr2_t14 ~ p*1
  Bppr3_t1 + Bppr3_t2 + Bppr3_t3 + Bppr3_t4 + Bppr3_t5 + Bppr3_t6 + Bppr3_t7 + Bppr3_t8 + Bppr3_t9 + Bppr3_t10 + Bppr3_t11 + Bppr3_t12 + Bppr3_t13 + Bppr3_t14 ~ q*1
  Bppr4_t1 + Bppr4_t2 + Bppr4_t3 + Bppr4_t4 + Bppr4_t5 + Bppr4_t6 + Bppr4_t7 + Bppr4_t8 + Bppr4_t9 + Bppr4_t10 + Bppr4_t11 + Bppr4_t12 + Bppr4_t13 + Bppr4_t14 ~ r*1
  
  
  
  # Free latent means from t=2 onward (Strong invariance constraint: only do this in combination with constraints on intercepts, above)
  BFkm2 + BFkm3 + BFkm4 + BFkm5 + BFkm6 + BFkm7 + BFkm8 + BFkm9 + BFkm10 + BFkm11 + BFkm12 + BFkm13 + BFkm14 + BFppr2 + BFppr3 + BFppr4 + BFppr5 + BFppr6 + BFppr7 + BFppr8 + BFppr9 + BFppr10 + BFppr11 + BFppr12 + BFppr13 + BFppr14 ~ 1  
  
  #### Dyadic residual COvariances at item level #### (individual variances are estimated as part of the cfa function default)
  #KM#
  Akm1_t1 ~~ Bkm1_t1; Akm4_t1 ~~ Bkm4_t1 ;  Akm5_t1 ~~ Bkm5_t1 ;  Akm6_t1 ~~ Bkm6_t1
  Akm1_t2 ~~ Bkm1_t2; Akm4_t2 ~~ Bkm4_t2 ;  Akm5_t2 ~~ Bkm5_t2 ;  Akm6_t2 ~~ Bkm6_t2
  Akm1_t3 ~~ Bkm1_t3; Akm4_t3 ~~ Bkm4_t3 ;  Akm5_t3 ~~ Bkm5_t3 ;  Akm6_t3 ~~ Bkm6_t3
  Akm1_t4 ~~ Bkm1_t4; Akm4_t4 ~~ Bkm4_t4 ;  Akm5_t4 ~~ Bkm5_t4 ;  Akm6_t4 ~~ Bkm6_t4
  Akm1_t5 ~~ Bkm1_t5; Akm4_t5 ~~ Bkm4_t5 ;  Akm5_t5 ~~ Bkm5_t5 ;  Akm6_t5 ~~ Bkm6_t5
  Akm1_t6 ~~ Bkm1_t6; Akm4_t6 ~~ Bkm4_t6 ;  Akm5_t6 ~~ Bkm5_t6 ;  Akm6_t6 ~~ Bkm6_t6
  Akm1_t7 ~~ Bkm1_t7; Akm4_t7 ~~ Bkm4_t7 ;  Akm5_t7 ~~ Bkm5_t7 ;  Akm6_t7 ~~ Bkm6_t7
  Akm1_t8 ~~ Bkm1_t8; Akm4_t8 ~~ Bkm4_t8 ;  Akm5_t8 ~~ Bkm5_t8 ;  Akm6_t8 ~~ Bkm6_t8
  Akm1_t9 ~~ Bkm1_t9; Akm4_t9 ~~ Bkm4_t9 ;  Akm5_t9 ~~ Bkm5_t9 ;  Akm6_t9 ~~ Bkm6_t9
  Akm1_t10 ~~ Bkm1_t10; Akm4_t10 ~~ Bkm4_t10 ; Akm5_t10 ~~ Bkm5_t10 ; Akm6_t10 ~~ Bkm6_t10
  Akm1_t11 ~~ Bkm1_t11; Akm4_t11 ~~ Bkm4_t11 ; Akm5_t11 ~~ Bkm5_t11 ; Akm6_t11 ~~ Bkm6_t11
  Akm1_t12 ~~ Bkm1_t12; Akm4_t12 ~~ Bkm4_t12 ; Akm5_t12 ~~ Bkm5_t12 ; Akm6_t12 ~~ Bkm6_t12
  Akm1_t13 ~~ Bkm1_t13; Akm4_t13 ~~ Bkm4_t13 ; Akm5_t13 ~~ Bkm5_t13 ; Akm6_t13 ~~ Bkm6_t13
  Akm1_t14 ~~ Bkm1_t14; Akm4_t14 ~~ Bkm4_t14 ; Akm5_t14 ~~ Bkm5_t14 ; Akm6_t14 ~~ Bkm6_t14
  
  #PPR#
  Appr1_t1 ~~ Bppr1_t1; Appr4_t1 ~~ Bppr4_t1 ; Appr5_t1 ~~ Bppr5_t1 ; Appr6_t1 ~~ Bppr6_t1
  Appr1_t2 ~~ Bppr1_t2; Appr4_t2 ~~ Bppr4_t2 ; Appr5_t2 ~~ Bppr5_t2 ; Appr6_t2 ~~ Bppr6_t2
  Appr1_t3 ~~ Bppr1_t3; Appr4_t3 ~~ Bppr4_t3 ; Appr5_t3 ~~ Bppr5_t3 ; Appr6_t3 ~~ Bppr6_t3
  Appr1_t4 ~~ Bppr1_t4; Appr4_t4 ~~ Bppr4_t4 ; Appr5_t4 ~~ Bppr5_t4 ; Appr6_t4 ~~ Bppr6_t4
  Appr1_t5 ~~ Bppr1_t5; Appr4_t5 ~~ Bppr4_t5 ; Appr5_t5 ~~ Bppr5_t5 ; Appr6_t5 ~~ Bppr6_t5
  Appr1_t6 ~~ Bppr1_t6; Appr4_t6 ~~ Bppr4_t6 ; Appr5_t6 ~~ Bppr5_t6 ; Appr6_t6 ~~ Bppr6_t6
  Appr1_t7 ~~ Bppr1_t7; Appr4_t7 ~~ Bppr4_t7 ; Appr5_t7 ~~ Bppr5_t7 ; Appr6_t7 ~~ Bppr6_t7
  Appr1_t8 ~~ Bppr1_t8; Appr4_t8 ~~ Bppr4_t8 ; Appr5_t8 ~~ Bppr5_t8 ; Appr6_t8 ~~ Bppr6_t8
  Appr1_t9 ~~ Bppr1_t9; Appr4_t9 ~~ Bppr4_t9 ; Appr5_t9 ~~ Bppr5_t9 ; Appr6_t9 ~~ Bppr6_t9
  Appr1_t10 ~~ Bppr1_t10; Appr4_t10 ~~ Bppr4_t10; Appr5_t10 ~~ Bppr5_t10 ; Appr6_t10 ~~ Bppr6_t10
  Appr1_t11 ~~ Bppr1_t11; Appr4_t11 ~~ Bppr4_t11; Appr5_t11 ~~ Bppr5_t11 ; Appr6_t11 ~~ Bppr6_t11
  Appr1_t12 ~~ Bppr1_t12; Appr4_t12 ~~ Bppr4_t12; Appr5_t12 ~~ Bppr5_t12 ; Appr6_t12 ~~ Bppr6_t12
  Appr1_t13 ~~ Bppr1_t13; Appr4_t13 ~~ Bppr4_t13; Appr5_t13 ~~ Bppr5_t13 ; Appr6_t13 ~~ Bppr6_t13
  Appr1_t14 ~~ Bppr1_t14; Appr4_t14 ~~ Bppr4_t14; Appr5_t14 ~~ Bppr5_t14 ; Appr6_t14 ~~ Bppr6_t14
  
  ################
  # BETWEEN BART #
  ################
  
  
  # Create between factors (RIs)
  ARIkm =~ 1*AFkm1 + 1*AFkm2 + 1*AFkm3 + 1*AFkm4 + 1*AFkm5 + 1*AFkm6 + 1*AFkm7 + 1*AFkm8 + 1*AFkm9 + 1*AFkm10 + 1*AFkm11 + 1*AFkm12 + 1*AFkm13 + 1*AFkm14
  ARIppr =~ 1*AFppr1 + 1*AFppr2 + 1*AFppr3 + 1*AFppr4 + 1*AFppr5 + 1*AFppr6 + 1*AFppr7 + 1*AFppr8 + 1*AFppr9 + 1*AFppr10 + 1*AFppr11 + 1*AFppr12 + 1*AFppr13 + 1*AFppr14
  BRIkm =~ 1*BFkm1 + 1*BFkm2 + 1*BFkm3 + 1*BFkm4 + 1*BFkm5 + 1*BFkm6 + 1*BFkm7 + 1*BFkm8 + 1*BFkm9 + 1*BFkm10 + 1*BFkm11 + 1*BFkm12 + 1*BFkm13 + 1*BFkm14
  BRIppr =~ 1*BFppr1 + 1*BFppr2 + 1*BFppr3 + 1*BFppr4 + 1*BFppr5 + 1*BFppr6 + 1*BFppr7 + 1*BFppr8 + 1*BFppr9 + 1*BFppr10 + 1*BFppr11 + 1*BFppr12 + 1*BFppr13 + 1*BFppr14
  
  # Set residual variances of all Fkm and Fppr vars to 0
  # I think this specifies all variance of the factors goes to either w/n or b/n
  AFkm1 ~~ 0*AFkm1
  AFkm2 ~~ 0*AFkm2
  AFkm3 ~~ 0*AFkm3
  AFkm4 ~~ 0*AFkm4
  AFkm5 ~~ 0*AFkm5
  AFkm6 ~~ 0*AFkm6
  AFkm7 ~~ 0*AFkm7
  AFkm8 ~~ 0*AFkm8
  AFkm9 ~~ 0*AFkm9
  AFkm10 ~~ 0*AFkm10
  AFkm11 ~~ 0*AFkm11
  AFkm12 ~~ 0*AFkm12
  AFkm13 ~~ 0*AFkm13
  AFkm14 ~~ 0*AFkm14
  AFppr1 ~~ 0*AFppr1
  AFppr2 ~~ 0*AFppr2
  AFppr3 ~~ 0*AFppr3
  AFppr4 ~~ 0*AFppr4
  AFppr5 ~~ 0*AFppr5
  AFppr6 ~~ 0*AFppr6
  AFppr7 ~~ 0*AFppr7
  AFppr8 ~~ 0*AFppr8
  AFppr9 ~~ 0*AFppr9
  AFppr10 ~~ 0*AFppr10
  AFppr11 ~~ 0*AFppr11
  AFppr12 ~~ 0*AFppr12
  AFppr13 ~~ 0*AFppr13
  AFppr14 ~~ 0*AFppr14
  
  BFkm1 ~~ 0*BFkm1
  BFkm2 ~~ 0*BFkm2
  BFkm3 ~~ 0*BFkm3
  BFkm4 ~~ 0*BFkm4
  BFkm5 ~~ 0*BFkm5
  BFkm6 ~~ 0*BFkm6
  BFkm7 ~~ 0*BFkm7
  BFkm8 ~~ 0*BFkm8
  BFkm9 ~~ 0*BFkm9
  BFkm10 ~~ 0*BFkm10
  BFkm11 ~~ 0*BFkm11
  BFkm12 ~~ 0*BFkm12
  BFkm13 ~~ 0*BFkm13
  BFkm14 ~~ 0*BFkm14
  BFppr1 ~~ 0*BFppr1
  BFppr2 ~~ 0*BFppr2
  BFppr3 ~~ 0*BFppr3
  BFppr4 ~~ 0*BFppr4
  BFppr5 ~~ 0*BFppr5
  BFppr6 ~~ 0*BFppr6
  BFppr7 ~~ 0*BFppr7
  BFppr8 ~~ 0*BFppr8
  BFppr9 ~~ 0*BFppr9
  BFppr10 ~~ 0*BFppr10
  BFppr11 ~~ 0*BFppr11
  BFppr12 ~~ 0*BFppr12
  BFppr13 ~~ 0*BFppr13
  BFppr14 ~~ 0*BFppr14


  ###############
  # WITHIN BART #
  ###############

  # Create within-components
  AWFkm1 =~ 1*AFkm1
  AWFkm2 =~ 1*AFkm2
  AWFkm3 =~ 1*AFkm3
  AWFkm4 =~ 1*AFkm4
  AWFkm5 =~ 1*AFkm5
  AWFkm6 =~ 1*AFkm6
  AWFkm7 =~ 1*AFkm7
  AWFkm8 =~ 1*AFkm8
  AWFkm9 =~ 1*AFkm9
  AWFkm10 =~ 1*AFkm10
  AWFkm11 =~ 1*AFkm11
  AWFkm12 =~ 1*AFkm12
  AWFkm13 =~ 1*AFkm13
  AWFkm14 =~ 1*AFkm14
  
  AWFppr1 =~ 1*AFppr1
  AWFppr2 =~ 1*AFppr2
  AWFppr3 =~ 1*AFppr3
  AWFppr4 =~ 1*AFppr4
  AWFppr5 =~ 1*AFppr5
  AWFppr6 =~ 1*AFppr6
  AWFppr7 =~ 1*AFppr7
  AWFppr8 =~ 1*AFppr8
  AWFppr9 =~ 1*AFppr9
  AWFppr10 =~ 1*AFppr10
  AWFppr11 =~ 1*AFppr11
  AWFppr12 =~ 1*AFppr12
  AWFppr13 =~ 1*AFppr13
  AWFppr14 =~ 1*AFppr14
  
  BWFkm1 =~ 1*BFkm1
  BWFkm2 =~ 1*BFkm2
  BWFkm3 =~ 1*BFkm3
  BWFkm4 =~ 1*BFkm4
  BWFkm5 =~ 1*BFkm5
  BWFkm6 =~ 1*BFkm6
  BWFkm7 =~ 1*BFkm7
  BWFkm8 =~ 1*BFkm8
  BWFkm9 =~ 1*BFkm9
  BWFkm10 =~ 1*BFkm10
  BWFkm11 =~ 1*BFkm11
  BWFkm12 =~ 1*BFkm12
  BWFkm13 =~ 1*BFkm13
  BWFkm14 =~ 1*BFkm14
  
  BWFppr1 =~ 1*BFppr1
  BWFppr2 =~ 1*BFppr2
  BWFppr3 =~ 1*BFppr3
  BWFppr4 =~ 1*BFppr4
  BWFppr5 =~ 1*BFppr5
  BWFppr6 =~ 1*BFppr6
  BWFppr7 =~ 1*BFppr7
  BWFppr8 =~ 1*BFppr8
  BWFppr9 =~ 1*BFppr9
  BWFppr10 =~ 1*BFppr10
  BWFppr11 =~ 1*BFppr11
  BWFppr12 =~ 1*BFppr12
  BWFppr13 =~ 1*BFppr13
  BWFppr14 =~ 1*BFppr14
  
  
  # Specify lagged effects between within-person centered latent variables
  # Should be 8 total (16 maximum, but indistinguishable constraints down half of them)
  # (we need these to account for Partner Bs previous responses; it needs to be partialed. Non specifying these == to saything those paths are zero) 
  # outcome:individual:type
  # kaa = kama muta outcome: actor : autoregressive (coming from kama muta)
  # kpa = kama muta outcome: partner: autoregressive
  # kac = kama muta outcome: actor : crosslagged (coming from ppr)
  # kpc = kama muta outcome: partner : crosslagged

  # For KM effects.
  AWFkm2 ~ kaa1*AWFkm1 + kpa1*BWFkm1 + kac1*AWFppr1 + kpc1*BWFppr1 
  BWFkm2 ~ kaa1*BWFkm1 + kpa1*AWFkm1 + kac1*BWFppr1 + kpc1*AWFppr1
  AWFkm3 ~ kaa2*AWFkm2 + kpa2*BWFkm2 + kac2*AWFppr2 + kpc2*BWFppr2 
  BWFkm3 ~ kaa2*BWFkm2 + kpa2*AWFkm2 + kac2*BWFppr2 + kpc2*AWFppr2
  AWFkm4 ~ kaa3*AWFkm3 + kpa3*BWFkm3 + kac3*AWFppr3 + kpc3*BWFppr3 
  BWFkm4 ~ kaa3*BWFkm3 + kpa3*AWFkm3 + kac3*BWFppr3 + kpc3*AWFppr3
  AWFkm5 ~ kaa4*AWFkm4 + kpa4*BWFkm4 + kac4*AWFppr4 + kpc4*BWFppr4 
  BWFkm5 ~ kaa4*BWFkm4 + kpa4*AWFkm4 + kac4*BWFppr4 + kpc4*AWFppr4
  AWFkm6 ~ kaa5*AWFkm5 + kpa5*BWFkm5 + kac5*AWFppr5 + kpc5*BWFppr5 
  BWFkm6 ~ kaa5*BWFkm5 + kpa5*AWFkm5 + kac5*BWFppr5 + kpc5*AWFppr5
  AWFkm7 ~ kaa6*AWFkm6 + kpa6*BWFkm6 + kac6*AWFppr6 + kpc6*BWFppr6 
  BWFkm7 ~ kaa6*BWFkm6 + kpa6*AWFkm6 + kac6*BWFppr6 + kpc6*AWFppr6
  AWFkm8 ~ kaa7*AWFkm7 + kpa7*BWFkm7 + kac7*AWFppr7 + kpc7*BWFppr7 
  BWFkm8 ~ kaa7*BWFkm7 + kpa7*AWFkm7 + kac7*BWFppr7 + kpc7*AWFppr7
  AWFkm9 ~ kaa8*AWFkm8 + kpa8*BWFkm8 + kac8*AWFppr8 + kpc8*BWFppr8 
  BWFkm9 ~ kaa8*BWFkm8 + kpa8*AWFkm8 + kac8*BWFppr8 + kpc8*AWFppr8
  AWFkm10 ~ kaa9*AWFkm9 + kpa9*BWFkm9 + kac9*AWFppr9 + kpc9*BWFppr9 
  BWFkm10 ~ kaa9*BWFkm9 + kpa9*AWFkm9 + kac9*BWFppr9 + kpc9*AWFppr9
  AWFkm11 ~ kaa10*AWFkm10 + kpa10*BWFkm10 + kac10*AWFppr10 + kpc10*BWFppr10 
  BWFkm11 ~ kaa10*BWFkm10 + kpa10*AWFkm10 + kac10*BWFppr10 + kpc10*AWFppr10
  AWFkm12 ~ kaa11*AWFkm11 + kpa11*BWFkm11 + kac11*AWFppr11 + kpc11*BWFppr11 
  BWFkm12 ~ kaa11*BWFkm11 + kpa11*AWFkm11 + kac11*BWFppr11 + kpc11*AWFppr11
  AWFkm13 ~ kaa12*AWFkm12 + kpa12*BWFkm12 + kac12*AWFppr12 + kpc12*BWFppr12 
  BWFkm13 ~ kaa12*BWFkm12 + kpa12*AWFkm12 + kac12*BWFppr12 + kpc12*AWFppr12
  AWFkm14 ~ kaa13*AWFkm13 + kpa13*BWFkm13 + kac13*AWFppr13 + kpc13*BWFppr13 
  BWFkm14 ~ kaa13*BWFkm13 + kpa13*AWFkm13 + kac13*BWFppr13 + kpc13*AWFppr13
  
  # For PPR effects
  AWFppr2 ~ paa1*AWFppr1 + ppa1*BWFppr1 + pac1*AWFkm1 + ppc1*BWFkm1 
  BWFppr2 ~ paa1*BWFppr1 + ppa1*AWFppr1 + pac1*BWFkm1 + ppc1*AWFkm1
  AWFppr3 ~ paa2*AWFppr2 + ppa2*BWFppr2 + pac2*AWFkm2 + ppc2*BWFkm2 
  BWFppr3 ~ paa2*BWFppr2 + ppa2*AWFppr2 + pac2*BWFkm2 + ppc2*AWFkm2
  AWFppr4 ~ paa3*AWFppr3 + ppa3*BWFppr3 + pac3*AWFkm3 + ppc3*BWFkm3 
  BWFppr4 ~ paa3*BWFppr3 + ppa3*AWFppr3 + pac3*BWFkm3 + ppc3*AWFkm3
  AWFppr5 ~ paa4*AWFppr4 + ppa4*BWFppr4 + pac4*AWFkm4 + ppc4*BWFkm4 
  BWFppr5 ~ paa4*BWFppr4 + ppa4*AWFppr4 + pac4*BWFkm4 + ppc4*AWFkm4
  AWFppr6 ~ paa5*AWFppr5 + ppa5*BWFppr5 + pac5*AWFkm5 + ppc5*BWFkm5 
  BWFppr6 ~ paa5*BWFppr5 + ppa5*AWFppr5 + pac5*BWFkm5 + ppc5*AWFkm5
  AWFppr7 ~ paa6*AWFppr6 + ppa6*BWFppr6 + pac6*AWFkm6 + ppc6*BWFkm6 
  BWFppr7 ~ paa6*BWFppr6 + ppa6*AWFppr6 + pac6*BWFkm6 + ppc6*AWFkm6
  AWFppr8 ~ paa7*AWFppr7 + ppa7*BWFppr7 + pac7*AWFkm7 + ppc7*BWFkm7 
  BWFppr8 ~ paa7*BWFppr7 + ppa7*AWFppr7 + pac7*BWFkm7 + ppc7*AWFkm7
  AWFppr9 ~ paa8*AWFppr8 + ppa8*BWFppr8 + pac8*AWFkm8 + ppc8*BWFkm8 
  BWFppr9 ~ paa8*BWFppr8 + ppa8*AWFppr8 + pac8*BWFkm8 + ppc8*AWFkm8
  AWFppr10 ~ paa9*AWFppr9 + ppa9*BWFppr9 + pac9*AWFkm9 + ppc9*BWFkm9 
  BWFppr10 ~ paa9*BWFppr9 + ppa9*AWFppr9 + pac9*BWFkm9 + ppc9*AWFkm9
  AWFppr11 ~ paa10*AWFppr10 + ppa10*BWFppr10 + pac10*AWFkm10 + ppc10*BWFkm10 
  BWFppr11 ~ paa10*BWFppr10 + ppa10*AWFppr10 + pac10*BWFkm10 + ppc10*AWFkm10
  AWFppr12 ~ paa11*AWFppr11 + ppa11*BWFppr11 + pac11*AWFkm11 + ppc11*BWFkm11 
  BWFppr12 ~ paa11*BWFppr11 + ppa11*AWFppr11 + pac11*BWFkm11 + ppc11*AWFkm11
  AWFppr13 ~ paa12*AWFppr12 + ppa12*BWFppr12 + pac12*AWFkm12 + ppc12*BWFkm12 
  BWFppr13 ~ paa12*BWFppr12 + ppa12*AWFppr12 + pac12*BWFkm12 + ppc12*AWFkm12
  AWFppr14 ~ paa13*AWFppr13 + ppa13*BWFppr13 + pac13*AWFkm13 + ppc13*BWFkm13 
  BWFppr14 ~ paa13*BWFppr13 + ppa13*AWFppr13 + pac13*BWFkm13 + ppc13*AWFkm13
  
  
  # Estimate correlations within same wave
  AWFkm1 ~~ s*AWFppr1 + t*BWFkm1 + u*BWFppr1 
  AWFkm2 ~~ s*AWFppr2 + t*BWFkm2 + u*BWFppr2
  AWFkm3 ~~ s*AWFppr3 + t*BWFkm3 + u*BWFppr3
  AWFkm4 ~~ s*AWFppr4 + t*BWFkm4 + u*BWFppr4
  AWFkm5 ~~ s*AWFppr5 + t*BWFkm5 + u*BWFppr5
  AWFkm6 ~~ s*AWFppr6 + t*BWFkm6 + u*BWFppr6
  AWFkm7 ~~ s*AWFppr7 + t*BWFkm7 + u*BWFppr7
  AWFkm8 ~~ s*AWFppr8 + t*BWFkm8 + u*BWFppr8
  AWFkm9 ~~ s*AWFppr9 + t*BWFkm9 + u*BWFppr9
  AWFkm10 ~~ s*AWFppr10 + t*BWFkm10 + u*BWFppr10
  AWFkm11 ~~ s*AWFppr11 + t*BWFkm11 + u*BWFppr11
  AWFkm12 ~~ s*AWFppr12 + t*BWFkm12 + u*BWFppr12
  AWFkm13 ~~ s*AWFppr13 + t*BWFkm13 + u*BWFppr13
  AWFkm14 ~~ s*AWFppr14 + t*BWFkm14 + u*BWFppr14
  
  BWFkm1 ~~ v*AWFppr1 + w*BWFppr1 
  BWFkm2 ~~ v*AWFppr2 + w*BWFppr2
  BWFkm3 ~~ v*AWFppr3 + w*BWFppr3
  BWFkm4 ~~ v*AWFppr4 + w*BWFppr4
  BWFkm5 ~~ v*AWFppr5 + w*BWFppr5
  BWFkm6 ~~ v*AWFppr6 + w*BWFppr6
  BWFkm7 ~~ v*AWFppr7 + w*BWFppr7
  BWFkm8 ~~ v*AWFppr8 + w*BWFppr8
  BWFkm9 ~~ v*AWFppr9 + w*BWFppr9
  BWFkm10 ~~ v*AWFppr10 + w*BWFppr10
  BWFkm11 ~~ v*AWFppr11 + w*BWFppr11
  BWFkm12 ~~ v*AWFppr12 + w*BWFppr12
  BWFkm13 ~~ v*AWFppr13 + w*BWFppr13
  BWFkm14 ~~ v*AWFppr14 + w*BWFppr14
  
  AWFppr1 ~~ x*BWFppr1 
  AWFppr2 ~~ x*BWFppr2
  AWFppr3 ~~ x*BWFppr3
  AWFppr4 ~~ x*BWFppr4
  AWFppr5 ~~ x*BWFppr5
  AWFppr6 ~~ x*BWFppr6
  AWFppr7 ~~ x*BWFppr7
  AWFppr8 ~~ x*BWFppr8
  AWFppr9 ~~ x*BWFppr9
  AWFppr10 ~~ x*BWFppr10
  AWFppr11 ~~ x*BWFppr11
  AWFppr12 ~~ x*BWFppr12
  AWFppr13 ~~ x*BWFppr13
  AWFppr14 ~~ x*BWFppr14
  
  
  ##########################
  # ADDITIONAL CONSTRAINTS #
  ##########################
  
  # Set correlations between between-factors (RIs) and within-factors at wave 1 at 0
  ARIkm + ARIppr + BRIkm + BRIppr ~~ 0*AWFkm1 + 0*AWFppr1 + 0*BWFkm1 + 0*BWFppr1
  
'


strong.m1.fit <- cfa(strong.m1,
                   data = dfSEM,
                   std.lv = T,
                   missing = "ML"
                   )
summary(strong.m1.fit,fit.measures = T, standardized =T, ci = T)
```


#### Residual Error Invariance, Indistinguishability Test
I don't think I'll realistically get to do this.
